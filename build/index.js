"use strict";(self.webpackChunkrazor=self.webpackChunkrazor||[]).push([[826],{357:(t,e,s)=>{s.d(e,{Z:()=>n});var r=s(34),i=s(394);class n extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){get ELEMENTS(){return(0,i.Z)(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+e];return this.check()}to(t){return t===this?this:(0,r.kJ)(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let s=0;s<this.ELEMENTS;++s)t[e+s]=this[s];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(r.vc)}formatString(t){let e="";for(let s=0;s<this.ELEMENTS;++s)e+=(s>0?", ":"")+(0,r.Bw)(this[s],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!(0,r.fS)(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,s){void 0===s&&(s=e,e=t,t=this);for(let r=0;r<this.ELEMENTS;++r){const i=t[r];this[r]=i+s*(e[r]-i)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),e[s]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(r.vc.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}},521:(t,e,s)=>{s.d(e,{Z:()=>a});var r=s(357),i=s(281),n=s(394);class a extends r.Z{get ELEMENTS(){return(0,n.Z)(!1),0}copy(t){return(0,n.Z)(!1),this}get x(){return this[0]}set x(t){this[0]=(0,i.u5)(t)}get y(){return this[1]}set y(t){this[1]=(0,i.u5)(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-t[s];e+=r*r}return(0,i.u5)(e)}dot(t){let e=0;for(let s=0;s<this.ELEMENTS;++s)e+=this[s]*t[s];return(0,i.u5)(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return(0,n.Z)(t>=0&&t<this.ELEMENTS,"index is out of range"),(0,i.u5)(this[t])}setComponent(t,e){return(0,n.Z)(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}},855:(t,e,s)=>{s.d(e,{Z:()=>l});var r=s(521),i=s(34),n=s(281),a=s(160),o=s(31);const h=[0,0,0],c={};class l extends r.Z{static get ZERO(){return c.ZERO=c.ZERO||Object.freeze(new l(0,0,0,0))}constructor(t=0,e=0,s=0){super(-0,-0,-0),1===arguments.length&&(0,i.kJ)(t)?this.copy(t):(i.vc.debug&&((0,n.u5)(t),(0,n.u5)(e),(0,n.u5)(s)),this[0]=t,this[1]=e,this[2]=s)}set(t,e,s){return this[0]=t,this[1]=e,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return i.vc.debug&&((0,n.u5)(t.x),(0,n.u5)(t.y),(0,n.u5)(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=(0,n.u5)(t)}angle(t){return a.EU(this,t)}cross(t){return a.kC(this,this,t),this.check()}rotateX({radians:t,origin:e=h}){return a.lM(this,this,e,t),this.check()}rotateY({radians:t,origin:e=h}){return a.uD(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=h}){return a.jI(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return a.fF(this,this,t),this.check()}transformAsVector(t){return(0,o.pL)(this,this,t),this.check()}transformByMatrix3(t){return a.kK(this,this,t),this.check()}transformByMatrix2(t){return(0,o.eQ)(this,this,t),this.check()}transformByQuaternion(t){return a.VC(this,this,t),this.check()}}},394:(t,e,s)=>{function r(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}s.d(e,{Z:()=>r})},34:(t,e,s)=>{s.d(e,{vc:()=>i,Bw:()=>n,kJ:()=>a,Yr:()=>o,fS:()=>h}),Math.PI;const r=1/180*Math.PI,i={};function n(t,{precision:e=i.precision||4}={}){return t=function(t){return Math.round(t/i.EPSILON)*i.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function a(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function o(t){return function(t,e){return function(t,e,s){if(a(t)){s=s||((r=t).clone?r.clone():new Array(r.length));for(let r=0;r<s.length&&r<t.length;++r)s[r]=e(t[r],r,s);return s}var r;return e(t)}(t,(t=>t*r),void 0)}(t)}function h(t,e,s){const r=i.EPSILON;s&&(i.EPSILON=s);try{if(t===e)return!0;if(a(t)&&a(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!h(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{i.EPSILON=r}}i.EPSILON=1e-12,i.debug=!1,i.precision=4,i.printTypes=!1,i.printDegrees=!1,i.printRowMajor=!0},31:(t,e,s)=>{function r(t,e,s){const r=e[0],i=e[1],n=s[3]*r+s[7]*i||1;return t[0]=(s[0]*r+s[4]*i)/n,t[1]=(s[1]*r+s[5]*i)/n,t}function i(t,e,s){const r=e[0],i=e[1],n=e[2],a=s[3]*r+s[7]*i+s[11]*n||1;return t[0]=(s[0]*r+s[4]*i+s[8]*n)/a,t[1]=(s[1]*r+s[5]*i+s[9]*n)/a,t[2]=(s[2]*r+s[6]*i+s[10]*n)/a,t}function n(t,e,s){const r=e[0],i=e[1];return t[0]=s[0]*r+s[2]*i,t[1]=s[1]*r+s[3]*i,t[2]=e[2],t}function a(t,e,s){const r=e[0],i=e[1];return t[0]=s[0]*r+s[2]*i,t[1]=s[1]*r+s[3]*i,t[2]=e[2],t[3]=e[3],t}function o(t,e,s){const r=e[0],i=e[1],n=e[2];return t[0]=s[0]*r+s[3]*i+s[6]*n,t[1]=s[1]*r+s[4]*i+s[7]*n,t[2]=s[2]*r+s[5]*i+s[8]*n,t[3]=e[3],t}s.d(e,{pb:()=>r,pL:()=>i,eQ:()=>n,G7:()=>a,_x:()=>o})},281:(t,e,s)=>{s.d(e,{u5:()=>i,IL:()=>n,x9:()=>o});var r=s(34);function i(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function n(t,e,s=""){if(r.vc.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(s," some fields set to invalid numbers'"));return t}const a={};function o(t,e){a[t]||(a[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}},181:(t,e,s)=>{s.d(e,{Z:()=>n});var r=s(855);class i extends r.Z{constructor(t=0,e=0,s=0){super(t,e,s)}add(t){return super.add(t),this}get pitch(){return this.x}get yaw(){return this.y}get roll(){return this.z}set pitch(t){this.x=t}set yaw(t){this.y=t}set roll(t){this.z=t}}const n=i},458:(t,e,s)=>{var r=null;const i=class{static init(t){if(t||(t=document.createElement("canvas"),document.body.appendChild(t)),void 0===(r=t.getContext("webgl")))throw new Error("Unable to initialize WebGL!");return t}static drawByIndices(t){r.drawElements(r.TRIANGLES,t,r.UNSIGNED_SHORT,0)}static draw(t){r.drawArrays(r.TRIANGLES,0,t)}static drawBuffer(t){}};function n(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const a={KEY_0:"Digit0",KEY_1:"Digit1",KEY_2:"Digit2",KEY_3:"Digit3",KEY_4:"Digit4",KEY_5:"Digit5",KEY_6:"Digit6",KEY_7:"Digit7",KEY_8:"Digit8",KEY_9:"Digit9",KEY_A:"KeyA",KEY_B:"KeyB",KEY_C:"KeyC",KEY_D:"KeyD",KEY_E:"KeyE",KEY_F:"KeyF",KEY_G:"KeyG",KEY_H:"KeyH",KEY_I:"KeyI",KEY_J:"KeyJ",KEY_K:"KeyK",KEY_L:"KeyL",KEY_M:"KeyM",KEY_N:"KeyN",KEY_O:"KeyO",KEY_P:"KeyP",KEY_Q:"KeyQ",KEY_R:"KeyR",KEY_S:"KeyS",KEY_T:"KeyT",KEY_U:"KeyU",KEY_V:"KeyV",KEY_X:"KeyX",KEY_W:"KeyW",KEY_Y:"KeyY",KEY_Z:"KeyZ",KEY_SPACE:"Space",KEY_ESCAPE:"Escape",KEY_ENTER:"Enter",KEY_BACKSPACE:"Backspace",KEY_INSERT:"Insert",KEY_DELETE:"Delete",KEY_ALT_L:"AltLeft",KEY_ALT_R:"AltRight",KEY_CTRL_L:"ControlLeft",KEY_CTRL_R:"ControlRight",KEY_SHIFT_L:"ShiftLeft",KEY_SHIFT_R:"ShiftRight",KEY_UP:"ArrowUp",KEY_DOWN:"ArrowDown",KEY_LEFT:"ArrowLeft",KEY_RIGHT:"ArrowRight",KEY_HOME:"Home",KEY_END:"End",KEY_PAGEUP:"PageUp",KEY_PAGEDOWN:"PageDown",KEY_BACKQUOTE:"Backquote",KEY_MINUS:"Minus",KEY_EQUAL:"Equal",KEY_BRACKET_L:"Bracketleft",KEY_BRACKET_R:"BracketRight",KEY_BACKSLASH:"Backslash",KEY_SEMICOLON:"Semicolon",KEY_QUOTE:"Quote",KEY_COMMA:"Comma",KEY_PERIOD:"Period",KEY_SLASH:"Slash"};class o{static init(){o._bufferKeys=[],o._keys=new Map,Object.keys(a).forEach((t=>{o._keys.set(t,!1)})),window.addEventListener("keydown",o.onKeyDown),window.addEventListener("keyup",o.onKeyUp),o._mouseButtons=[!1,!1,!1],o._currentMousePosition=[0,0],o._previousMousePosition=[0,0],o._mouseMovement=[0,0],d.CANVAS.addEventListener("mousedown",o.onMouseDown),d.CANVAS.addEventListener("mouseup",o.onMouseUp),d.CANVAS.addEventListener("mousemove",o.onMouseMove),this._shouldDebug=!1}static isKeyPressedDown(t){return!o._bufferKeys.includes(t)&&1==o._keys.get(t)&&(o._bufferKeys.push(t),!0)}static isKeyPressed(t){return o._keys.get(t)}static onKeyDown(t){d.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._keys.set(t.code,!0))}static onKeyUp(t){d.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._keys.set(t.code,!1),o._bufferKeys=o._bufferKeys.filter((e=>e!=t.code)))}static update(){o._mouseMovement[0]=o._currentMousePosition[0]-o._previousMousePosition[0],o._mouseMovement[1]=o._currentMousePosition[1]-o._previousMousePosition[1],o._previousMousePosition[0]=o._currentMousePosition[0],o._previousMousePosition[1]=o._currentMousePosition[1]}static isMouseLeft(){return o._mouseButtons[0]}static isMouseMiddle(){return o._mouseButtons[1]}static isMouseRight(){return o._mouseButtons[2]}static getMouseX(){return o._currentMousePosition[0]}static getMouseY(){return o._currentMousePosition[1]}static getMouseDX(){return o._mouseMovement[0]}static getMouseDY(){return o._mouseMovement[1]}static onMouseDown(t){t.stopPropagation(),t.preventDefault(),o._mouseButtons[t.button]=d.IS_MOUSE_INSIDE}static onMouseUp(t){d.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._mouseButtons[t.button]=!1)}static onMouseMove(t){d.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._currentMousePosition[0]-=t.movementX,o._currentMousePosition[1]-=t.movementY,o._shouldDebug&&(console.log(`offset:  ${t.offsetX}X ${t.offsetY}Y`),console.log(`client:  ${t.clientX}X ${t.clientY}Y`),console.log(`screen:  ${t.screenX}X ${t.screenY}Y`)))}static setDebug(t){o._shouldDebug=t}static shouldDebug(){return o._shouldDebug}}n(o,"_mouseButtons",void 0),n(o,"_currentMousePosition",void 0),n(o,"_previousMousePosition",void 0),n(o,"_mouseMovement",void 0),n(o,"_bufferKeys",void 0),n(o,"_keys",void 0),n(o,"_shouldDebug",void 0);const h=o;function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class u{constructor(t,e){l(this,"_gameLoop",void 0),l(this,"_gameCore",void 0),l(this,"_started",void 0),u.CANVAS=i.init(e),Object.defineProperty(this,"CANVAS",{writable:!1}),r.clearColor(0,0,0,1),this._gameLoop=new class{constructor(t){c(this,"_gameCore",void 0),c(this,"_then",void 0),c(this,"_frameBuffer",void 0),c(this,"loop",(t=>{const e=(t*=.001)-this._then;this._then=t;const s=1/e;document.querySelector("#fps span").textContent=s.toFixed(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),h.update(),this._gameCore.update(t,e),this._gameCore.render(),requestAnimationFrame(this.loop)})),this._gameCore=t,this._then=0}start(){this._gameCore.start(),r.enable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.CULL_FACE),r.depthFunc(r.LESS),this.loop(0)}}(t),this._started=!1,this._gameCore=t,u.FOCUSED=Boolean(!!e),u.IS_MOUSE_INSIDE=Boolean(!!e)}start(){u.IS_MOUSE_INSIDE||this.configs(),this.resize(),h.init(),this._gameLoop.start(),this._started=!0}resize(){if(void 0===u.CANVAS)throw new Error("Canvas was not initialized!");u.CANVAS.width=u.CANVAS.offsetWidth,u.CANVAS.height=u.CANVAS.offsetHeight,r.viewport(0,0,u.CANVAS.width,u.CANVAS.height)}configs(){u.CANVAS.addEventListener("click",(t=>{u.IS_MOUSE_INSIDE||(u.FOCUSED=u.isInsideCanvas(t.clientX,t.clientY),u.CANVAS.requestPointerLock())})),document.addEventListener("pointerlockchange",(t=>{u.IS_MOUSE_INSIDE=!u.IS_MOUSE_INSIDE})),u.CANVAS.addEventListener("mousemove",(t=>{})),u.CANVAS.addEventListener("mouseleave",(t=>{u.IS_MOUSE_INSIDE=!1}))}static isInsideCanvas(t,e){return t>u.CANVAS.offsetLeft&&t<u.CANVAS.offsetLeft+u.CANVAS.offsetWidth&&e>u.CANVAS.offsetTop&&e<u.CANVAS.offsetTop+u.CANVAS.offsetHeight}isStarted(){return this._started}getGameCore(){return this._gameCore}}l(u,"CANVAS",void 0),l(u,"FOCUSED",void 0),l(u,"IS_MOUSE_INSIDE",void 0);const d=u;var g=s(855);function _(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const m=class{constructor(t,e){_(this,"_name",void 0),_(this,"_scene",void 0),_(this,"_camera",void 0),_(this,"_maximumRenderDistance",void 0),this._name=t,this._camera=e,this._maximumRenderDistance=-1}getEntitiesByMaterial(t){return this._scene.filterVisible((e=>e.getRenderer()&&e.getRenderer().getName()===this._name&&e.getMaterial()&&e.getMaterial().getName()===t.getName()&&(this._maximumRenderDistance<0||this._camera.getTransform().getTranslation().distanceTo(e.getTransform().getTranslation())<this._maximumRenderDistance)))}getEntitiesByShader(t){return this._scene.filterVisible((e=>e.getRenderer().getName()===this._name&&e.getMaterial().getShader().getName()===t.getName()))}getName(){return this._name}setScene(t){this._scene=t}getScene(){return this._scene}getCamera(){return this._camera}};var f=s(181),p=s(281),v=s(357),b=s(34),y=s(394);class w extends v.Z{get ELEMENTS(){return(0,y.Z)(!1),0}get RANK(){return(0,y.Z)(!1),0}toString(){let t="[";if(b.vc.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let s=0;s<this.RANK;++s)t+=" ".concat(this[s*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,s){return this[e*this.RANK+t]=(0,p.u5)(s),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[s+t];return e}setColumn(t,e){const s=t*this.RANK;for(let t=0;t<this.RANK;++t)this[s+t]=e[t];return this}}var T=s(31),x=s(685);function E(t,e,s){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],c=e[6],l=e[7],u=e[8],d=e[9],g=e[10],_=e[11],m=e[12],f=e[13],p=e[14],v=e[15],b=s[0],y=s[1],w=s[2],T=s[3];return t[0]=b*r+y*o+w*u+T*m,t[1]=b*i+y*h+w*d+T*f,t[2]=b*n+y*c+w*g+T*p,t[3]=b*a+y*l+w*_+T*v,b=s[4],y=s[5],w=s[6],T=s[7],t[4]=b*r+y*o+w*u+T*m,t[5]=b*i+y*h+w*d+T*f,t[6]=b*n+y*c+w*g+T*p,t[7]=b*a+y*l+w*_+T*v,b=s[8],y=s[9],w=s[10],T=s[11],t[8]=b*r+y*o+w*u+T*m,t[9]=b*i+y*h+w*d+T*f,t[10]=b*n+y*c+w*g+T*p,t[11]=b*a+y*l+w*_+T*v,b=s[12],y=s[13],w=s[14],T=s[15],t[12]=b*r+y*o+w*u+T*m,t[13]=b*i+y*h+w*d+T*f,t[14]=b*n+y*c+w*g+T*p,t[15]=b*a+y*l+w*_+T*v,t}function S(t,e,s){var r=s[0],i=s[1],n=s[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function M(t,e,s){var r=e[0],i=e[1];return t[0]=s[0]*r+s[4]*i+s[12],t[1]=s[1]*r+s[5]*i+s[13],t}N=new x.WT(2),x.WT!=Float32Array&&(N[0]=0,N[1]=0);var N,A=s(160);!function(){var t=new x.WT(4);x.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();const R=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),C=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),O=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),P={};class L extends w{static get IDENTITY(){return P.IDENTITY=P.IDENTITY||Object.freeze(new L(R)),P.IDENTITY}static get ZERO(){return P.ZERO=P.ZERO||Object.freeze(new L(C)),P.ZERO}get INDICES(){return O}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,s,r,i,n,a,o,h,c,l,u,d,g,_,m){return this[0]=t,this[1]=e,this[2]=s,this[3]=r,this[4]=i,this[5]=n,this[6]=a,this[7]=o,this[8]=h,this[9]=c,this[10]=l,this[11]=u,this[12]=d,this[13]=g,this[14]=_,this[15]=m,this.check()}setRowMajor(t,e,s,r,i,n,a,o,h,c,l,u,d,g,_,m){return this[0]=t,this[1]=i,this[2]=h,this[3]=d,this[4]=e,this[5]=n,this[6]=c,this[7]=g,this[8]=s,this[9]=a,this[10]=l,this[11]=_,this[12]=r,this[13]=o,this[14]=u,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(R)}fromQuaternion(t){return function(t,e){var s=e[0],r=e[1],i=e[2],n=e[3],a=s+s,o=r+r,h=i+i,c=s*a,l=r*a,u=r*o,d=i*a,g=i*o,_=i*h,m=n*a,f=n*o,p=n*h;t[0]=1-u-_,t[1]=l+p,t[2]=d-f,t[3]=0,t[4]=l-p,t[5]=1-c-_,t[6]=g+m,t[7]=0,t[8]=d+f,t[9]=g-m,t[10]=1-c-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum({left:t,right:e,bottom:s,top:r,near:i,far:n}){return n===1/0?L._computeInfinitePerspectiveOffCenter(this,t,e,s,r,i):function(t,e,s,r,i,n,a){var o=1/(s-e),h=1/(i-r),c=1/(n-a);t[0]=2*n*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*h,t[6]=0,t[7]=0,t[8]=(s+e)*o,t[9]=(i+r)*h,t[10]=(a+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n*2*c,t[15]=0}(this,t,e,s,r,i,n),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,s,r,i,n){const a=2*n/(s-e),o=2*n/(i-r),h=(s+e)/(s-e),c=(i+r)/(i-r),l=-2*n;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=h,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=l,t[15]=0,t}lookAt(t,e,s){return 1===arguments.length&&({eye:t,center:e,up:s}=t),function(t,e,s,r){var i,n,a,o,h,c,l,u,d,g,_=e[0],m=e[1],f=e[2],p=r[0],v=r[1],b=r[2],y=s[0],w=s[1],T=s[2];Math.abs(_-y)<x.Ib&&Math.abs(m-w)<x.Ib&&Math.abs(f-T)<x.Ib?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(l=_-y,u=m-w,d=f-T,i=v*(d*=g=1/Math.hypot(l,u,d))-b*(u*=g),n=b*(l*=g)-p*d,a=p*u-v*l,(g=Math.hypot(i,n,a))?(i*=g=1/g,n*=g,a*=g):(i=0,n=0,a=0),o=u*a-d*n,h=d*i-l*a,c=l*n-u*i,(g=Math.hypot(o,h,c))?(o*=g=1/g,h*=g,c*=g):(o=0,h=0,c=0),t[0]=i,t[1]=o,t[2]=l,t[3]=0,t[4]=n,t[5]=h,t[6]=u,t[7]=0,t[8]=a,t[9]=c,t[10]=d,t[11]=0,t[12]=-(i*_+n*m+a*f),t[13]=-(o*_+h*m+c*f),t[14]=-(l*_+u*m+d*f),t[15]=1)}(this,t,e=e||[0,0,0],s=s||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:s,top:r,near:i=.1,far:n=500}){return function(t,e,s,r,i,n,a){var o=1/(e-s),h=1/(r-i),c=1/(n-a);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+s)*o,t[13]=(i+r)*h,t[14]=(a+n)*c,t[15]=1}(this,t,e,s,r,i,n),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:s=1,near:r=.1,far:i=500}){if(t>2*Math.PI)throw Error("radians");const n=t/2,a=s*Math.tan(n),o=a*e;return(new L).ortho({left:-o,right:o,bottom:-a,top:a,near:r,far:i})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:s=1,near:r=.1,far:i=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return function(t,e,s,r,i){var n,a=1/Math.tan(e/2);t[0]=a/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(n=1/(r-i),t[10]=(i+r)*n,t[14]=2*i*r*n):(t[10]=-1,t[14]=-2*r)}(this,t,s,r,i),this.check()}determinant(){return e=(t=this)[0],s=t[1],r=t[2],i=t[3],n=t[4],a=t[5],o=t[6],h=t[7],c=t[8],l=t[9],u=t[10],d=t[11],g=t[12],_=t[13],m=t[14],(e*a-s*n)*(u*(f=t[15])-d*m)-(e*o-r*n)*(l*f-d*_)+(e*h-i*n)*(l*m-u*_)+(s*o-r*a)*(c*f-d*g)-(s*h-i*a)*(c*m-u*g)+(r*h-i*o)*(c*_-l*g);var t,e,s,r,i,n,a,o,h,c,l,u,d,g,_,m,f}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const s=this.getScale(e||[-0,-0,-0]),r=1/s[0],i=1/s[1],n=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*n,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const s=this.getScale(e||[-0,-0,-0]),r=1/s[0],i=1/s[1],n=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*n,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*n,t}transpose(){return function(t,e){if(t===e){var s=e[1],r=e[2],i=e[3],n=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=s,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=i,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return function(t,e){var s=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],h=e[6],c=e[7],l=e[8],u=e[9],d=e[10],g=e[11],_=e[12],m=e[13],f=e[14],p=e[15],v=s*o-r*a,b=s*h-i*a,y=s*c-n*a,w=r*h-i*o,T=r*c-n*o,x=i*c-n*h,E=l*m-u*_,S=l*f-d*_,M=l*p-g*_,N=u*f-d*m,A=u*p-g*m,R=d*p-g*f,C=v*R-b*A+y*N+w*M-T*S+x*E;C&&(C=1/C,t[0]=(o*R-h*A+c*N)*C,t[1]=(i*A-r*R-n*N)*C,t[2]=(m*x-f*T+p*w)*C,t[3]=(d*T-u*x-g*w)*C,t[4]=(h*M-a*R-c*S)*C,t[5]=(s*R-i*M+n*S)*C,t[6]=(f*y-_*x-p*b)*C,t[7]=(l*x-d*y+g*b)*C,t[8]=(a*A-o*M+c*E)*C,t[9]=(r*M-s*A-n*E)*C,t[10]=(_*T-m*y+p*v)*C,t[11]=(u*y-l*T-g*v)*C,t[12]=(o*S-a*N-h*E)*C,t[13]=(s*N-r*S+i*E)*C,t[14]=(m*b-_*w-f*v)*C,t[15]=(l*w-u*b+d*v)*C)}(this,this),this.check()}multiplyLeft(t){return E(this,t,this),this.check()}multiplyRight(t){return E(this,this,t),this.check()}rotateX(t){return function(t,e,s){var r=Math.sin(s),i=Math.cos(s),n=e[4],a=e[5],o=e[6],h=e[7],c=e[8],l=e[9],u=e[10],d=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*i+c*r,t[5]=a*i+l*r,t[6]=o*i+u*r,t[7]=h*i+d*r,t[8]=c*i-n*r,t[9]=l*i-a*r,t[10]=u*i-o*r,t[11]=d*i-h*r}(this,this,t),this.check()}rotateY(t){return function(t,e,s){var r=Math.sin(s),i=Math.cos(s),n=e[0],a=e[1],o=e[2],h=e[3],c=e[8],l=e[9],u=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*i-c*r,t[1]=a*i-l*r,t[2]=o*i-u*r,t[3]=h*i-d*r,t[8]=n*r+c*i,t[9]=a*r+l*i,t[10]=o*r+u*i,t[11]=h*r+d*i}(this,this,t),this.check()}rotateZ(t){return function(t,e,s){var r=Math.sin(s),i=Math.cos(s),n=e[0],a=e[1],o=e[2],h=e[3],c=e[4],l=e[5],u=e[6],d=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*i+c*r,t[1]=a*i+l*r,t[2]=o*i+u*r,t[3]=h*i+d*r,t[4]=c*i-n*r,t[5]=l*i-a*r,t[6]=u*i-o*r,t[7]=d*i-h*r}(this,this,t),this.check()}rotateXYZ([t,e,s]){return this.rotateX(t).rotateY(e).rotateZ(s)}rotateAxis(t,e){return function(t,e,s,r){var i,n,a,o,h,c,l,u,d,g,_,m,f,p,v,b,y,w,T,E,S,M,N,A,R=r[0],C=r[1],O=r[2],P=Math.hypot(R,C,O);P<x.Ib||(R*=P=1/P,C*=P,O*=P,i=Math.sin(s),a=1-(n=Math.cos(s)),o=e[0],h=e[1],c=e[2],l=e[3],u=e[4],d=e[5],g=e[6],_=e[7],m=e[8],f=e[9],p=e[10],v=e[11],b=R*R*a+n,y=C*R*a+O*i,w=O*R*a-C*i,T=R*C*a-O*i,E=C*C*a+n,S=O*C*a+R*i,M=R*O*a+C*i,N=C*O*a-R*i,A=O*O*a+n,t[0]=o*b+u*y+m*w,t[1]=h*b+d*y+f*w,t[2]=c*b+g*y+p*w,t[3]=l*b+_*y+v*w,t[4]=o*T+u*E+m*S,t[5]=h*T+d*E+f*S,t[6]=c*T+g*E+p*S,t[7]=l*T+_*E+v*S,t[8]=o*M+u*N+m*A,t[9]=h*M+d*N+f*A,t[10]=c*M+g*N+p*A,t[11]=l*M+_*N+v*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?S(this,this,t):S(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,s){var r,i,n,a,o,h,c,l,u,d,g,_,m=s[0],f=s[1],p=s[2];e===t?(t[12]=e[0]*m+e[4]*f+e[8]*p+e[12],t[13]=e[1]*m+e[5]*f+e[9]*p+e[13],t[14]=e[2]*m+e[6]*f+e[10]*p+e[14],t[15]=e[3]*m+e[7]*f+e[11]*p+e[15]):(r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],c=e[6],l=e[7],u=e[8],d=e[9],g=e[10],_=e[11],t[0]=r,t[1]=i,t[2]=n,t[3]=a,t[4]=o,t[5]=h,t[6]=c,t[7]=l,t[8]=u,t[9]=d,t[10]=g,t[11]=_,t[12]=r*m+o*f+u*p+e[12],t[13]=i*m+h*f+d*p+e[13],t[14]=n*m+c*f+g*p+e[14],t[15]=a*m+l*f+_*p+e[15])}(this,this,t),this.check()}transform(t,e){return 4===t.length?(e=function(t,e,s){var r=e[0],i=e[1],n=e[2],a=e[3];return t[0]=s[0]*r+s[4]*i+s[8]*n+s[12]*a,t[1]=s[1]*r+s[5]*i+s[9]*n+s[13]*a,t[2]=s[2]*r+s[6]*i+s[10]*n+s[14]*a,t[3]=s[3]*r+s[7]*i+s[11]*n+s[15]*a,t}(e||[-0,-0,-0,-0],t,this),(0,p.IL)(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:s}=t;switch(s){case 2:e=M(e||[-0,-0],t,this);break;case 3:e=A.fF(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return(0,p.IL)(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=(0,T.pb)(e||[-0,-0],t,this);break;case 3:e=(0,T.pL)(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return(0,p.IL)(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,s){return this.identity().translate([t,e,s])}transformPoint(t,e){return(0,p.x9)("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return(0,p.x9)("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return(0,p.x9)("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}var I=s(521);class F extends I.Z{constructor(t=0,e=0){super(2),(0,b.kJ)(t)&&1===arguments.length?this.copy(t):(b.vc.debug&&((0,p.u5)(t),(0,p.u5)(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return b.vc.debug&&((0,p.u5)(t.x),(0,p.u5)(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return M(this,this,t),this.check()}transformAsVector(t){return(0,T.pb)(this,this,t),this.check()}transformByMatrix3(t){return function(t,e,s){var r=e[0],i=e[1];t[0]=s[0]*r+s[3]*i+s[6],t[1]=s[1]*r+s[4]*i+s[7]}(this,this,t),this.check()}transformByMatrix2x3(t){return function(t,e,s){var r=e[0],i=e[1];t[0]=s[0]*r+s[2]*i+s[4],t[1]=s[1]*r+s[3]*i+s[5]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,s){var r=e[0],i=e[1];t[0]=s[0]*r+s[2]*i,t[1]=s[1]*r+s[3]*i}(this,this,t),this.check()}}const k=t=>t*Math.PI/180,D=(t,e)=>{if(t.a===t.b)throw new Error("The points are equal");if(0!==t.a&&0!==t.b){const s=-t.a/t.b,r=-t.c/t.b,i=1+s**2,n=-2*e.a-2*e.b*s+2*s*r,a=e.a**2+e.b**2-e.r**2+r**2-2*e.b*r,o=z({a:i,b:n,c:a});if(!o)return null;const h=K(t,o.v1);return{p1:new F(o.v1,h),p2:new F(o.v2,o.v1===o.v2?h:K(t,o.v2))}}if(0===t.a&&0!==t.b){const s=-t.c/t.b,r=1,i=-2*e.a,n=e.a**2+e.b**2-e.r**2+s**2-2*e.b*s,a=z({a:r,b:i,c:n});if(!a)return null;const o=K(t,a.v1);return{p1:new F(a.v1,o),p2:new F(a.v2,a.v1===a.v2?o:K(t,a.v2))}}const s=-t.c/t.a,r=-2*e.b,i=e.a**2+e.b**2-e.r**2+s**2-2*e.a*s,n=z({a:1,b:r,c:i});if(!n)return null;const a=Y(t,n.v1);return{p1:new F(a,n.v1),p2:new F(n.v1===n.v2?a:Y(t,n.v2),n.v2)}},j=(t,e)=>({a:t.y-e.y,b:e.x-t.x,c:t.x*e.y-t.y*e.x}),V=(t,e)=>({a:t.x,b:t.y,r:e instanceof F?t.distanceTo(e):e}),K=(t,e)=>(-t.a*e-t.c)/t.b,Y=(t,e)=>(-t.b*e-t.c)/t.a,z=t=>{const e=t.b**2-4*t.a*t.c;if(e<0)return null;const s=Math.sqrt(e),r=(-t.b+s)/(2*t.a);return{v1:r,v2:0===e?r:(-t.b-s)/(2*t.a)}};function Z(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const B=class{constructor(t,e,s){Z(this,"_entity",void 0),Z(this,"_translation",void 0),Z(this,"_rotation",void 0),Z(this,"_scale",void 0),Z(this,"_children",void 0),Z(this,"_parent",void 0),this._translation=t??new g.Z,this._rotation=e??new f.Z,this._scale=s??new g.Z(1,1,1)}setEntity(t){this._entity=t,this._children=new X(t.getName()+"_children")}get children(){return this._children}set parent(t){this._parent=t}get parent(){return this._parent}getTranslation(){return new g.Z(this._translation.x,this._translation.y,this._translation.z)}setTranslation(t){this._translation.x=t.x,this._translation.y=t.y,this._translation.z=t.z}setX(t){this._translation.x=t}setY(t){this._translation.y=t}setZ(t){this._translation.z=t}getX(){return this._translation.x}getY(){return this._translation.y}getZ(){return this._translation.z}getRotation(){return new f.Z(this._rotation.pitch,this._rotation.yaw,this._rotation.roll)}setRotation(t){this._fixRotation(t.pitch,(t=>{this._rotation.pitch=t})),this._fixRotation(t.yaw,(t=>{this._rotation.yaw=t})),this._fixRotation(t.roll,(t=>{this._rotation.roll=t}))}setPitch(t){this._fixRotation(t,(t=>{this._rotation.pitch=t}))}setYaw(t){this._fixRotation(t,(t=>{this._rotation.yaw=t}))}setRoll(t){this._fixRotation(t,(t=>{this._rotation.roll=t}))}getPitch(){return this._rotation.pitch}getYaw(){return this._rotation.yaw}getRoll(){return this._rotation.roll}_fixRotation(t,e){t>=360&&(t%=360,t-=360),t<=-360&&(t%=360,t+=360),e(t)}getScale(){return new g.Z(this._scale.x,this._scale.y,this._scale.z)}setScale(t){this._scale=t}toMatrix(){const t=(new L).translate(this._translation.clone().negate()),e=(new L).rotateX(k(this._rotation.pitch)),s=(new L).rotateY(k(this._rotation.yaw)),r=(new L).rotateZ(k(this._rotation.roll)),i=e.multiplyRight(s.multiplyRight(r)),n=(new L).scale(this._scale);return t.multiplyRight(i.multiplyRight(n))}toInversePositionMatrix(){const t=(new L).translate(this._translation.clone()),e=(new L).rotateX(k(this._rotation.pitch)),s=(new L).rotateY(k(this._rotation.yaw)),r=(new L).rotateZ(k(this._rotation.roll)),i=e.multiplyRight(s.multiplyRight(r)),n=(new L).scale(this._scale);return t.multiplyRight(i.multiplyRight(n))}worldMatrix(){const t=this.toMatrix();let e=t.clone();return this._parent&&(e=this._parent.worldMatrix().multiplyRight(t)),e}worldMatrixFrom(t){const e=(new L).translate(t.getTranslation()),s=(new L).rotateX(k(t.getPitch())),r=(new L).rotateY(k(t.getYaw())),i=(new L).rotateZ(k(t.getRoll())),n=s.multiplyRight(r.multiplyRight(i)),a=(new L).scale(t.getScale());return e.multiplyRight(n.multiplyRight(a))}worldTranslation(){let t=this._translation.clone();return this._parent&&(t=this._parent.worldTranslation().add(t)),t}};function U(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class H{constructor(t,e,s,r){U(this,"_name",void 0),U(this,"_vao",void 0),U(this,"_material",void 0),U(this,"_renderer",void 0),U(this,"_transform",void 0),U(this,"_scene",void 0),H._listEntities.set(t,this),this._name=t,this._vao=e,this._material=s,this._renderer=r,this._transform=new B,this.getTransform().setEntity(this)}static Find(t){return H._listEntities.get(t)}render(){}setVAO(t){this._vao=t}setMaterial(t){this._material=t}setRenderer(t){this._renderer=t}getVAO(){return this._vao}getMaterial(){return this._material}getRenderer(){return this._renderer}getName(){return this._name}getTransform(){return this._transform}setScene(t){this._scene=t}getScene(){return this._scene}}U(H,"_listEntities",new Map);const G=H;function W(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const X=class{constructor(t){W(this,"_name",void 0),W(this,"_entities",void 0),W(this,"_visible",void 0),W(this,"_hidden",void 0),W(this,"_renderStrategy",void 0),W(this,"_keys",(t=>[...t.keys()])),this._name=t,this._entities=new Map,this._visible=new Map,this._hidden=new Map,this._renderStrategy=new class{constructor(){var t,e;e=void 0,(t="_renderers")in this?Object.defineProperty(this,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):this[t]=e,this._renderers=new Map}render(t){this._renderers.forEach((e=>{e.setScene(t),e.render()}))}add(t,e=!1){const s=this._validate(t);this._renderers.set(s,t)}remove(t){const e=this._validate(t,!1);this._renderers.delete(e)}get(t){return this._validate(t,!1),this._renderers.get(t)}getKeys(){return[...this._renderers.keys()]}forEach(t){this._renderers.forEach(((e,s)=>{t(e,s)}))}has(t){const e=this._getName(t);return this._renderers.has(e)}_validate(t,e=!0){const s=this._getName(t);if(e&&this._renderers.has(s))throw new Error(`Renderer ${s} already exists!`);if(!e&&!this._renderers.has(s))throw new Error(`Renderer ${s} does not exists!`);return s}_getName(t){return t instanceof m?t.getName():t}}}update(t,e){this.forEachVisible((s=>{s.update(t,e)}))}render(){this._renderStrategy.render(this)}add(t,e=!0){return this._validate(t,this._entities),t.setScene(this),this._entities.set(t.getName(),t),e?this._visible.set(t.getName(),t):this._hidden.set(t.getName(),t),this}remove(t){const e=this._validate(t,this._entities,!1);return this._entities.delete(e),this._visible.has(e)&&this._visible.delete(e),this._hidden.has(e)&&this._hidden.delete(e),this}setVisibility(t,e){const s=this._validate(t,this._entities,!1);return e?(this._visible.set(s,this._hidden.get(s)),this._hidden.delete(s)):(this._hidden.set(s,this._visible.get(s)),this._visible.delete(s)),this}get(t){return this._validate(t,this._entities,!1),this._entities.get(t)}getKeys(){return this._keys(this._entities)}getKeysFromVisible(){return this._keys(this._visible)}getKeysFromHidden(){return this._keys(this._hidden)}forEach(t){return this._forEach(t,this._entities),this}forEachVisible(t){return this._forEach(t,this._visible),this}forEachHidden(t){return this._forEach(t,this._hidden),this}_forEach(t,e){e.forEach(t)}has(t){return this._has(t,this._entities)}hasInVisible(t){return this._has(t,this._visible)}hasInHidden(t){return this._has(t,this._hidden)}_has(t,e){const s=this._getName(t);return e.has(s)}filterVisible(t){const e=[];return this._visible.forEach((s=>{t(s)&&e.push(s)})),e}_validate(t,e,s=!0){const r=this._getName(t);if(s&&e.has(r))throw new Error(`Entity ${r} already exists!`);if(!s&&!e.has(r))throw new Error(`Entity ${r} does not exists!`);return r}_getName(t){return t instanceof G?t.getName():t}getName(){return this._name}get entities(){return this._entities}getRenderStrategy(){return this._renderStrategy}};var q=s(355);function $(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Q=class{static load(t,e,s){const r=new XMLHttpRequest;r.open("GET",t,!1),r.onload=()=>e(r.responseText),r.onerror=()=>s(r.statusText),r.send(null)}static async loadAsync(t){let e;return await fetch(t).then((t=>t.body)).then((async t=>{e=t.getReader()})),e.read().then((t=>(new TextDecoder).decode(t.value)))}};function J(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function tt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const et=class{constructor(t,e,s,i=r.STATIC_DRAW){tt(this,"_id",void 0),tt(this,"_buffer",void 0),tt(this,"_offset",void 0),tt(this,"_created",void 0),tt(this,"_isAttribute",void 0),tt(this,"_usage",void 0),this._buffer=t,this._offset=e,this._created=!1,this._isAttribute=s,this._usage=i}getUsage(){return this._usage}getId(){return this._id}setId(t){this._id=t}getBuffer(){return this._buffer}setBuffer(t){this._buffer=t}getOffset(){return this._offset}setCreated(t){this._created=t}isCreated(){return this._created}getType(){return this._isAttribute?r.ARRAY_BUFFER:r.ELEMENT_ARRAY_BUFFER}getLength(){return this._buffer.length}};function st(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const rt=class{constructor(t,e=3){st(this,"_vboList",void 0),st(this,"_ibo",void 0),st(this,"_vertexCoordsOffset",void 0),this._vboList=[],t.forEach((t=>{null!=t&&(this._vboList.push(t),t.getType()===r.ELEMENT_ARRAY_BUFFER&&(this._ibo=t))})),t.length>0&&!this._ibo&&(this._ibo=t[0]),this._vertexCoordsOffset=e}addEmpty(t){const e=[];for(let s=0;s<t;s++)e.push(new et(new Float32Array([]),2,!0,r.DYNAMIC_DRAW));this._vboList=e,this._ibo=this._vboList[0]}create(){for(let t=0;t<this._vboList.length;t++)this._createVBO(t,this._vboList[t])}_createVBO(t,e){null==e.getId()&&e.setId(r.createBuffer()),r.bindBuffer(e.getType(),e.getId()),e.getBuffer().length>0&&r.bufferData(e.getType(),e.getBuffer(),e.getUsage()),e.getType()===r.ARRAY_BUFFER&&this._setAttributePointer(t,e),r.bindBuffer(e.getType(),void 0)}bind(){for(let t=0;t<this._vboList.length;t++)r.bindBuffer(this._vboList[t].getType(),this._vboList[t].getId()),this._vboList[t].getType()!==r.ELEMENT_ARRAY_BUFFER&&(this._setAttributePointer(t,this._vboList[t]),r.enableVertexAttribArray(t))}unbind(){for(let t=this._vboList.length-1;t>=0;t--)r.bindBuffer(this._vboList[t].getType(),this._vboList[t].getId()),this._vboList[t].getType()!==r.ELEMENT_ARRAY_BUFFER&&r.disableVertexAttribArray(t)}destroy(){for(let t=this._vboList.length-1;t>=0;t--)r.deleteBuffer(this._vboList[t].getId())}_setAttributePointer(t,e){const s=s=>{r.vertexAttribPointer(t,e.getOffset(),s,!1,0,0)};e.getBuffer()instanceof Int8Array&&s(r.BYTE),e.getBuffer()instanceof Int16Array&&s(r.SHORT),e.getBuffer()instanceof Int32Array&&s(r.INT),e.getBuffer()instanceof Uint8Array&&s(r.UNSIGNED_BYTE),e.getBuffer()instanceof Uint16Array&&s(r.UNSIGNED_SHORT),e.getBuffer()instanceof Uint32Array&&s(r.UNSIGNED_INT),e.getBuffer()instanceof Float32Array&&s(r.FLOAT)}getVbo(t){return this._vboList[t]}getIbo(){return this._ibo}getLength(){return this._ibo?this._ibo.getLength()/this._vertexCoordsOffset:0}};var it=s(847),nt=s.n(it);const at=class{load(t){let e=null;return Q.load(t,(function(t){const s=new(nt())(t).parse(),r=[],i=[],n=[],a=[];s.models[0].faces.forEach((t=>{const e=t.vertices[0].vertexIndex-1,r=t.vertices[1].vertexIndex-1,o=t.vertices[2].vertexIndex-1;if(i.push(s.models[0].vertices[e].x),i.push(s.models[0].vertices[e].y),i.push(s.models[0].vertices[e].z),i.push(s.models[0].vertices[r].x),i.push(s.models[0].vertices[r].y),i.push(s.models[0].vertices[r].z),i.push(s.models[0].vertices[o].x),i.push(s.models[0].vertices[o].y),i.push(s.models[0].vertices[o].z),s.models[0].vertexNormals&&s.models[0].vertexNormals.length>0){const e=t.vertices[0].vertexNormalIndex-1,r=t.vertices[1].vertexNormalIndex-1,i=t.vertices[2].vertexNormalIndex-1;n.push(s.models[0].vertexNormals[e].x),n.push(s.models[0].vertexNormals[e].y),n.push(s.models[0].vertexNormals[e].z),n.push(s.models[0].vertexNormals[r].x),n.push(s.models[0].vertexNormals[r].y),n.push(s.models[0].vertexNormals[r].z),n.push(s.models[0].vertexNormals[i].x),n.push(s.models[0].vertexNormals[i].y),n.push(s.models[0].vertexNormals[i].z)}if(s.models[0].textureCoords&&s.models[0].textureCoords.length>0){const e=t.vertices[0].textureCoordsIndex-1,r=t.vertices[1].textureCoordsIndex-1,i=t.vertices[2].textureCoordsIndex-1;a.push(s.models[0].textureCoords[e].u),a.push(s.models[0].textureCoords[e].v),a.push(s.models[0].textureCoords[r].u),a.push(s.models[0].textureCoords[r].v),a.push(s.models[0].textureCoords[i].u),a.push(s.models[0].textureCoords[i].v)}})),r.push(new et(new Float32Array(i),3,!0)),n.length>0&&r.push(new et(new Float32Array(n),3,!0)),a.length>0&&r.push(new et(new Float32Array(a),2,!0)),e=new rt(r)}),(function(e){throw new Error(`Error trying to load object data: ${t}.\n ${e}`)})),e}loadHitboxes(t){let e;return Q.load(t,(function(t){e=JSON.parse(t)}),(function(e){throw new Error(`Error trying to load hitbox data: ${t}.\n ${e}`)})),e}};function ot(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const ht=class{constructor(t=0,e=0,s=null){ot(this,"_program",void 0),ot(this,"_width",void 0),ot(this,"_height",void 0),ot(this,"_created",void 0),ot(this,"_data",void 0),this._width=t,this._height=e,this._data=s,this._created=!1;const r=setInterval((()=>{this._created&&this._data&&(this._bindData(),clearInterval(r))}),100)}create(){if(!this._created){if(this._program=r.createTexture(),this._data&&this._bindData(),(this._width<1||this._height<1)&&this._data)throw new Error("Invalid image size!");this._created=!0}}bind(){r.bindTexture(r.TEXTURE_2D,this._program),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,1),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)}unbind(){r.bindTexture(r.TEXTURE_2D,null)}destroy(){r.deleteTexture(this._program),this._created=!1}getWidth(){return this._width}getHeight(){return this._height}setWidth(t){this._width=t}setHeight(t){this._height=t}getData(){return this._data}setData(t){t&&(delete this._data,this._data=t),this._created&&this._bindData()}_bindData(){this.bind(),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this._width,this._height,0,r.RGBA,r.UNSIGNED_BYTE,this._data)}getProgram(){return this._program}},ct=class{load(t,e){const s=new ht,r=new Image;return r.onload=()=>{s.setWidth(r.naturalWidth),s.setHeight(r.naturalHeight);const t=document.createElement("canvas");t.width=r.naturalWidth,t.height=r.naturalHeight;const i=t.getContext("2d");i.drawImage(r,0,0,r.naturalWidth,r.naturalHeight);const n=new Uint8Array(i.getImageData(0,0,r.naturalWidth,r.naturalHeight).data);s.setData(n),e&&e(s)},r.onerror=e=>{throw new Error(`Error trying to load image: ${t}.\n ${e}`)},r.src=t,s}};function lt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class ut{constructor(){lt(this,"_shaders",void 0),lt(this,"_vaos",void 0),lt(this,"_textures",void 0),lt(this,"_materials",void 0),this._shaders=new Map,this._vaos=new Map,this._textures=new Map,this._materials=new Map}static getInstance(){return ut._instance||(ut._instance=new ut),ut._instance}static loadVAO(t){return ut.getInstance().loadVAO(t)}loadVAO(t){return t.forEach((t=>{if(this._vaos.has(t.name))throw new Error(`Shader '${t.name}' already exists!`);"string"!=typeof t.objectData?"function"!=typeof t.objectData?this._vaos.set(t.name,new rt(t.objectData)):this._vaos.set(t.name,t.objectData()):this._vaos.set(t.name,(new at).load(t.objectData))})),this}static getVAO(t){return ut.getInstance().getVAO(t)}getVAO(t){return this._vaos.get(t)}static forEachVAO(t){return ut.getInstance().forEachVAO(t)}forEachVAO(t){return this._vaos.forEach(t),this}static loadShader(t){return ut.getInstance().loadShader(t)}loadShader(t){return t.forEach((t=>{if(this._shaders.has(t.name))throw new Error(`Shader '${t.name}' already exists!`);this._shaders.set(t.name,new class{constructor(t){J(this,"_name",void 0),J(this,"_vertexShaderPathname",void 0),J(this,"_fragmentShaderPathname",void 0),J(this,"_program",void 0),J(this,"_textureCounter",void 0),J(this,"_created",void 0),this._name=t.name,this._vertexShaderPathname=t.vertexShaderPathname,this._fragmentShaderPathname=t.fragmentShaderPathname,this._textureCounter=0,this._created=!1}create(){if(!this._created){this._program=r.createProgram();const t=this.load(this._vertexShaderPathname,r.VERTEX_SHADER),e=this.load(this._fragmentShaderPathname,r.FRAGMENT_SHADER);r.attachShader(this._program,t),r.attachShader(this._program,e),r.linkProgram(this._program);const s=r.getProgramInfoLog(this._program).trim();if(""!==s)throw new Error(`Error trying to link shader: ${this._name}.\n ${s}`);this._created=!0}}load(t,e){const s=r.createShader(e);Q.load(t,(function(t){r.shaderSource(s,t)}),(function(e){throw new Error(`Error trying to load shader: ${t}.\n ${e}`)})),r.compileShader(s);const i=r.getShaderInfoLog(s).trim();if(""!==i)throw new Error(`Error trying to compile shader: ${t}.\n ${i}`);return s}bind(){r.useProgram(this._program),this._textureCounter=0}unbind(){r.useProgram(null)}destroy(){r.deleteShader(this._program),this._created=!1}getUniformLocation(t){return r.getUniformLocation(this._program,t)}_checkIfUniformExists(t,e){const s=r.getUniformLocation(this._program,t);if(-1===s)throw new Error(`Uniform '${t}' does not exist in shader: ${this._name}`);e(s)}setInt(t,e){this._checkIfUniformExists(t,(t=>r.uniform1i(t,e)))}setIntArray(t,e){this._checkIfUniformExists(t,(t=>r.uniform1iv(t,new Int32Array(e))))}setFloat(t,e){this._checkIfUniformExists(t,(t=>r.uniform1f(t,e)))}setFloatArray(t,e){this._checkIfUniformExists(t,(t=>r.uniform1fv(t,new Float32Array(e))))}setVector3(t,e){this._checkIfUniformExists(t,(t=>r.uniform3fv(t,e)))}setVector4(t,e){this._checkIfUniformExists(t,(t=>r.uniform4fv(t,e)))}setMatrix4x4(t,e){this._checkIfUniformExists(t,(t=>r.uniformMatrix4fv(t,!1,e)))}setTexture(t){this._checkIfUniformExists(t,(t=>{r.activeTexture(r.TEXTURE0+this._textureCounter),r.uniform1i(t,this._textureCounter),this._textureCounter++}))}getName(){return this._name}}(t))})),this}static getShader(t){return ut.getInstance().getShader(t)}getShader(t){return this._shaders.get(t)}static forEachShader(t){return ut.getInstance().forEachShader(t)}forEachShader(t){return this._shaders.forEach(t),this}static loadTextures(t){return ut.getInstance().loadTextures(t)}loadTextures(t){return t.forEach((t=>{if(this._textures.has(t.name))throw new Error(`Texture '${t.name}' already exists!`);null!=t.texture?"function"!=typeof t.texture?this._textures.set(t.name,t.texture):this._textures.set(t.name,t.texture()):this._textures.set(t.name,(new ct).load(t.pathname))})),this}static getTexture(t){return ut.getInstance().getTexture(t)}getTexture(t){return this._textures.get(t)}static forEachTexture(t){return ut.getInstance().forEachTexture(t)}forEachTexture(t){return this._textures.forEach(t),this}static addMaterials(t){return ut.getInstance().addMaterials(t)}addMaterials(t){return t.forEach((t=>{if(this._materials.has(t.getName()))throw new Error(`Material '${t.getName()}' already exists!`);this._materials.set(t.getName(),t)})),this}static getMaterial(t){return ut.getInstance().getMaterial(t)}getMaterial(t){return this._materials.get(t)}static forEachMaterial(t){return ut.getInstance().forEachMaterial(t)}forEachMaterial(t){return this._materials.forEach(t),this}}lt(ut,"_instance",void 0);const dt=ut,gt=class extends G{constructor(t,e,s,r){var i,n;super(t,e,s,r),n=void 0,(i="_lampList")in this?Object.defineProperty(this,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[i]=n,this._lampList=[]}update(t,e){}setLampList(t){this._lampList=t}getLampList(){return this._lampList}};function _t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const mt=class extends gt{constructor(t,e,s){super(t,dt.getVAO("lamp"),dt.getMaterial("lamp"),e),_t(this,"color",void 0),_t(this,"distance",100),_t(this,"shininess",32),this.color=s}update(t,e){}},ft=class extends G{constructor(t,e,s,r,i){var n,a;super(t,s,r,i),a=void 0,(n="_hitbox")in this?Object.defineProperty(this,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):this[n]=a,this._hitbox=e}setHitbox(t){this._hitbox=t}getHitbox(){return this._hitbox}},pt=class extends ft{constructor(t,e,s,r,i,n){var a,o;super(t,e,r,i,n),o=void 0,(a="_friction")in this?Object.defineProperty(this,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[a]=o,this._friction=s}setFriction(t){this._friction=t}getFriction(){return this._friction}},vt=class extends pt{constructor(t,e,s,r,i,n){var a,o;super(t,e,s,r,i,n),o=void 0,(a="_lampList")in this?Object.defineProperty(this,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[a]=o,this._lampList=[]}update(t,e){}setLampList(t){this._lampList=t}getLampList(){return this._lampList}};function bt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const yt=class{constructor(t,e=d.CANVAS.width,s=d.CANVAS.height){bt(this,"_fbo",void 0),bt(this,"_rbo",void 0),bt(this,"_attachment",void 0),bt(this,"_texture",void 0),this._attachment=t,this._texture=new ht(e,s)}bindTexture(){r.bindTexture(r.TEXTURE_2D,this._texture.getProgram()),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this._texture.getWidth(),this._texture.getHeight(),0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)}create(){r.viewport(0,0,this._texture.getWidth(),this._texture.getHeight()),this._fbo=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,this._fbo),this._texture.create(),this.bindTexture(),r.framebufferTexture2D(r.FRAMEBUFFER,this._attachment,r.TEXTURE_2D,this._texture.getProgram(),0),this._rbo=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,this._rbo),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,this._texture.getWidth(),this._texture.getHeight()),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this._rbo),r.checkFramebufferStatus(r.FRAMEBUFFER)!=r.FRAMEBUFFER_COMPLETE&&console.log("Error at Framebuffer setting."),r.bindFramebuffer(r.FRAMEBUFFER,null)}bind(){r.bindFramebuffer(r.FRAMEBUFFER,this._fbo),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)}unbind(){this._texture.unbind(),r.viewport(0,0,d.CANVAS.width,d.CANVAS.height),r.bindFramebuffer(r.FRAMEBUFFER,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)}destroy(){r.deleteFramebuffer(this._fbo),r.deleteRenderbuffer(this._rbo)}storeBuffer(){const t=new Uint8Array(this._texture.getWidth()*this._texture.getHeight()*4);r.readPixels(0,0,this._texture.getWidth(),this._texture.getHeight(),r.RGBA,r.UNSIGNED_BYTE,t),this._texture.setData(t)}getTexture(){return this._texture}getAttachemnt(){return this._attachment}};function wt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Tt extends m{constructor(t,e){super("frameRenderer",t),wt(this,"_mode",void 0),wt(this,"_frameBuffer",void 0),wt(this,"_shader",void 0),wt(this,"_vao",void 0),wt(this,"_buffers",[]),this._mode=e,this._frameBuffer=new yt(r.COLOR_ATTACHMENT0),this._frameBuffer.create(),this._shader=dt.getShader("effect"),this._shader.create(),this._vao=dt.getVAO("effect"),this._buffers.push(new yt(r.COLOR_ATTACHMENT0)),this._buffers.push(new yt(r.COLOR_ATTACHMENT0)),this._buffers[0].create(),this._buffers[1].create()}get _texture(){return this._frameBuffer.getTexture()}get attachemnt(){return this._frameBuffer.getAttachemnt()}static get mode(){return Tt._modeStatic}bind(){this._frameBuffer.bind(),Tt._modeStatic=this._mode}render(){this._shader.bind(),r.activeTexture(r.TEXTURE0),this._texture.bind(),this._shader.setInt("u_texture",0),this._vao.bind();const t=this._shader;if(t.setInt("mode","mascara"==this._mode?1:0),"albedo"==this._mode)Tt._texture=this._texture;else{t.setFloat("weight[0]",.227027),t.setFloat("weight[1]",.1945946),t.setFloat("weight[2]",.1216216),t.setFloat("weight[3]",.054054),t.setFloat("weight[4]",.016216),t.setFloat("sizeTexture[0]",this._texture.getWidth()),t.setFloat("sizeTexture[1]",this._texture.getHeight());let e=!0,s=!0,i=10;for(let r=0;r<i;r++)this._buffers[Number(e)].bind(),t.setInt("horizontal",Number(e)),s||this._buffers[Number(!e)].getTexture().bind(),this.draw(),this._buffers[Number(e)].unbind(),e=!e,s&&(s=!1);t.setInt("mode",2),r.activeTexture(r.TEXTURE0),Tt._texture.bind(),this._shader.setInt("u_texture",0),r.activeTexture(r.TEXTURE1),this._buffers[Number(!e)].getTexture().bind(),this._shader.setInt("u_mascara",1),this.draw(),Tt._modeStatic="albedo"}this._vao.unbind(),this._texture.unbind(),this._shader.unbind()}draw(){r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),i.draw(this._vao.getLength())}unbind(){this._frameBuffer.unbind()}}wt(Tt,"_modeStatic",void 0),wt(Tt,"_texture",void 0);const xt=Tt;function Et(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class St{constructor(t,e){Et(this,"_transform",void 0),this._transform=new B(t,e),St._mainCamera=this}static get Main(){return this._mainCamera}static setMainCamera(t){this._mainCamera=t}getTransform(){return this._transform}getView(){const t=(new L).translate(this._transform.getTranslation().negate()),e=this._transform.getRotation(),s=(new L).rotateX(k(e.pitch)),r=(new L).rotateY(k(e.yaw)),i=(new L).rotateZ(k(e.roll)).multiplyRight(r.multiplyRight(s));return t.multiplyRight(i).invert()}}Et(St,"_mainCamera",void 0);const Mt=St;function Nt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class At{constructor(t,e,s){Nt(this,"name",void 0),Nt(this,"_audio",void 0),Nt(this,"_translation",void 0),At.Sounds[t]=this,this.name=t,this._audio=new Audio(e),this._audio.loop=s?.loop??!1,this._audio.autoplay=s?.autoplay??!1,this._audio.volume=(s?.volume??100)/100,this._audio.pause()}setTranslation(t){this._translation=t}getTranslation(){return this._translation}play(t=!1,e=!1,s){if(!e&&!this._audio.paused)return;e&&(this._audio.pause(),this._audio.currentTime=0),this._audio.loop=t;const r=this._audio.play();if(s){const t=setInterval((()=>{this._audio.paused&&clearInterval(t);const e=s.subtract(Mt.Main.getTransform().getTranslation()),r=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2));this._audio.volume=1/(1+.022*r+r*r*.0019)}),1e3)}const i=setInterval((()=>{this._audio.paused&&(this._audio.currentTime=0,clearInterval(i))}),1e3);return r}pause(){this._audio.pause(),this._audio.currentTime=0}static Find(t){return At.Sounds[t]}static pauseAll(){Object.keys(At.Sounds).map((t=>{At.Sounds[t].pause()}))}}Nt(At,"Sounds",{});const Rt=At;function Ct(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Ot=class extends G{constructor(t,e,s,r){super(t,e,s,r),Ct(this,"size",void 0),Ct(this,"color",new g.Z(.3,.3,.3)),Ct(this,"alpha",.1),this.size=new F(1,1)}DrawRectangle(){this.getVAO().getIbo().setBuffer(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.getVAO().create()}setSize(t,e){this.getTransform().setScale(new g.Z(t,e,1))}getSize(){const t=this.getTransform().getScale();return{width:t[0],height:t[1]}}updatePosition(t,e="Razor"){const{width:s,height:r}=this.getSize(),i={width:"Razor"==e?d.CANVAS.width:e.getScale()[0],height:"Razor"==e?d.CANVAS.height:e.getScale()[1]};let n=0,a=0;switch(t.vertical){case"center":case"bottom":n=i.height,"bottom"==t.vertical&&(n=-r),"center"==t.vertical&&(n=n/2-r/2);break;case"top":break;default:const[,e,s]=t.vertical.split(/([0-9]+)(px|%)/);n="px"==s?Number(e):i.height*Number(e)/100}switch(t.horizontal){case"center":case"right":a=i.width,"right"==t.horizontal&&(a-=s),"center"==t.horizontal&&(a=a/2-s/2);break;case"left":break;default:const[,e,r]=t.vertical.split(/([0-9]+)(px|%)/);a="px"==r?Number(e):i.width*Number(e)/100}this.getTransform().setTranslation(new g.Z(a,n,0).negate())}setAlpha(t){return this.alpha=t}update(t,e){}};class Pt{static render(t){const e=this.fontInfo;for(var s=t.length,r=6*s,i=new Float32Array(2*r),n=new Float32Array(2*r),a=0,o=0,h=e.textureWidth,c=e.textureHeight,l=0;l<s;++l){var u=t[l],d=e.glyphInfos[u];if(d){var g=o+d.width,_=d.x/h,m=(d.y+e.letterHeight-1)/c,f=(d.x+d.width-1)/h,p=d.y/c;i[a+0]=o,i[a+1]=0,n[a+0]=_,n[a+1]=p,i[a+2]=g,i[a+3]=0,n[a+2]=f,n[a+3]=p,i[a+4]=o,i[a+5]=e.letterHeight,n[a+4]=_,n[a+5]=m,i[a+6]=o,i[a+7]=e.letterHeight,n[a+6]=_,n[a+7]=m,i[a+8]=g,i[a+9]=0,n[a+8]=f,n[a+9]=p,i[a+10]=g,i[a+11]=e.letterHeight,n[a+10]=f,n[a+11]=m,o+=d.width+e.spacing,a+=12}else o+=e.spaceWidth}return{arrays:{position:new Float32Array(i.buffer,0,a),texcoord:new Float32Array(n.buffer,0,a)},numVertices:a/2}}}var Lt,It,Ft;Ft={letterHeight:8,spaceWidth:8,spacing:-1,textureWidth:64,textureHeight:40,glyphInfos:{a:{x:0,y:0,width:8},b:{x:8,y:0,width:8},c:{x:16,y:0,width:8},d:{x:24,y:0,width:8},e:{x:32,y:0,width:8},f:{x:40,y:0,width:8},g:{x:48,y:0,width:8},h:{x:56,y:0,width:8},i:{x:0,y:8,width:8},j:{x:8,y:8,width:8},k:{x:16,y:8,width:8},l:{x:24,y:8,width:8},m:{x:32,y:8,width:8},n:{x:40,y:8,width:8},o:{x:48,y:8,width:8},p:{x:56,y:8,width:8},q:{x:0,y:16,width:8},r:{x:8,y:16,width:8},s:{x:16,y:16,width:8},t:{x:24,y:16,width:8},u:{x:32,y:16,width:8},v:{x:40,y:16,width:8},w:{x:48,y:16,width:8},x:{x:56,y:16,width:8},y:{x:0,y:24,width:8},z:{x:8,y:24,width:8},0:{x:16,y:24,width:8},1:{x:24,y:24,width:8},2:{x:32,y:24,width:8},3:{x:40,y:24,width:8},4:{x:48,y:24,width:8},5:{x:56,y:24,width:8},6:{x:0,y:32,width:8},7:{x:8,y:32,width:8},8:{x:16,y:32,width:8},9:{x:24,y:32,width:8},"-":{x:32,y:32,width:8},"*":{x:40,y:32,width:8},"!":{x:48,y:32,width:8},"?":{x:56,y:32,width:8}}},(It="fontInfo")in(Lt=Pt)?Object.defineProperty(Lt,It,{value:Ft,enumerable:!0,configurable:!0,writable:!0}):Lt[It]=Ft;const kt=Pt;function Dt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const jt=class extends G{constructor(t,e,s){super(t,null,e,s),Dt(this,"_oldText",""),Dt(this,"_currentText","");const r=new rt([],2);r.addEmpty(2),r.create(),this.setVAO(r)}setText(t){this._currentText=t}render(){if(this._currentText==this._oldText)return;const t=kt.render(this._currentText);this.getVAO().getVbo(0).setBuffer(t.arrays.position),this.getVAO().getVbo(1).setBuffer(t.arrays.texcoord),this.getVAO().create(),this._oldText=this._currentText}getSize(){const t=this.getTransform().getScale();return{width:t[0],height:t[1]}}updatePosition(t,e="Razor"){const{width:s,height:r}=this.getSize(),i={width:"Razor"==e?d.CANVAS.width:e.getTranslation().negate().x,height:"Razor"==e?d.CANVAS.height:e.getTranslation().negate().y,z:"Razor"==e?1:e.getTranslation().negate().z-2};let n=0,a=0;switch("Razor"!=e&&(n=i.height,a=i.width,console.log(i)),t.vertical){case"center":case"bottom":n=i.height,"bottom"==t.vertical&&(n=-r),"center"==t.vertical&&(n=n/2-r/2);break;case"top":break;default:const[,e,s]=t.vertical.split(/([0-9]+)(px|%)/);n="px"==s?Number(e):i.height*Number(e)/100}switch(t.horizontal){case"center":case"right":a=i.width,"right"==t.horizontal&&(a-=s),"center"==t.horizontal&&(a=a/2-s/2);break;case"left":break;default:const[,e,r]=t.horizontal.split(/([0-9]+)(px|%)/);a="px"==r?Number(e):i.width*Number(e)/100}this.getTransform().setTranslation(new g.Z(a,n,i.z).negate())}update(t,e){}},Vt=class extends G{constructor(t,e){super(t,null,null,e)}addRectangle(t){const e=new Ot(t,dt.getVAO("rectangle"),dt.getMaterial("rectangle"),this.getRenderer());e.getTransform().parent=this.getTransform();const s=this.getScene();return e.setScene(s),s.add(e),e}addText(t){const e=new jt(t,dt.getMaterial("text"),this.getRenderer());return e.getTransform().parent=this.getTransform(),this.getScene().add(e),e}update(t,e){}};function Kt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Yt extends Vt{constructor(t,e){super(t,e),Kt(this,"_text",void 0),Kt(this,"_rectangle",void 0),Kt(this,"paddingTop",5),Kt(this,"paddingLeft",5),Yt._dialogs.set(t,this)}static getDialog(t){return Yt._dialogs.get(t)}init(t=new g.Z(.9,.9,.9)){this._rectangle=this.addRectangle(this.getName()+"_rectangle_left"),this._rectangle.color=t,this._rectangle.getTransform().parent=this.getTransform(),this._text=this.addText(this.getName()+"_text_rectangle_left"),this._text.setText(""),this._text.getTransform().setTranslation(new g.Z(this.paddingLeft,this.paddingTop,1).negate()),this._text.getTransform().setScale(new g.Z(2,2,2))}setImage(t){t.getTransform().setTranslation(new g.Z(0,0,1).negate()),t.getTransform().setScale(new g.Z(.09,.09,1)),this.getScene().add(t),t.getTransform().parent=this.getTransform()}remove(){this._text.setText(""),this._rectangle.setSize(0,0)}updateText(t,e){this._text.setText(t);const s=t.toLowerCase().replace(/ /g,"").replace(/[^\w-]+/g,"").length,r=Math.abs(t.length-s)-2,i=16*s+2*this.paddingLeft+8*r,n=16+2*this.paddingTop;this._rectangle.setSize(i,n),this.updatePosition(e)}updatePosition(t){const{width:e,height:s}=this._rectangle.getSize();let r=0,i=0;switch(t.vertical){case"center":case"bottom":r=d.CANVAS.height,"bottom"==t.vertical&&(r=-s),"center"==t.vertical&&(r=r/2-s/2);break;case"top":break;default:const[,e,i]=t.vertical.split(/([0-9]+)(px|%)/);r="px"==i?Number(e):d.CANVAS.height*Number(e)/100}switch(t.horizontal){case"center":case"right":i=d.CANVAS.width,"right"==t.horizontal&&(i-=e),"center"==t.horizontal&&(i=i/2-e/2);break;case"left":break;default:const[,s,r]=t.vertical.split(/([0-9]+)(px|%)/);i="px"==r?Number(s):d.CANVAS.width*Number(s)/100}this.getTransform().setTranslation(new g.Z(i,r,0).negate())}animateText(t,e=1,s,r){let i=1;const n=t.length,a=setInterval((()=>{i==n&&(r&&r.apply(this),clearInterval(a)),this.updateText(t.slice(0,i++),s)}),1/e*1e3)}update(t,e){}}Kt(Yt,"_dialogs",new Map);const zt=Yt;function Zt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Bt=class extends ft{constructor(t,e,s,r,i,n){super(t,e,r,i,n),Zt(this,"_mass",void 0),Zt(this,"_force",void 0),Zt(this,"_speed",void 0),this._mass=s,this._force=new g.Z(0,0,0),this._speed=new g.Z(0,0,0)}updateSpeed(t){this._force.exactEquals([0,0,0])||this.updateSpeedByAcceleration(this._force.divideScalar(this._mass).multiplyByScalar(t))}updateSpeedByAcceleration(t){this._speed.add(t)}setMass(t){this._mass=t}getMass(){return this._mass}setForce(t){this._force=t}getForce(){return this._force}setSpeed(t){this._speed=t}getSpeed(){return this._speed}};function Ut(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Ht{static setDisplay(t,e,s){this["_"+t]={display:e,value:100},e.setText(String(100),s)}static isAmmunition(){return 0!=this.ammunition}static isLife(){return 0!=this.life}static get life(){return this._life.value}static get ammunition(){return this._ammunition.value}static update(t,e){const s=this["_"+t];s.value+=e,s.value<0&&(s.value=0),this["_"+t]=s,s.display.updateText(s.value),"life"==t&&0==s.value&&es.getInstance().setScene("gameover")}}Ut(Ht,"_life",void 0),Ut(Ht,"_ammunition",void 0);const Gt=Ht,Wt=class{constructor(){!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_collisionDisabled",void 0),this._collisionDisabled=!1}isCollisionDisabled(){return this._collisionDisabled}disableCollision(t){this._collisionDisabled=t}},Xt=class extends Wt{constructor(t){super(),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_radius",void 0),this._radius=t}getRadius(){return this._radius}};function qt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const $t=class extends Bt{constructor(t,e,s){super(t,new Xt(1),1,dt.getVAO("monster"),dt.getMaterial("monster"),e),qt(this,"_lampList",void 0),qt(this,"_health",void 0),qt(this,"_impulse",void 0),qt(this,"_path",void 0),qt(this,"_pathIndex",void 0),qt(this,"_triggered",void 0),qt(this,"_player",void 0),qt(this,"_hitPlayer",void 0),this._lampList=[],this._path=[],this._health=5,this._impulse=40,this._pathIndex=0,this._triggered=!1,this._player=s,this._hitPlayer=!1}update(t,e){re.getInstance().getStop()||(!this._triggered&&this._shouldTrigger()?(this._triggered=!0,this.getHitbox().disableCollision(!1)):this._path.length>0&&this._triggered&&(this._updatePathIndex(this._path[this._pathIndex]),this._move(this._path[this._pathIndex],e),this.getTransform().getTranslation().distanceTo(re.getInstance().getTransform().getTranslation())<5&&!this._hitPlayer&&(this._hitPlayer=!0,Gt.update("life",-1),Rt.Find("damage").play(!1,!0),setTimeout((()=>this._hitPlayer=!1),1e3))))}_updatePathIndex(t){this._pathIndex!==this._path.length-1&&t.getPosition().distanceTo(new F(this.getTransform().getTranslation().x,this.getTransform().getTranslation().z))<2&&(this._pathIndex++,console.log(this._path[this._pathIndex]))}_move(t,e){this.getForce().x=0,this.getForce().y=0,this.getForce().z=0;const s=t.getPosition().clone().subtract(new F(this.getTransform().getTranslation().x,this.getTransform().getTranslation().z)).normalize(),r=s.x*this._impulse*e,i=s.y*this._impulse*e;this.getForce().add(new g.Z(r,0,i))}_shouldTrigger(){return this._player.getTransform().getTranslation().distanceTo(this.getTransform().getTranslation())<=30}takeDamage(){return this._health--,0===this._health}setLampList(t){this._lampList=t}getLampList(){return this._lampList}setHealth(t){this._health=t}getHealth(){return this._health}setPath(t){const e=this._path[this._pathIndex];this._pathIndex=t.includes(e)?t.indexOf(e):0,this._path=t}getPath(){return this._path}isTriggered(){return this._triggered}};function Qt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let Jt;!function(t){t[t.READY=0]="READY",t[t.CHARGED=1]="CHARGED",t[t.RECHARGING=2]="RECHARGING",t[t.EMPTY=3]="EMPTY",t[t.LOADING=4]="LOADING"}(Jt||(Jt={}));const te=class extends G{constructor(t,e){super("gun",dt.getVAO("gun-receiver"),dt.getMaterial("gun"),t),Qt(this,"_state",void 0),Qt(this,"_counter",void 0),Qt(this,"_step",void 0),Qt(this,"_sliderVao",void 0),Qt(this,"_sliderTransform",void 0),Qt(this,"_lampList",void 0),this._sliderVao=dt.getVAO("gun-slider"),this._sliderTransform=new B,this._sliderTransform.parent=this.getTransform(),this._lampList=[],this.getTransform().setTranslation(new g.Z(-.14,-.23,-.11)),this.getTransform().setRotation(new f.Z(0,0,-20)),this.setScene(e),this._state=Jt.CHARGED,this._counter=0,this._step=1}update(t,e){if(this._state===Jt.RECHARGING&&1===this._step){this._counter+=.25;const t=this._sliderTransform.getTranslation();this._sliderTransform.setTranslation((new g.Z).lerp([t.x,t.y,0],[t.x,t.y,.15],this._counter)),this._counter>=1&&(this._step=2,this._counter=0)}else if(this._state===Jt.RECHARGING&&2===this._step){this._counter+=.25;const t=this._sliderTransform.getTranslation();this._sliderTransform.setTranslation((new g.Z).lerp([t.x,t.y,.15],[t.x,t.y,0],this._counter)),this._counter>=1&&(this._step=1,this._counter=0,this._state=Jt.CHARGED)}}shoot(t,e){this._state=Jt.RECHARGING;const s=j(t,e),r=new Map,i=e=>new g.Z(t.x,0,t.y).distanceTo(e.getTransform().getTranslation()),n=this.getScene().filterVisible((t=>t instanceof $t&&i(t)<50)).sort(((t,e)=>{const s=i(t),r=i(e);return s>r?1:s<r?-1:0})).filter((t=>{const e=t.getTransform().getTranslation(),i=D(s,V(new F(e.x,e.z),t.getHitbox().getRadius()));return!!i&&(r.set(t.getName(),i),!0)}));for(let s=0;s<n.length;s++){const i=r.get(n[s].getName());if(this._isInsideLine({p1:t,p2:e},i))return void(n[s].takeDamage()&&this.getScene().remove(n[s]))}}_isInsideLine(t,e){let s=0,r=0;return t.p1.x!==t.p2.x?(t.p1.x<t.p2.x?(s=t.p1.x,r=t.p2.x):(s=t.p2.x,r=t.p1.x),e.p1.x>s&&e.p1.x<r||e.p2.x>s&&e.p2.x<r):(t.p1.y<t.p2.y?(s=t.p1.y,r=t.p2.y):(s=t.p2.y,r=t.p1.y),e.p1.y>s&&e.p1.y<r||e.p2.y>s&&e.p2.y<r)}getSliderVAO(){return this._sliderVao}getSliderTransform(){return this._sliderTransform}setLampList(t){this._lampList=t}getLampList(){return this._lampList}getState(){return this._state}};function ee(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class se extends Bt{constructor(t,e,s,r){super(t,e,1,dt.getVAO("hand"),dt.getMaterial("hand"),r),ee(this,"_camera",void 0),ee(this,"_sensitivity",void 0),ee(this,"_impulse",void 0),ee(this,"_handTransform",void 0),ee(this,"_gun",void 0),ee(this,"_lampList",void 0),ee(this,"_stop",void 0),ee(this,"_end",void 0),this._camera=s,this._sensitivity=7.5,this._impulse=100,this._handTransform=new B(new g.Z(-.8,1,1.5),new f.Z(0,180,20),new g.Z(1,1,1)),this._handTransform.parent=this.getTransform(),this._lampList=[],this._gun=null,this._stop=!1,se._instance=this}update(t,e){this._stop||(this._updateCameraPosition(),this._move(e),this._end.getTranslation().distanceTo(this.getTransform().getTranslation())<10&&es.getInstance().setScene("end"))}setEndPoint(t){this._end=t}_move(t){this.getForce().x=0,this.getForce().y=0,this.getForce().z=0;const e=Math.sin((0,b.Yr)(this.getTransform().getRotation().y))*this._impulse*t,s=Math.cos((0,b.Yr)(this.getTransform().getRotation().y))*this._impulse*t;let r=!1;if(h.isKeyPressed(a.KEY_W)&&(r=!0,Rt.Find("step").play(!0),this.getForce().add(new g.Z(e,0,s))),h.isKeyPressed(a.KEY_S)&&(r=!0,Rt.Find("step").play(!0),this.getForce().add(new g.Z(-e,0,-s))),h.isKeyPressed(a.KEY_A)&&(r=!0,Rt.Find("step").play(!0),this.getForce().add(new g.Z(s,0,-e))),h.isKeyPressed(a.KEY_D)&&(r=!0,Rt.Find("step").play(!0),this.getForce().add(new g.Z(-s,0,e))),r||Rt.Find("step").pause(),h.isKeyPressed(a.KEY_K)&&this.getTransform().setPitch(0),h.isKeyPressed(a.KEY_E)&&this._gun.getState()===Jt.CHARGED)if(Gt.isAmmunition()){Gt.update("ammunition",-1),setTimeout((()=>Rt.Find("gun").play(!1,!0)),100);const t=this.getTransform().getTranslation(),e=new g.Z(0,0,20).transform(this.getTransform().toInversePositionMatrix());this._gun.shoot(new F(t.x,t.z),new F(e.x,e.z))}else Rt.Find("empty_gun").play();if(h.isKeyPressed(a.KEY_LEFT)){const e=this.getTransform().getRotation();this.getTransform().setYaw(e.yaw+2*this._impulse*t)}if(h.isKeyPressed(a.KEY_RIGHT)){const e=this.getTransform().getRotation();this.getTransform().setYaw(e.yaw+2*-this._impulse*t)}if(h.isKeyPressed(a.KEY_ESCAPE)&&(d.IS_MOUSE_INSIDE=!1),d.IS_MOUSE_INSIDE){const e=h.getMouseDX(),s=(h.getMouseDY(),this.getTransform().getRotation());this.getTransform().setYaw(s.yaw+e*this._sensitivity*t)}}_updateCameraPosition(){this._camera.getTransform().setTranslation(this.getTransform().getTranslation()),this._camera.getTransform().setRotation(this.getTransform().getRotation())}setLampList(t){this._lampList=t}getLampList(){return this._lampList}getHandTransformMatrix(){return this.getTransform().toMatrix().multiplyRight(this._handTransform.toMatrix())}getHandTransform(){return this._handTransform}setGun(t){this._gun=t}getGun(){return this._gun}static getInstance(){return se._instance}setStop(t){this._stop=t}getStop(){return this._stop}}ee(se,"_instance",void 0);const re=se;function ie(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let ne;!function(t){t[t.OPENED=0]="OPENED",t[t.OPENING=1]="OPENING",t[t.CLOSED=2]="CLOSED",t[t.CLOSING=3]="CLOSING"}(ne||(ne={}));const ae=class extends vt{constructor(t,e,s,r=new B){super(t,e,1,dt.getVAO("hall-door"),dt.getMaterial("hall-door"),s),ie(this,"_state",void 0),ie(this,"_counter",void 0),ie(this,"_camera",void 0),ie(this,"_cameraTransform",void 0),ie(this,"_giveAmmunition",void 0),this._state=ne.CLOSED,this._counter=0,this._camera=Mt.Main,this._cameraTransform=r,this._giveAmmunition=!1}update(t,e){if(this._state===ne.OPENING){const t=this.getTransform().getTranslation();this._counter+=.01,this.getTransform().setTranslation((new g.Z).lerp([t.x,.01,t.z],[t.x,-6.75,t.z],this._counter)),this._counter>1&&(this.isOpen(!0),this._state=ne.OPENED,this.getHitbox().disableCollision(!0),this._counter=0)}else if(this._state===ne.CLOSING){const t=this.getTransform().getTranslation();this._counter+=.01,this.getTransform().setTranslation((new g.Z).lerp([t.x,-6.75,t.z],[t.x,.01,t.z],this._counter)),this._counter>1&&(this.isClose(!0),this._state=ne.CLOSED,this.getHitbox().disableCollision(!1),this._counter=0)}}interact(){this._state===ne.CLOSED?(this.isOpen(!1),this._state=ne.OPENING):this._state===ne.OPENED&&(this.isClose(!1),this._state=ne.CLOSING)}isOpen(t){t?(this._giveAmmunition||(this._giveAmmunition=!0,Gt.update("ammunition",10),zt.getDialog("display").animateText("municao coletada",30,{vertical:"10%",horizontal:"center"},(function(){setTimeout((()=>this.remove()),2e3)}))),Rt.Find("door").pause(),setTimeout((()=>re.getInstance().setStop(!1)),300)):(zt.getDialog("display").animateText("portao aberto",30,{vertical:"10%",horizontal:"center"},(function(){setTimeout((()=>this.remove()),2e3)})),Rt.Find("door").play(),re.getInstance().setStop(!0),this._camera.getTransform().setTranslation(this._cameraTransform.getTranslation()),this._camera.getTransform().setRotation(this._cameraTransform.getRotation()))}isClose(t){t?(Rt.Find("door").pause(),setTimeout((()=>re.getInstance().setStop(!1)),300)):(zt.getDialog("display").animateText("portao fechado",30,{vertical:"10%",horizontal:"center"},(function(){setTimeout((()=>this.remove()),2e3)})),Rt.Find("door").play(),re.getInstance().setStop(!0),this._camera.getTransform().setTranslation(this._cameraTransform.getTranslation()),this._camera.getTransform().setRotation(this._cameraTransform.getRotation()))}getState(){return this._state}};function oe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const he=class extends vt{constructor(t,e,s){super(t,e,1,dt.getVAO("door-panel"),dt.getMaterial("door-panel"),s),oe(this,"_hallDoor",void 0),oe(this,"_player",void 0),oe(this,"_locked",void 0),this._hallDoor=null,this._player=null,this._locked=!0}update(t,e){const s=this.getTransform().getTranslation(),r=this._player.getTransform().getTranslation();s.distanceTo(r)<5&&h.isKeyPressed(a.KEY_F)&&(this._hallDoor.interact(),this._hallDoor.getState()===ne.CLOSING?this.setLocked(!0):this._hallDoor.getState()===ne.OPENING&&this.setLocked(!1))}setHallDoor(t){this._hallDoor=t}getHallDoor(){return this._hallDoor}setPlayer(t){this._player=t}getPlayer(){return this._player}setLocked(t){this._locked=t}isLocked(){return this._locked}};function ce(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const le=class extends m{constructor(t){super("renderer1",t),ce(this,"_projection",void 0),ce(this,"distanceConfig",{7:[1,.7,1.8],13:[1,.35,.44],20:[1,.22,.2],32:[1,.14,.07],50:[1,.09,.032],65:[1,.07,.017],100:[1,.045,.0075],160:[1,.027,.0028],200:[1,.022,.0019],325:[1,.014,7e-4],600:[1,.007,2e-4],3250:[1,.0014,7e-6]}),this._projection=(new L).perspective({fovy:k(70),aspect:window.innerWidth/window.innerHeight,near:1,far:1e3}),this._maximumRenderDistance=110}render(){dt.forEachMaterial((t=>{t.bind();const e=t.getShader();e.setMatrix4x4("u_projection",this._projection),e.setMatrix4x4("u_view",this.getCamera().getView());const s=this.getCamera().getTransform().getTranslation();e.setVector3("u_camera_position",s.negate()),e.setVector3("lightCamera.color.ambient",new g.Z(1,1,1)),e.setVector3("lightCamera.color.diffuse",new g.Z(.5,.5,.5)),e.setVector3("lightCamera.color.specular",new g.Z(.3,.3,.3)),e.setVector3("lightCamera.position",s.negate());const r=this.distanceConfig[100];e.setFloat("lightCamera.distance.constant",r[0]),e.setFloat("lightCamera.distance.linear",r[1]),e.setFloat("lightCamera.distance.quadratic",r[2]),e.setFloat("lightCamera.shininess",32),e.setInt("onlyLights","mascara"==xt.mode?1:0),this.getEntitiesByMaterial(t).forEach(((s,r)=>{(s instanceof vt||s instanceof mt)&&(s instanceof vt&&s.getLampList().forEach(((t,s)=>{const r=`pointLights[${s}]`;e.setVector3(r+".color.ambient",t.color),e.setVector3(r+".color.diffuse",t.color),e.setVector3(r+".color.specular",t.color);const i=this.distanceConfig[t.distance];e.setFloat(r+".distance.constant",i[0]),e.setFloat(r+".distance.linear",i[1]),e.setFloat(r+".distance.quadratic",i[2]),e.setFloat(r+".shininess",t.shininess),e.setVector3(r+".position",t.getTransform().getTranslation().negate())})),s instanceof he&&e.setInt("u_locked",Number(s.isLocked())),s instanceof mt?(e.setInt("applyLight",0),e.setVector3("u_lightColor",s.color)):e.setInt("applyLight",1),t.getShader().setMatrix4x4("u_transform",s.getTransform().worldMatrix()),t.getShader().setMatrix4x4("u_worldInverseTranspose",s.getTransform().toMatrix().invert().transpose()),s.getVAO().bind(),i.draw(s.getVAO().getLength()),s.getVAO().unbind())})),t.unbind()}))}};function ue(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class de extends Mt{constructor(t,e=new g.Z,s=new f.Z){super(e,s),ue(this,"_name",void 0),ue(this,"_speed",void 0),ue(this,"_sensitivity",void 0),ue(this,"_pitch",void 0),ue(this,"_angleAround",void 0),ue(this,"_lockedIn",void 0),ue(this,"_mode",void 0),ue(this,"_lookAt",void 0),this._name=t,this._speed=40,this._sensitivity=7.5,this._pitch=0,this._lockedIn=null,this._mode=de.MODE.FIRST_PERSON,this._lookAt=!1,this._angleAround=0}update(t){}_firstPersonMovement(t){const e=Math.sin(k(this.getTransform().getRotation().y))*this._speed*t,s=Math.cos(k(this.getTransform().getRotation().y))*this._speed*t;if(h.isKeyPressed(a.KEY_W)){const t=this.getTransform().getTranslation();t.x+=e,t.z+=s,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_S)){const t=this.getTransform().getTranslation();t.x+=-e,t.z+=-s,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_A)){const t=this.getTransform().getTranslation();t.x+=s,t.z+=-e,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_D)){const t=this.getTransform().getTranslation();t.x+=-s,t.z+=e,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_SPACE)){const e=this.getTransform().getTranslation();e.y+=-this._speed*t,this.getTransform().setTranslation(e)}if(h.isKeyPressed(a.KEY_C)){const e=this.getTransform().getTranslation();e.y+=this._speed*t,this.getTransform().setTranslation(e)}if(h.isMouseLeft()){const e=h.getMouseDX(),s=h.getMouseDY(),r=this.getTransform().getRotation();this.getTransform().setPitch(r.pitch+s*this._sensitivity*t),this.getTransform().setYaw(r.yaw+e*this._sensitivity*t)}}getLockedIn(){return this._lockedIn}setLookAt(t){this._lookAt=t}shouldLookAt(){return this._lookAt}getName(){return this._name}}ue(de,"MODE",{FIRST_PERSON:0,THIRD_PERSON:1});const ge=de;function _e(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const me=class{constructor(t,e){_e(this,"_name",void 0),_e(this,"_shader",void 0),this._name=t,this._shader=e}getShader(){return this._shader}setShader(t){this._shader=t}getName(){return this._name}setName(t){this._name=t}},fe=class extends me{constructor(t,e,s){super(t,e),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_texture",void 0),this._texture=s}create(){this.getShader().create(),this._texture?.create()}bind(){this.getShader().bind(),this._texture&&(r.activeTexture(r.TEXTURE0),this._texture.bind(),this.getShader().setInt("u_texture",0))}unbind(){this._texture?.unbind(),this.getShader().unbind()}destroy(){this._texture?.destroy(),this.getShader().destroy()}getTexture(){return this._texture}setTexture(t){this._texture=t}},pe={};class ve extends I.Z{static get ZERO(){return pe.ZERO=pe.ZERO||Object.freeze(new ve(0,0,0,0))}constructor(t=0,e=0,s=0,r=0){super(-0,-0,-0,-0),(0,b.kJ)(t)&&1===arguments.length?this.copy(t):(b.vc.debug&&((0,p.u5)(t),(0,p.u5)(e),(0,p.u5)(s),(0,p.u5)(r)),this[0]=t,this[1]=e,this[2]=s,this[3]=r)}set(t,e,s,r){return this[0]=t,this[1]=e,this[2]=s,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return b.vc.debug&&((0,p.u5)(t.x),(0,p.u5)(t.y),(0,p.u5)(t.z),(0,p.u5)(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=(0,p.u5)(t)}get w(){return this[3]}set w(t){this[3]=(0,p.u5)(t)}transform(t){return A.fF(this,this,t),this.check()}transformByMatrix3(t){return(0,T._x)(this,this,t),this.check()}transformByMatrix2(t){return(0,T.G7)(this,this,t),this.check()}transformByQuaternion(t){return A.VC(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}const be=class extends m{constructor(t){super("guirenderer",t),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_projection",void 0),this._projection=(new L).ortho({top:0,left:0,right:d.CANVAS.width,bottom:d.CANVAS.height,near:-1,far:100})}render(){r.disable(r.CULL_FACE),dt.forEachMaterial((t=>{t.bind();const e=t.getShader();e.setInt("onlyLights","mascara"==xt.mode?1:0),e.setMatrix4x4("u_projection",this._projection),this.getEntitiesByMaterial(t).forEach(((s,r)=>{if("color"in s){let t=s.color;t=new ve(t.x,t.y,t.z,"alpha"in s?s.alpha:.1),e.setVector4("u_color",t)}t.getShader().setMatrix4x4("u_transform",s.getTransform().worldMatrix()),s.render(),s.getVAO().bind(),i.draw(s.getVAO().getLength()),s.getVAO().unbind()})),t.unbind()})),r.enable(r.CULL_FACE)}};function ye(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const we=class extends Vt{constructor(t,e,s,r){super(e,s),ye(this,"size",void 0),ye(this,"text",void 0),ye(this,"selection",void 0),ye(this,"rect",void 0),ye(this,"callback",null),this.getTransform().parent=t.getTransform(),this.setScene(r),this.selection=this.addRectangle(this.getName()+"_option_selection"),this.selection.setSize(190,60),this.selection.color=new g.Z(1,1,1),this.selection.getTransform().setTranslation(new g.Z(5,5,1)),this.rect=this.addRectangle(this.getName()+"_option_rectangle"),this.rect.getTransform().setTranslation(new g.Z(0,0,1)),this.rect.setSize(180,50),this.text=this.addText(this.getName()+"_option_text"),this.text.getTransform().setTranslation(new g.Z(-15,-15,-1)),this.text.getTransform().setScale(new g.Z(2,2,2))}selected(t){this.getScene().setVisibility(this.selection,t)}getRect(){return this.rect}setText(t){this.text.setText(t)}setExecute(t){this.callback=t}execute(){if(null!=this.callback)return this.callback()}update(t,e){}};function Te(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const xe=class extends Vt{constructor(t,e,s){super(t,e),Te(this,"padding",0),Te(this,"options",[]),Te(this,"selected",0),Te(this,"change",!1),this.setScene(s)}addOption(t){const e=t.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""),s=new we(this,this.getName()+"_"+e,this.getRenderer(),this.getScene());return this.padding>0&&s.selected(!1),this.options.push(s),s.getTransform().setTranslation(new g.Z(0,70*this.padding++,0).negate()),s.setText(t),s.getTransform().parent=this.getTransform(),this.getScene().add(s),this.updateTranslation(),s}updateTranslation(t=d.CANVAS.width,e=d.CANVAS.height){const s=e/2-25-70*this.padding/2,r=t/2-90;this.getTransform().setTranslation(new g.Z(r,s,0).negate())}update(t,e){const s=h.isKeyPressedDown(a.KEY_DOWN),r=h.isKeyPressedDown(a.KEY_UP);if(s||r){if(this.change){let t;const e=this.selected;r?(t=e-1,t<0&&(t=this.options.length-1)):(t=e+1,t>=this.options.length&&(t=0)),Rt.Find("menu").play(),this.options[e].selected(!1),this.options[t].selected(!0),this.selected=t,this.change=!1}}else h.isKeyPressedDown(a.KEY_ENTER)?this.change&&this.options[this.selected].execute():this.change=!0}};function Ee(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Se=class extends m{constructor(t){super("monster-renderer",t),Ee(this,"_projection",void 0),Ee(this,"_material",void 0),Ee(this,"_vao",void 0),Ee(this,"_player",void 0),Ee(this,"distanceConfig",{7:[1,.7,1.8],13:[1,.35,.44],20:[1,.22,.2],32:[1,.14,.07],50:[1,.09,.032],65:[1,.07,.017],100:[1,.045,.0075],160:[1,.027,.0028],200:[1,.022,.0019],325:[1,.014,7e-4],600:[1,.007,2e-4],3250:[1,.0014,7e-6]}),this._projection=(new L).perspective({fovy:k(70),aspect:window.innerWidth/window.innerHeight,near:1,far:1e3}),this._material=dt.getMaterial("monster"),this._vao=dt.getVAO("monster"),this._maximumRenderDistance=75}setPlayer(t){this._player=t}render(){this._material.bind();const t=this._material.getShader();t.setMatrix4x4("u_projection",this._projection),t.setMatrix4x4("u_view",this.getCamera().getView());const e=this.getCamera().getTransform().getTranslation();t.setVector3("u_camera_position",e.negate()),t.setVector3("u_color",new g.Z(1,.2,.3)),t.setVector3("lightCamera.color.ambient",new g.Z(1,1,1)),t.setVector3("lightCamera.color.diffuse",new g.Z(.5,.5,.5)),t.setVector3("lightCamera.color.specular",new g.Z(.3,.3,.3)),t.setVector3("lightCamera.position",e.negate());const s=this.distanceConfig[100];t.setFloat("lightCamera.distance.constant",s[0]),t.setFloat("lightCamera.distance.linear",s[1]),t.setFloat("lightCamera.distance.quadratic",s[2]),t.setFloat("lightCamera.shininess",32),this._vao.bind();const r=this._player.getTransform().getTranslation();this.getEntitiesByMaterial(this._material).filter((t=>t instanceof $t)).sort(((t,e)=>{const s=r.distanceTo(t.getTransform().getTranslation()),i=r.distanceTo(e.getTransform().getTranslation());return s<i?1:s>i?-1:0})).forEach(((e,s)=>{e.getLampList().forEach(((e,s)=>{const r=`pointLights[${s}]`;t.setVector3(r+".color.ambient",e.color),t.setVector3(r+".color.diffuse",e.color),t.setVector3(r+".color.specular",e.color);const i=this.distanceConfig[e.distance];t.setFloat(r+".distance.constant",i[0]),t.setFloat(r+".distance.linear",i[1]),t.setFloat(r+".distance.quadratic",i[2]),t.setFloat(r+".shininess",e.shininess),t.setVector3(r+".position",e.getTransform().getTranslation().negate())})),t.setInt("applyLight",1),this._material.getShader().setMatrix4x4("u_transform",this._getTransformMatrix(e)),this._material.getShader().setMatrix4x4("u_worldInverseTranspose",e.getTransform().toMatrix().invert().transpose()),i.draw(this._vao.getLength())})),this._vao.unbind(),this._material.unbind()}_getTransformMatrix(t){const e=this._player.getTransform().getTranslation(),s=t.getTransform().getTranslation().subtract(e).normalize(),r=new L([s.z,0,-s.x,0,0,1,0,0,s.x,0,s.z,0,0,0,0,1]),i=(new L).translate(t.getTransform().getTranslation().negate()),n=(new L).scale(t.getTransform().getScale());return i.multiplyRight(r.multiplyRight(n))}},Me=class extends Vt{constructor(t,e){super(t,e),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_text",void 0)}setText(t,e=new g.Z(.9,.9,.9)){const s=this.addRectangle(this.getName()+"_rectangle_left");s.color=e,s.setSize(120,50),s.getTransform().parent=this.getTransform();const r=this.addText(this.getName()+"_text_rectangle_left");this._text=r,r.setText(t),r.getTransform().setTranslation(new g.Z(50,15,1).negate()),r.getTransform().setScale(new g.Z(2,2,2))}setImage(t){t.getTransform().setTranslation(new g.Z(0,0,1).negate()),t.getTransform().setScale(new g.Z(.09,.09,1)),this.getScene().add(t),t.getTransform().parent=this.getTransform()}updateText(t){this._text.setText(String(t))}update(t,e){}},Ne=class extends Vt{constructor(t,e,s){super(t,s),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t.size=s}(this,"size",{width:0,height:0}),this.createMaterial(e).then((()=>{this.createVAO()}))}createMaterial(t){return new Promise((e=>{(new ct).load(t,(t=>{this.size={width:t.getWidth(),height:t.getHeight()};const s=new fe(this.getName(),dt.getShader("image"),t);s.create(),this.setMaterial(s),dt.addMaterials([s]),e(null)}))}))}createVAO(){const t=[];var e=0+this.size.width,s=0+this.size.height;t.push(new et(new Float32Array([0,0,e,0,0,s,0,s,e,0,e,s]),2,!0)),t.push(new et(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),2,!0));const r=new rt(t,2);r.create(),this.setVAO(r)}update(t,e){}};function Ae(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Re{constructor(t,e){Ae(this,"_p",void 0),Ae(this,"_q",void 0),this._p=t,this._q=e}getP(){return this._p}getQ(){return this._q}}const Ce=class extends Wt{constructor(t,e){super(),Ae(this,"_lines",void 0),this._lines=[];for(let s=0;s<e.length;s+=2){const r=t[2*e[s]],i=t[2*e[s]+1],n=t[2*e[s+1]],a=t[2*e[s+1]+1];this._lines.push(new Re(new F(r,i),new F(n,a)))}}getLines(){return this._lines}};function Oe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Pe=class{constructor(t,e){Oe(this,"_solid1",void 0),Oe(this,"_solid2",void 0),this._solid1=t,this._solid2=e}getSolid1(){return this._solid1}getSolid2(){return this._solid2}};class Le extends Pe{static test(t,e){const s=new F(t.getTransform().getTranslation().x,t.getTransform().getTranslation().z),r=new F(e.getTransform().getTranslation().x,e.getTransform().getTranslation().z),i=t.getHitbox().getRadius()+e.getHitbox().getRadius();return r.distanceTo(s)<i?new Le(t,e):null}getAccelerationOnSolid1(){return this._getAccelerationOnSolid(this.getSolid1(),this.getSolid2())}getAccelerationOnSolid2(){return this._getAccelerationOnSolid(this.getSolid2(),this.getSolid1())}_getAccelerationOnSolid(t,e){const s=new F(t.getTransform().getTranslation().x,t.getTransform().getTranslation().z),r=new F(e.getTransform().getTranslation().x,e.getTransform().getTranslation().z),i=new F(r).subtract(s),n=new F(s).subtract(r),a=t.getHitbox().getRadius(),o=e.getHitbox().getRadius(),h=new F(s).add(i.multiplyByScalar(a).divideScalar(i.magnitude())),c=new F(r).add(n.multiplyByScalar(o).divideScalar(n.magnitude())).subtract(h);return new g.Z(c.x,0,c.y)}solve(){const t=new F(this.getSolid1().getTransform().getTranslation().x,this.getSolid1().getTransform().getTranslation().z),e=new F(this.getSolid2().getTransform().getTranslation().x,this.getSolid2().getTransform().getTranslation().z),s=new F(t).subtract(e),r=this.getSolid1().getHitbox().getRadius()+this.getSolid2().getHitbox().getRadius();s.divideScalar(s.magnitude()),this.getSolid1().getTransform().setX(this.getSolid2().getTransform().getX()+r*s.x),this.getSolid1().getTransform().setZ(this.getSolid2().getTransform().getZ()+r*s.y)}}const Ie=Le;class Fe extends Pe{constructor(t,e,s){super(t,e),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_intersectedLine",void 0),this._intersectedLine=s}static test(t,e){const s=new F(t.getTransform().getTranslation().x,t.getTransform().getTranslation().z),r=e.getTransform().toInversePositionMatrix(),i=t.getHitbox(),n=e.getHitbox(),a=[];return n.getLines().forEach((t=>{const e=new g.Z(t.getP().x,0,t.getP().y).transform(r),n=new g.Z(t.getQ().x,0,t.getQ().y).transform(r),o=j(new F(e.x,e.z),new F(n.x,n.z)),h=((t,e)=>Math.abs(e.a*t.x+e.b*t.y+e.c)/Math.sqrt(e.a**2+e.b**2))(s,o);if(h<i.getRadius()){const t=D(o,V(s,i.getRadius()));t&&Fe._isInsideLine({p1:new F(e.x,e.z),p2:new F(n.x,n.z)},t)&&a.push({p:new F(e.x,e.z),q:new F(n.x,n.z),distance:h,intersectionPoints:t,circleCenter:s})}})),a.length>0?(a.sort(((t,e)=>t.distance-e.distance)),new Fe(t,e,a[0])):null}solve(){const t=new F(this._intersectedLine.intersectionPoints.p2).subtract(this._intersectedLine.intersectionPoints.p1).divideScalar(2).add(this._intersectedLine.intersectionPoints.p1),e=new F(t).subtract(this._intersectedLine.circleCenter).multiplyByScalar(2),s=new F(e).negate();e.add(this._intersectedLine.circleCenter);const r=this.getSolid1().getHitbox().getRadius()+t.distanceTo(e);s.divideScalar(s.magnitude()),this.getSolid1().getTransform().setX(e.x+r*s.x),this.getSolid1().getTransform().setZ(e.y+r*s.y)}static _isInsideLine(t,e){let s=0,r=0;return t.p1.x!==t.p2.x?(t.p1.x<t.p2.x?(s=t.p1.x,r=t.p2.x):(s=t.p2.x,r=t.p1.x),e.p1.x>s&&e.p1.x<r||e.p2.x>s&&e.p2.x<r):(t.p1.y<t.p2.y?(s=t.p1.y,r=t.p2.y):(s=t.p2.y,r=t.p1.y),e.p1.y>s&&e.p1.y<r||e.p2.y>s&&e.p2.y<r)}}const ke=Fe;function De(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function je(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Ve=class extends X{constructor(t){super(t),je(this,"_properties",void 0),je(this,"_physics",void 0),this._physics=new class{constructor(){De(this,"_solidEntities",void 0),De(this,"_staticEntities",void 0),De(this,"_dynamicEntities",void 0),De(this,"_intersections",void 0),this._solidEntities=[],this._staticEntities=[],this._dynamicEntities=[],this._intersections=[]}add(t){this._solidEntities.push(t),t instanceof pt?this._staticEntities.push(t):t instanceof Bt&&this._dynamicEntities.push(t)}remove(t){this._solidEntities=this._solidEntities.filter((e=>e.getName()!==t.getName())),t instanceof pt?this._staticEntities=this._staticEntities.filter((e=>e.getName()!==t.getName())):t instanceof Bt&&(this._dynamicEntities=this._dynamicEntities.filter((e=>e.getName()!==t.getName())))}applyPhysics(t,e,s){t.updateSpeed(s),t.getTransform().getY()<e.defaultFakeFloor&&t.getSpeed().add(new g.Z(0,e.gravity*s,0)),t.getSpeed().add(new g.Z(t.getSpeed()).multiplyByScalar(-e.airFrictionCoefficient*s)),t.getTransform().setTranslation(t.getTransform().getTranslation().add(t.getSpeed())),t.getTransform().getY()>e.defaultFakeFloor&&(t.getSpeed().y=0,t.getTransform().setY(e.defaultFakeFloor))}reapplyPhysics(t,e){this._dynamicEntities.forEach((s=>this.applyPhysics(s,t,e)))}anyCollisionDetected(){return this._intersections=[],this._dynamicEntities.forEach((t=>{t.getHitbox().isCollisionDisabled()||this._solidEntities.filter((e=>!e.getHitbox().isCollisionDisabled()&&t.getName()!==e.getName()&&t.getTransform().getTranslation().distanceTo(e.getTransform().getTranslation())<(e instanceof Bt?5:50))).forEach((e=>{const s=this._test(t,e);s&&this._intersections.push(s)}))})),this._intersections.length>0}_test(t,e){return t.getHitbox()instanceof Xt&&e.getHitbox()instanceof Xt?Ie.test(t,e):t.getHitbox()instanceof Xt&&e.getHitbox()instanceof Ce?ke.test(t,e):void 0}distributeForces(){this._intersections.forEach((t=>{const e=t.getSolid1();t.solve(),e.getSpeed().x=0,e.getSpeed().z=0}))}},this._properties={gravity:9.807,airFrictionCoefficient:5,defaultFakeFloor:0}}add(t,e=!0){return super.add(t,e),t instanceof ft&&e&&this._physics.add(t),this}remove(t){return t instanceof ft&&this.hasInVisible(t)&&this._physics.remove(t),super.remove(t),this}setVisibility(t,e){return super.setVisibility(t,e),t instanceof ft&&e?this._physics.add(t):t instanceof ft&&!e&&this._physics.remove(t),this}update(t,e){this.forEachVisible((s=>{s.update(t,e),s instanceof Bt&&this._physics.applyPhysics(s,this._properties,e)})),this._physics.anyCollisionDetected()&&this._physics.distributeForces()}getProperties(){return this._properties}};function Ke(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Ye(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const ze=class{constructor(t,e){Ye(this,"_name",void 0),Ye(this,"_g",void 0),Ye(this,"_h",void 0),Ye(this,"_neighbours",void 0),Ye(this,"_marked",void 0),Ye(this,"_position",void 0),Ye(this,"_path",void 0),this._name=t,this._position=e,this._g=0,this._h=0,this._neighbours=new Map,this._marked=!1,this._path=null}distanceTo(t){return this._position.distanceTo(t.getPosition())}calculateG(t){this._g=t.distanceTo(this._position)}setG(t){this._g=t}getG(){return this._g}calculateH(t){this._h=t.distanceTo(this._position)}setH(t){this._h=t}getH(){return this._h}getF(){return this._g+this._h}getNeighbours(){return this._neighbours}setMarked(t){this._marked=t}isMarked(){return this._marked}setPosition(t){this._position=t}getPosition(){return this._position}setPath(t){this._path=t}getPath(){return this._path}getName(){return this._name}},Ze=class extends ze{constructor(t){super(t.getName(),null),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_entity",void 0),this._entity=t}getEntity(){return this._entity}distanceTo(t){return this.getPosition().distanceTo(t.getPosition())}getPosition(){return new F(this._entity.getTransform().getTranslation().x,this._entity.getTransform().getTranslation().z)}};function Be(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Ue(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const He=class extends Ve{constructor(t){super("main"),Ue(this,"_camera",void 0),Ue(this,"_entityFactory",void 0),Ue(this,"_player",void 0),Ue(this,"_gun",void 0),Ue(this,"_lamps",void 0),Ue(this,"_pathFinding",void 0),Ue(this,"_lampSortingTimer",void 0),Ue(this,"_pathFindingCalculationTimer",void 0),Ue(this,"_frameBuffer",[]),this._camera=t,this._entityFactory=new class{constructor(t,e){Ke(this,"_scene",void 0),Ke(this,"_renderStrategy",void 0),this._scene=t,this._renderStrategy=e}load(){this._loadMap(),this._loadMonsters(),this._configureEntities()}_loadMonsters(){Q.load("/resources/monsters.json",(t=>{const e=JSON.parse(t);Object.keys(e).forEach((t=>{const s=e[t],r=new $t(t,this._renderStrategy.get("monster-renderer"),this._scene.get("player"));r.getTransform().setTranslation(new g.Z(s.translation.x,s.translation.y,s.translation.z)),r.getTransform().setScale(new g.Z(1,2,1)),r.getHitbox().disableCollision(!0),this._scene.add(r)}))}),(function(t){console.error("Could not import monsters from json: ",t)}))}_loadMap(){const t=(new at).loadHitboxes("/resources/hitboxes.json");Q.load("/resources/entities.json",(e=>{const s=JSON.parse(e);Object.keys(s).forEach((e=>{const r=s[e],i=(()=>{for(let t=e.length-1;t>=0;t--)if("_"===e[t])return e.substring(0,t);return""})(),n=this._createEntity(e,i,t,r.options);n.getTransform().setTranslation(new g.Z(r.translation.x,r.translation.y,r.translation.z)),n.getTransform().setRotation(new f.Z(r.rotation.x,r.rotation.y,r.rotation.z)),n.getTransform().setScale(new g.Z(r.scale.x,r.scale.y,r.scale.z)),this._scene.add(n)}))}),(function(t){console.error("Could not import entities from json: ",t)}))}_createEntity(t,e,s,r){switch(e){case"lamp":return new mt(t,this._renderStrategy.get("renderer1"),new g.Z(1,0,0));case"hall-door":let i;return r?.camera&&(i=new B(r.camera.translation,new f.Z(r.camera.rotation.x,r.camera.rotation.y,r.camera.rotation.z))),new ae(t,this._getHitbox(e,s),this._renderStrategy.get("renderer1"),i);case"door-panel":return new he(t,this._getHitbox(e,s),this._renderStrategy.get("renderer1"))}return new vt(t,this._getHitbox(e,s),1,dt.getVAO(e),this._getMaterial(e),this._renderStrategy.get("renderer1"))}_getMaterial(t){switch(t){case"hall":case"level-2":return dt.getMaterial("level")}return dt.getMaterial(t)}_configureEntities(){this._scene.get("lamp_2").color=new g.Z(1,1,1),this._scene.get("lamp_33").color=new g.Z(1,1,1),this._distributeClosestLampsForStaticEntities()}_distributeClosestLampsForStaticEntities(){const t=[];this._scene.forEach((e=>{e instanceof mt&&t.push(e)})),this._scene.forEach((e=>{(e instanceof vt||e instanceof $t)&&e.setLampList(this.get5ClosestLamps(e,t))}))}get5ClosestLamps(t,e,s=t.getTransform().getTranslation()){return Array.from(e).sort(((t,e)=>{const r=s.distanceTo(t.getTransform().getTranslation()),i=s.distanceTo(e.getTransform().getTranslation());return r>i?1:r<i?-1:0})).slice(0,5)}_getHitbox(t,e){return new Ce(e.edge[t].vertices,e.edge[t].indices)}}(this,this.getRenderStrategy()),this._player=null,this._gun=null,this._lamps=[],this._pathFinding=null,this._lampSortingTimer=3,this._pathFindingCalculationTimer=5}init(){this._frameBuffer.push(new xt(this._camera,"albedo")),this._frameBuffer.push(new xt(this._camera,"mascara")),this._player=new re("player",new Xt(2),this._camera,this.getRenderStrategy().get("player-renderer")),this._gun=new te(this.getRenderStrategy().get("player-renderer"),this),this._player.getTransform().setTranslation(new g.Z(51.1,0,-88)),this._player.getTransform().setRotation(new f.Z(0,-32)),this._player.setGun(this._gun),this._gun.getTransform().parent=this._player.getHandTransform(),this.add(this._player),this.add(this._gun),this._entityFactory.load();const t={"door-panel_3":"hall-door_0","door-panel_4":"hall-door_2","door-panel_0":"hall-door_1","door-panel_5":"hall-door_4","door-panel_6":"hall-door_6","door-panel_1":"hall-door_7","door-panel_7":"hall-door_8","door-panel_8":"hall-door_10","door-panel_2":"hall-door_11"};this.filterVisible((t=>t instanceof ae)).forEach((t=>t.getHitbox().disableCollision(!0))),this.filterVisible((t=>t instanceof he)).forEach((e=>{const s=this.get(t[e.getName()]);s.getHitbox().disableCollision(!1),e.setHallDoor(s),e.setPlayer(this._player)})),this.forEach((t=>{t instanceof mt&&this._lamps.push(t)})),this._pathFinding=new class{constructor(t,e){Be(this,"_nodes",void 0),Be(this,"_openNodes",void 0),Be(this,"_closedNodes",void 0),Be(this,"_scene",void 0),Be(this,"_player",void 0),Be(this,"_playerNode",void 0),Be(this,"_monsterNodes",void 0),this._nodes=new Map,this._openNodes=new Map,this._closedNodes=new Map,this._scene=t,this._player=e,this._playerNode=new Ze(e),this._nodes.set(this._playerNode.getName(),this._playerNode),this._monsterNodes=new Map,t.filterVisible((t=>t instanceof $t)).forEach((t=>{const e=new Ze(t);this._monsterNodes.set(t.getName(),e)}))}find(t){const e=this._monsterNodes.get(t.getName()),s=this._playerNode;let r;for(this._nodes.set(e.getName(),e),this._clearOldPath(),this._connectNearestNodesToMonster(e),this._openNodes.clear(),this._closedNodes.clear(),this._openNodes.set(e.getName(),e);this._openNodes.size>0&&(r=this._popLowestCostNode(this._openNodes),this._closedNodes.set(r.getName(),r),r!==s);)r.getNeighbours().forEach((t=>{if(this._closedNodes.has(t.getName()))return;const e=!this._openNodes.has(t.getName()),i=r.getG()+r.distanceTo(t);(e||i<t.getG())&&(t.setG(i),t.setPath(r),e&&(t.setH(t.distanceTo(s)),this._openNodes.set(t.getName(),t)))}));return this._nodes.delete(e.getName()),this._getPath()}_getPath(){const t=[];let e=this._playerNode;do{t.push(e),e=e.getPath()}while(e);return t.pop(),t.reverse()}_clearOldPath(){this._nodes.forEach((t=>{t.setPath(null)}))}connectNearestNodesToPlayer(){this._clearOldNearestNodes(this._playerNode);const t=this._findNearest(this._playerNode);this._playerNode.getNeighbours().set(t.firstClosestNode.getName(),t.firstClosestNode),t.firstClosestNode.getNeighbours().set(this._playerNode.getName(),this._playerNode)}_connectNearestNodesToMonster(t){this._clearOldNearestNodes(t);const e=this._findNearest(t);t.getNeighbours().set(e.firstClosestNode.getName(),e.firstClosestNode)}_findNearest(t){let e,s;return this._nodes.forEach((r=>{if(r.getName()===t.getName())return;const i=t.distanceTo(r);(!e||i<s)&&((t,r)=>{e=t,s=r})(r,i)})),{firstClosestNode:e,firstClosestNodeDistance:s}}_clearOldNearestNodes(t){t.getNeighbours().forEach((e=>{e.getNeighbours().delete(t.getName())})),t.getNeighbours().clear()}_popLowestCostNode(t){let e,s;return t.forEach(((t,r)=>{(!e||e.getF()>t.getF()||e.getF()===t.getF()&&e.getH()>t.getH())&&(e=t,s=r)})),t.delete(s),e}loadNodes(){Q.load("/resources/nodes.json",(t=>{const e=JSON.parse(t);Object.keys(e).forEach((t=>{const s=e[t].translation,r=new ze(t,new F(s.x,s.z));this._nodes.set(r.getName(),r)})),this._connectNodes()}),(function(t){throw new Error(`Error trying to load nodes.\n ${t}`)}))}_connectNodes(){const t={0:[1],1:[0,2,3],2:[1,9],3:[1,4],4:[3,5],5:[4,6,17],6:[5,7],7:[6,8],8:[7,9,10],9:[2,8],10:[8,11,12],11:[10,14],12:[10,13],13:[12,16],14:[11,15],15:[14,16],16:[15,13],17:[5,18,19],18:[17,25],19:[17,20],20:[19,21],21:[20,22,33],22:[21,23],23:[22,24],24:[23,25,26],25:[18,24],26:[24,27,28],27:[26,32],28:[26,29],29:[28,30],30:[29,31],31:[30,32],32:[31,27],33:[21,34,35],34:[33,40],35:[33,36],36:[35,37],37:[36,38,49],38:[37,39],39:[38,40],40:[39,41,42],41:[34,40],42:[40,43,48],43:[42,44],44:[43,45],45:[44,46],46:[45,47],47:[46,48],48:[47,42],49:[37]};Object.keys(t).forEach((e=>{const s=this._nodes.get("node_"+e);t[e].forEach((t=>{const e="node_"+t;s.getNeighbours().set(e,this._nodes.get(e))}))}))}getNodes(){return this._nodes}}(this,this._player),this._pathFinding.loadNodes()}update(t,e){super.update(t,e),this._lampSortingTimer>3&&(this._player.setLampList(this._entityFactory.get5ClosestLamps(this._player,this._lamps)),this._gun.setLampList(this._entityFactory.get5ClosestLamps(this._gun,this._lamps,this._gun.getTransform().worldTranslation())),this.filterVisible((t=>t instanceof $t&&t.isTriggered())).forEach((t=>{t.setLampList(this._entityFactory.get5ClosestLamps(t,this._lamps))})),this._lampSortingTimer=0),this._lampSortingTimer+=e,this._pathFindingCalculationTimer>5&&(this.filterVisible((t=>t instanceof $t&&t.isTriggered())).forEach((t=>{this._pathFinding.connectNearestNodesToPlayer();const e=this._pathFinding.find(t);t.setPath(e)})),this._pathFindingCalculationTimer=0),this._pathFindingCalculationTimer+=e}render(){this._frameBuffer[0].bind(),super.render(),this._frameBuffer[0].unbind(),this._frameBuffer[0].render(),this._frameBuffer[1].bind(),super.render(),this._frameBuffer[1].unbind(),this._frameBuffer[1].render()}};function Ge(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const We=class extends me{constructor(){super("door-panel",dt.getShader("door-panel")),Ge(this,"_lockedTexture",void 0),Ge(this,"_unlockedTexture",void 0),Ge(this,"_displayMap",void 0),this._lockedTexture=dt.getTexture("door-panel-locked"),this._unlockedTexture=dt.getTexture("door-panel-unlocked"),this._displayMap=dt.getTexture("door-panel-display-map")}create(){this.getShader().create(),this._lockedTexture.create(),this._unlockedTexture.create(),this._displayMap.create()}bind(){this.getShader().bind(),r.activeTexture(r.TEXTURE0),this._lockedTexture.bind(),this.getShader().setInt("u_lockedTexture",0),r.activeTexture(r.TEXTURE1),this._unlockedTexture.bind(),this.getShader().setInt("u_unlockedTexture",1),r.activeTexture(r.TEXTURE2),this._displayMap.bind(),this.getShader().setInt("u_displayMap",2)}unbind(){this._displayMap.unbind(),this._unlockedTexture.unbind(),this._lockedTexture.unbind(),this.getShader().unbind()}destroy(){this._displayMap.destroy(),this._unlockedTexture.destroy(),this._lockedTexture.destroy(),this.getShader().destroy()}};function Xe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const qe=class extends m{constructor(t){super("player-renderer",t),Xe(this,"_projection",void 0),Xe(this,"_player",void 0),Xe(this,"_gun",void 0),Xe(this,"distanceConfig",{7:[1,.7,1.8],13:[1,.35,.44],20:[1,.22,.2],32:[1,.14,.07],50:[1,.09,.032],65:[1,.07,.017],100:[1,.045,.0075],160:[1,.027,.0028],200:[1,.022,.0019],325:[1,.014,7e-4],600:[1,.007,2e-4],3250:[1,.0014,7e-6]}),this._projection=(new L).perspective({fovy:k(70),aspect:window.innerWidth/window.innerHeight,near:1,far:1e3}),this._player=null,this._gun=null}setPlayer(t,e){this._player=t,this._gun=e}render(){this._player.getStop()||(this._bindMaterial(this._player),this._renderHand(),this._player.getMaterial().unbind(),this._bindMaterial(this._gun),this._renderGun(),this._gun.getMaterial().unbind())}_bindMaterial(t){const e=t.getMaterial();e.bind();const s=e.getShader();s.setMatrix4x4("u_projection",this._projection),s.setMatrix4x4("u_view",this.getCamera().getView());const r=this.getCamera().getTransform().getTranslation();s.setVector3("u_camera_position",r.negate()),s.setVector3("u_color",new g.Z(1,.2,.3)),s.setVector3("lightCamera.color.ambient",new g.Z(1,1,1)),s.setVector3("lightCamera.color.diffuse",new g.Z(.5,.5,.5)),s.setVector3("lightCamera.color.specular",new g.Z(.3,.3,.3)),s.setVector3("lightCamera.position",r.negate());const i=this.distanceConfig[100];s.setFloat("lightCamera.distance.constant",i[0]),s.setFloat("lightCamera.distance.linear",i[1]),s.setFloat("lightCamera.distance.quadratic",i[2]),s.setFloat("lightCamera.shininess",32),t.getLampList().forEach(((t,e)=>{const r=`pointLights[${e}]`;s.setVector3(r+".color.ambient",t.color),s.setVector3(r+".color.diffuse",t.color),s.setVector3(r+".color.specular",t.color);const i=this.distanceConfig[t.distance];s.setFloat(r+".distance.constant",i[0]),s.setFloat(r+".distance.linear",i[1]),s.setFloat(r+".distance.quadratic",i[2]),s.setFloat(r+".shininess",t.shininess),s.setVector3(r+".position",t.getTransform().getTranslation().negate())})),s.setInt("applyLight",1)}_renderHand(){const t=this._player.getHandTransformMatrix();this._renderObject(this._player.getVAO(),this._player.getMaterial().getShader(),t,new L(t).invert().transpose())}_renderGun(){const t=this._gun.getTransform().worldMatrix();this._renderObject(this._gun.getVAO(),this._gun.getMaterial().getShader(),t,new L(t).invert().transpose());const e=this._gun.getSliderTransform().worldMatrix();this._renderObject(this._gun.getSliderVAO(),this._gun.getMaterial().getShader(),e,new L(e).invert().transpose())}_renderObject(t,e,s,r){e.setMatrix4x4("u_transform",s),e.setMatrix4x4("u_worldInverseTranspose",r),t.bind(),i.draw(t.getLength()),t.unbind()}};function $e(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Qe=class extends G{constructor(t,e,s){super(t,null,null,s),$e(this,"_texture",void 0),$e(this,"color",new g.Z(0,0,0)),$e(this,"alpha",1);const r=document.createElement("canvas");r.width=d.CANVAS.width,r.height=d.CANVAS.height;const i=r.getContext("2d");i.clearRect(0,0,i.canvas.width,i.canvas.height),i.font="20px serif",i.fillStyle="white";const n=e.split("\n");for(let t=0;t<n.length;t++)i.fillText(n[t],0,50+20*t);const a=new Uint8Array(i.getImageData(0,0,i.canvas.width,i.canvas.height).data);this._texture=new ht(i.canvas.width,i.canvas.height),this._texture.create(),this._texture.setData(a),this.setVAO(dt.getVAO("effect")),this.setMaterial(new fe(t,dt.getShader("text"),this._texture)),dt.addMaterials([this.getMaterial()]),this.getMaterial().create();const o=d.CANVAS.height/d.CANVAS.width;this.getTransform().setTranslation(new g.Z(800,400,1).negate()),this.getTransform().setScale(new g.Z(800,800*o,1))}update(t,e){}};function Je(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class ts extends class{constructor(){var t,e;e=void 0,(t="_sceneManager")in this?Object.defineProperty(this,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):this[t]=e,this._sceneManager=new class{constructor(){$(this,"_scenes",void 0),$(this,"_active",void 0),this._scenes=new Map,this._active=null}render(){this._active.render()}update(t,e){this._active.update(t,e)}add(t,e=!1){const s=this._validate(t);return this._scenes.set(s,t),e&&(this._active=t,q.Z.trigger("loadScene",this._active)),this}remove(t){const e=this._validate(t,!1);return this._scenes.delete(e),this._active.getName()===e&&(this._active=null),this}setActive(t){const e=this._validate(t,!1);return this._active=this._scenes.get(e),q.Z.trigger("loadScene",this._active),this}getActive(){return this._active}get(t){return this._validate(t,!1),this._scenes.get(t)}getKeys(){return[...this._scenes.keys()]}forEach(t){return this._scenes.forEach(((e,s)=>{t(e,s)})),this}has(t){const e=this._getName(t);return this._scenes.has(e)}_validate(t,e=!0){const s=this._getName(t);if(e&&this._scenes.has(s))throw new Error(`Scene ${s} already exists!`);if(!e&&!this._scenes.has(s))throw new Error(`Scene ${s} does not exists!`);return s}_getName(t){return t instanceof X?t.getName():t}}}changeScene(t){}update(t,e){this._sceneManager.update(t,e)}render(){this._sceneManager.render()}setScene(t){const e=this._sceneManager.setActive(t);return this.changeScene(e.getActive()),e}getSceneManager(){return this._sceneManager}}{constructor(){super(),Je(this,"_camera",void 0),Je(this,"_gameController",void 0),Je(this,"_guiRenderer",void 0),ts.instance=this}static getInstance(){return ts.instance}start(){new Rt("gun","/resources/sound/gun.wav"),new Rt("empty_gun","/resources/sound/empty_gun.wav"),new Rt("door","/resources/sound/door.mp3"),new Rt("music","/resources/sound/music.wav",{volume:50}),new Rt("step","/resources/sound/footstep.wav"),new Rt("menu","/resources/sound/menu.wav",{volume:20}),new Rt("elevator","/resources/sound/elevator.wav"),new Rt("damage","/resources/sound/damage.wav"),this._camera=new ge("main",new g.Z(51.1,0,-88),new f.Z(0,-32)),ge.setMainCamera(this._camera),dt.loadShader([{name:"map",vertexShaderPathname:"/resources/shader/map/vert.glsl",fragmentShaderPathname:"/resources/shader/map/frag.glsl"}]),dt.loadShader([{name:"monster",vertexShaderPathname:"/resources/shader/monster/vert.glsl",fragmentShaderPathname:"/resources/shader/monster/frag.glsl"}]),dt.loadShader([{name:"door-panel",vertexShaderPathname:"/resources/shader/door-panel/vert.glsl",fragmentShaderPathname:"/resources/shader/door-panel/frag.glsl"}]),dt.loadShader([{name:"gui",vertexShaderPathname:"/resources/shader/gui/vert.glsl",fragmentShaderPathname:"/resources/shader/gui/frag.glsl"}]),dt.loadShader([{name:"text",vertexShaderPathname:"/resources/shader/text/vert.glsl",fragmentShaderPathname:"/resources/shader/text/frag.glsl"}]),dt.loadShader([{name:"image",vertexShaderPathname:"/resources/shader/image/vert.glsl",fragmentShaderPathname:"/resources/shader/image/frag.glsl"}]),dt.loadShader([{name:"effect",vertexShaderPathname:"/resources/shader/effect/vert.glsl",fragmentShaderPathname:"/resources/shader/effect/frag.glsl"}]),dt.loadTextures([{name:"level",pathname:"/resources/objects/level/level-texture.png"},{name:"elevator",pathname:"/resources/objects/level/elevator-texture.png"},{name:"elevator-door",pathname:"/resources/objects/doors/elevator-door-texture.png"},{name:"hall-door",pathname:"/resources/objects/doors/hall-door-texture.png"},{name:"door-panel-locked",pathname:"/resources/objects/panels/door-panel-locked.png"},{name:"door-panel-unlocked",pathname:"/resources/objects/panels/door-panel-unlocked.png"},{name:"door-panel-display-map",pathname:"/resources/objects/panels/display-map.png"},{name:"lamp",pathname:"/resources/objects/lamp/lamp-texture.png"},{name:"hand",pathname:"/resources/objects/gun/hand-texture.png"},{name:"gun",pathname:"/resources/objects/gun/gun-texture.png"},{name:"monster",pathname:"/resources/objects/monster/monster-texture.png"},{name:"text",pathname:"/resources/objects/8x8-font.png"}]),dt.addMaterials([new fe("empty",dt.getShader("gui")),new fe("level",dt.getShader("map"),dt.getTexture("level")),new fe("elevator",dt.getShader("map"),dt.getTexture("elevator")),new fe("elevator-door",dt.getShader("map"),dt.getTexture("elevator-door")),new fe("hall-door",dt.getShader("map"),dt.getTexture("hall-door")),new We,new fe("lamp",dt.getShader("map"),dt.getTexture("lamp")),new fe("hand",dt.getShader("map"),dt.getTexture("hand")),new fe("gun",dt.getShader("map"),dt.getTexture("gun")),new fe("monster",dt.getShader("monster"),dt.getTexture("monster")),new fe("rectangle",dt.getShader("gui")),new fe("text",dt.getShader("text"),dt.getTexture("text"))]).forEachMaterial((t=>{t.create()})),dt.loadVAO([{name:"level",objectData:"/resources/objects/level/level.obj"},{name:"level-2",objectData:"/resources/objects/level/level-2.obj"},{name:"hall",objectData:"/resources/objects/level/hall.obj"},{name:"elevator",objectData:"/resources/objects/level/elevator.obj"},{name:"elevator-door",objectData:"/resources/objects/doors/elevator-door.obj"},{name:"hall-door",objectData:"/resources/objects/doors/hall-door.obj"},{name:"door-panel",objectData:"/resources/objects/panels/door-panel.obj"},{name:"lamp",objectData:"/resources/objects/lamp/lamp.obj"},{name:"hand",objectData:"/resources/objects/gun/hand.obj"},{name:"gun-receiver",objectData:"/resources/objects/gun/receiver.obj"},{name:"gun-slider",objectData:"/resources/objects/gun/slider.obj"},{name:"monster",objectData:"/resources/objects/monster/monster.obj"},{name:"rectangle",objectData:()=>new rt([new et(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),2,!0)],2)},{name:"effect",objectData:()=>{const t=[];return t.push(new et(new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),2,!0)),t.push(new et(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),2,!0)),new rt(t,2)}}]).forEachVAO((t=>{t.create()}));const t=new He(this._camera),e=new le(this._camera);t.getRenderStrategy().add(e);const s=new Se(this._camera);t.getRenderStrategy().add(s);const r=new qe(this._camera);t.getRenderStrategy().add(r);const i=this._guiRenderer=new be(this._camera);t.getRenderStrategy().add(i),t.init(),this.getSceneManager().add(t,!0),r.setPlayer(t.get("player"),t.get("gun")),s.setPlayer(t.get("player"));const n=new Me("guiAmmunition",i),a=100-d.CANVAS.height;this.getSceneManager().getActive().add(n),n.getTransform().setTranslation(new g.Z(0,a,0)),Gt.setDisplay("ammunition",n,new g.Z(.2,.9,.9)),n.setImage(new Ne("ammunition","/resources/images/ammunition.png",i));const o=new Me("guiLife",i);this.getSceneManager().getActive().add(o),o.getTransform().setTranslation(new g.Z(0,a-50,0)),Gt.setDisplay("life",o,new g.Z(1,.2,.2)),o.setImage(new Ne("life","/resources/images/life.png",i));const h=new zt("display",i);this.getSceneManager().getActive().add(h),h.getTransform().setTranslation(new g.Z(100,100,-1).negate()),h.init();const c=new X("credits");c.getRenderStrategy().add(i),this.getSceneManager().add(c,!0),this.getSceneManager().getActive().add(new Qe("creditsEntity",'\n        "Hand (low poly)" (https://skfb.ly/Dr9p) by scribbletoad is licensed under Creative Commons Attribution (http://creativecommons.org/licenses/by/4.0/).\n        Life Icon (https://www.onlinewebfonts.com/icon/146242) Uso não-comercial, DMCA\n        AmmunitionIcon (https://www.pngwing.com/pt/free-png-stupy/download) Uso não-comercial, DMCA\n        AR15 pistol shot (https://freesound.org/people/michorvath/sounds/427598/) CC 1.0\n        metal gate 07.aif (https://freesound.org/people/thencamenow/sounds/31236/) CC 4.0\n        Atmosphere - Horror 1 (Loop) (https://freesound.org/people/julius_galla/sounds/193692/) CC 3.0\n        Indoor Footsteps.wav (https://freesound.org/people/dkiller2204/sounds/366111/) CC 1.0\n        menuChange.wav (https://freesound.org/people/victorium183/sounds/476816/) CC 1.0\n        indsustrial_elevator_door_close.wav (https://freesound.org/people/joedeshon/sounds/368738/) CC 4.0\n        Map textures by Georges "TRaK" Grondin CC BY-SA 3.0\n        PS1-style Makarov Pistol by awhiskin (https://awhiskin.itch.io/ps1-style-makarov-pistol)\n        Empty Gun Shot (https://freesound.org/people/KlawyKogut/sounds/154934/#) CC 1.0\n        Damage-1.wav (https://freesound.org/people/Deathscyp/sounds/404109/) CC 1.0\n                ',i));const l=new xe("select2",i,this.getSceneManager().getActive());this.getSceneManager().getActive().add(l),l.addOption("voltar").setExecute((()=>{this.setScene("menu")})),l.updateTranslation(d.CANVAS.width,2*d.CANVAS.height-50);const u=new X("gameover");u.getRenderStrategy().add(i),this.getSceneManager().add(u,!0);const _=new zt("gameoverDisplay",i);this.getSceneManager().getActive().add(_),_.getTransform().setTranslation(new g.Z(100,100,-1).negate());const m=new X("loading");m.getRenderStrategy().add(i),this.getSceneManager().add(m,!0);const p=new zt("loadingDisplay",i);this.getSceneManager().getActive().add(p),p.getTransform().setTranslation(new g.Z(100,100,-1).negate()),p.init();const v=new X("end");v.getRenderStrategy().add(i),this.getSceneManager().add(v,!0);const b=new zt("endDisplay",i);this.getSceneManager().getActive().add(b),b.getTransform().setTranslation(new g.Z(100,100,-1).negate());const y=new X("menu");this.getSceneManager().add(y,!0),y.getRenderStrategy().add(i);const w=new xe("select1",i,this.getSceneManager().getActive());this.getSceneManager().getActive().add(w),w.addOption("comecar").setExecute((()=>{this.setScene("loading"),Rt.Find("music").play(!0)})),w.addOption("opcao 2"),w.addOption("creditos").setExecute((()=>{this.setScene("credits")})),this.setScene("menu"),re.Find("player").setEndPoint(he.Find("elevator_1").getTransform())}changeScene(t){const e=this;switch(t.getName()){case"main":zt.Find("display").animateText("chegue ate o elevador",50,{vertical:"10%",horizontal:"center"},(function(){setTimeout((()=>this.remove()),5e3)}));break;case"loading":Rt.Find("elevator").play(!1),zt.Find("loadingDisplay").animateText("bem vindo ao inferno",50,{vertical:"10%",horizontal:"center"},(function(){setTimeout((()=>{this.remove(),e.setScene("main")}),5e3)}));break;case"end":this._camera.getTransform().setTranslation(new g.Z(51.1,0,-88)),this._camera.getTransform().setRotation(new f.Z(0,-32)),Rt.pauseAll(),Rt.Find("elevator").play(!1);const t=zt.Find("endDisplay");t.init(),t.animateText("voce chegou no fim",50,{vertical:"10%",horizontal:"center"},(function(){setTimeout((()=>{this.remove(),window.location.reload()}),5e3)}));break;case"gameover":Rt.pauseAll();const s=zt.Find("gameoverDisplay");s.init(),s.animateText("game over",50,{vertical:"10%",horizontal:"center"},(function(){setTimeout((()=>{this.remove(),window.location.reload()}),5e3)}))}}update(t,e){super.update(t,e),this._camera.update(e)}render(){super.render()}}Je(ts,"instance",void 0);const es=ts;(()=>{let t=new d(new es);window.onload=()=>{t.start()},window.onresize=()=>{t.resize()}})()},685:(t,e,s)=>{s.d(e,{Ib:()=>r,WT:()=>i});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},160:(t,e,s)=>{s.d(e,{kC:()=>n,fF:()=>a,kK:()=>o,VC:()=>h,lM:()=>c,uD:()=>l,jI:()=>u,EU:()=>d});var r,i=s(685);function n(t,e,s){var r=e[0],i=e[1],n=e[2],a=s[0],o=s[1],h=s[2];return t[0]=i*h-n*o,t[1]=n*a-r*h,t[2]=r*o-i*a,t}function a(t,e,s){var r=e[0],i=e[1],n=e[2],a=s[3]*r+s[7]*i+s[11]*n+s[15];return a=a||1,t[0]=(s[0]*r+s[4]*i+s[8]*n+s[12])/a,t[1]=(s[1]*r+s[5]*i+s[9]*n+s[13])/a,t[2]=(s[2]*r+s[6]*i+s[10]*n+s[14])/a,t}function o(t,e,s){var r=e[0],i=e[1],n=e[2];return t[0]=r*s[0]+i*s[3]+n*s[6],t[1]=r*s[1]+i*s[4]+n*s[7],t[2]=r*s[2]+i*s[5]+n*s[8],t}function h(t,e,s){var r=s[0],i=s[1],n=s[2],a=s[3],o=e[0],h=e[1],c=e[2],l=i*c-n*h,u=n*o-r*c,d=r*h-i*o,g=i*d-n*u,_=n*l-r*d,m=r*u-i*l,f=2*a;return l*=f,u*=f,d*=f,g*=2,_*=2,m*=2,t[0]=o+l+g,t[1]=h+u+_,t[2]=c+d+m,t}function c(t,e,s,r){var i=[],n=[];return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],n[0]=i[0],n[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),n[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=n[0]+s[0],t[1]=n[1]+s[1],t[2]=n[2]+s[2],t}function l(t,e,s,r){var i=[],n=[];return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],n[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),n[1]=i[1],n[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=n[0]+s[0],t[1]=n[1]+s[1],t[2]=n[2]+s[2],t}function u(t,e,s,r){var i=[],n=[];return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],n[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),n[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),n[2]=i[2],t[0]=n[0]+s[0],t[1]=n[1]+s[1],t[2]=n[2]+s[2],t}function d(t,e){var s=t[0],r=t[1],i=t[2],n=e[0],a=e[1],o=e[2],h=Math.sqrt(s*s+r*r+i*i)*Math.sqrt(n*n+a*a+o*o),c=h&&function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(t,e)/h;return Math.acos(Math.min(Math.max(c,-1),1))}r=new i.WT(3),i.WT!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0)},847:t=>{var e=function(){function t(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,s,r){return s&&t(e.prototype,s),r&&t(e,r),e}}(),s=function(){function t(e,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._reset(),this.fileContents=e,this.defaultModelName=s||"untitled"}return e(t,[{key:"_reset",value:function(){this.result={models:[],materialLibraries:[]},this.currentMaterial="",this.currentGroup="",this.smoothingGroup=0}},{key:"parse",value:function(){this._reset();for(var t,e,s=this.fileContents.split("\n"),r=0;r<s.length;r+=1){var i=(t=s[r],void 0,(e=t.indexOf("#"))>-1?t.substring(0,e):t).replace(/\s\s+/g," ").trim().split(" ");switch(i[0].toLowerCase()){case"o":this._parseObject(i);break;case"g":this._parseGroup(i);break;case"v":this._parseVertexCoords(i);break;case"vt":this._parseTextureCoords(i);break;case"vn":this._parseVertexNormal(i);break;case"s":this._parseSmoothShadingStatement(i);break;case"f":this._parsePolygon(i);break;case"mtllib":this._parseMtlLib(i);break;case"usemtl":this._parseUseMtl(i)}}return this.result}},{key:"_currentModel",value:function(){return 0==this.result.models.length&&(this.result.models.push({name:this.defaultModelName,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.currentGroup="",this.smoothingGroup=0),this.result.models[this.result.models.length-1]}},{key:"_parseObject",value:function(t){var e=t.length>=2?t[1]:this.defaultModelName;this.result.models.push({name:e,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.currentGroup="",this.smoothingGroup=0}},{key:"_parseGroup",value:function(t){if(2!=t.length)throw"Group statements must have exactly 1 argument (eg. g group_1)";this.currentGroup=t[1]}},{key:"_parseVertexCoords",value:function(t){var e=t.length>=2?parseFloat(t[1]):0,s=t.length>=3?parseFloat(t[2]):0,r=t.length>=4?parseFloat(t[3]):0;this._currentModel().vertices.push({x:e,y:s,z:r})}},{key:"_parseTextureCoords",value:function(t){var e=t.length>=2?parseFloat(t[1]):0,s=t.length>=3?parseFloat(t[2]):0,r=t.length>=4?parseFloat(t[3]):0;this._currentModel().textureCoords.push({u:e,v:s,w:r})}},{key:"_parseVertexNormal",value:function(t){var e=t.length>=2?parseFloat(t[1]):0,s=t.length>=3?parseFloat(t[2]):0,r=t.length>=4?parseFloat(t[3]):0;this._currentModel().vertexNormals.push({x:e,y:s,z:r})}},{key:"_parsePolygon",value:function(t){var e=t.length-1;if(e<3)throw"Face statement has less than 3 vertices"+this.filePath+this.lineNumber;for(var s={material:this.currentMaterial,group:this.currentGroup,smoothingGroup:this.smoothingGroup,vertices:[]},r=0;r<e;r+=1){var i=t[r+1].split("/");if(i.length<1||i.length>3)throw"Two many values (separated by /) for a single vertex"+this.filePath+this.lineNumber;var n=0,a=0,o=0;if(n=parseInt(i[0]),i.length>1&&""==!i[1]&&(a=parseInt(i[1])),i.length>2&&(o=parseInt(i[2])),0==n)throw"Faces uses invalid vertex index of 0";n<0&&(n=this._currentModel().vertices.length+1+n),s.vertices.push({vertexIndex:n,textureCoordsIndex:a,vertexNormalIndex:o})}this._currentModel().faces.push(s)}},{key:"_parseMtlLib",value:function(t){t.length>=2&&this.result.materialLibraries.push(t[1])}},{key:"_parseUseMtl",value:function(t){t.length>=2&&(this.currentMaterial=t[1])}},{key:"_parseSmoothShadingStatement",value:function(t){if(2!=t.length)throw"Smoothing group statements must have exactly 1 argument (eg. s <number|off>)";var e="off"==t[1].toLowerCase()?0:parseInt(t[1]);this.smoothingGroup=e}}]),t}();t.exports=s}},t=>{t(t.s=458)}]);
//# sourceMappingURL=index.js.map