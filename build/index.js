"use strict";(self.webpackChunkrazor=self.webpackChunkrazor||[]).push([[826],{357:(t,e,s)=>{s.d(e,{Z:()=>n});var i=s(34),r=s(394);class n extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){get ELEMENTS(){return(0,r.Z)(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+e];return this.check()}to(t){return t===this?this:(0,i.kJ)(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let s=0;s<this.ELEMENTS;++s)t[e+s]=this[s];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(i.vc)}formatString(t){let e="";for(let s=0;s<this.ELEMENTS;++s)e+=(s>0?", ":"")+(0,i.Bw)(this[s],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!(0,i.fS)(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,s){void 0===s&&(s=e,e=t,t=this);for(let i=0;i<this.ELEMENTS;++i){const r=t[i];this[i]=r+s*(e[i]-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),e[s]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(i.vc.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}},521:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(357),r=s(281),n=s(394);class a extends i.Z{get ELEMENTS(){return(0,n.Z)(!1),0}copy(t){return(0,n.Z)(!1),this}get x(){return this[0]}set x(t){this[0]=(0,r.u5)(t)}get y(){return this[1]}set y(t){this[1]=(0,r.u5)(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let s=0;s<this.ELEMENTS;++s){const i=this[s]-t[s];e+=i*i}return(0,r.u5)(e)}dot(t){let e=0;for(let s=0;s<this.ELEMENTS;++s)e+=this[s]*t[s];return(0,r.u5)(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return(0,n.Z)(t>=0&&t<this.ELEMENTS,"index is out of range"),(0,r.u5)(this[t])}setComponent(t,e){return(0,n.Z)(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}},855:(t,e,s)=>{s.d(e,{Z:()=>c});var i=s(521),r=s(34),n=s(281),a=s(160),o=s(31);const h=[0,0,0],l={};class c extends i.Z{static get ZERO(){return l.ZERO=l.ZERO||Object.freeze(new c(0,0,0,0))}constructor(t=0,e=0,s=0){super(-0,-0,-0),1===arguments.length&&(0,r.kJ)(t)?this.copy(t):(r.vc.debug&&((0,n.u5)(t),(0,n.u5)(e),(0,n.u5)(s)),this[0]=t,this[1]=e,this[2]=s)}set(t,e,s){return this[0]=t,this[1]=e,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return r.vc.debug&&((0,n.u5)(t.x),(0,n.u5)(t.y),(0,n.u5)(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=(0,n.u5)(t)}angle(t){return a.EU(this,t)}cross(t){return a.kC(this,this,t),this.check()}rotateX({radians:t,origin:e=h}){return a.lM(this,this,e,t),this.check()}rotateY({radians:t,origin:e=h}){return a.uD(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=h}){return a.jI(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return a.fF(this,this,t),this.check()}transformAsVector(t){return(0,o.pL)(this,this,t),this.check()}transformByMatrix3(t){return a.kK(this,this,t),this.check()}transformByMatrix2(t){return(0,o.eQ)(this,this,t),this.check()}transformByQuaternion(t){return a.VC(this,this,t),this.check()}}},394:(t,e,s)=>{function i(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}s.d(e,{Z:()=>i})},34:(t,e,s)=>{s.d(e,{vc:()=>r,Bw:()=>n,kJ:()=>a,Yr:()=>o,fS:()=>h}),Math.PI;const i=1/180*Math.PI,r={};function n(t,{precision:e=r.precision||4}={}){return t=function(t){return Math.round(t/r.EPSILON)*r.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function a(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function o(t){return function(t,e){return function(t,e,s){if(a(t)){s=s||((i=t).clone?i.clone():new Array(i.length));for(let i=0;i<s.length&&i<t.length;++i)s[i]=e(t[i],i,s);return s}var i;return e(t)}(t,(t=>t*i),void 0)}(t)}function h(t,e,s){const i=r.EPSILON;s&&(r.EPSILON=s);try{if(t===e)return!0;if(a(t)&&a(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!h(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{r.EPSILON=i}}r.EPSILON=1e-12,r.debug=!1,r.precision=4,r.printTypes=!1,r.printDegrees=!1,r.printRowMajor=!0},31:(t,e,s)=>{function i(t,e,s){const i=e[0],r=e[1],n=s[3]*i+s[7]*r||1;return t[0]=(s[0]*i+s[4]*r)/n,t[1]=(s[1]*i+s[5]*r)/n,t}function r(t,e,s){const i=e[0],r=e[1],n=e[2],a=s[3]*i+s[7]*r+s[11]*n||1;return t[0]=(s[0]*i+s[4]*r+s[8]*n)/a,t[1]=(s[1]*i+s[5]*r+s[9]*n)/a,t[2]=(s[2]*i+s[6]*r+s[10]*n)/a,t}function n(t,e,s){const i=e[0],r=e[1];return t[0]=s[0]*i+s[2]*r,t[1]=s[1]*i+s[3]*r,t[2]=e[2],t}function a(t,e,s){const i=e[0],r=e[1];return t[0]=s[0]*i+s[2]*r,t[1]=s[1]*i+s[3]*r,t[2]=e[2],t[3]=e[3],t}function o(t,e,s){const i=e[0],r=e[1],n=e[2];return t[0]=s[0]*i+s[3]*r+s[6]*n,t[1]=s[1]*i+s[4]*r+s[7]*n,t[2]=s[2]*i+s[5]*r+s[8]*n,t[3]=e[3],t}s.d(e,{pb:()=>i,pL:()=>r,eQ:()=>n,G7:()=>a,_x:()=>o})},281:(t,e,s)=>{s.d(e,{u5:()=>r,IL:()=>n,x9:()=>o});var i=s(34);function r(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function n(t,e,s=""){if(i.vc.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(s," some fields set to invalid numbers'"));return t}const a={};function o(t,e){a[t]||(a[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}},181:(t,e,s)=>{s.d(e,{Z:()=>n});var i=s(855);class r extends i.Z{constructor(t=0,e=0,s=0){super(t,e,s)}add(t){return super.add(t),this}get pitch(){return this.x}get yaw(){return this.y}get roll(){return this.z}set pitch(t){this.x=t}set yaw(t){this.y=t}set roll(t){this.z=t}}const n=r},26:(t,e,s)=>{var i=null;const r=class{static init(t){if(t||(t=document.createElement("canvas"),document.body.appendChild(t)),void 0===(i=t.getContext("webgl")))throw new Error("Unable to initialize WebGL!");return t}static drawByIndices(t){i.drawElements(i.TRIANGLES,t,i.UNSIGNED_SHORT,0)}static draw(t){i.drawArrays(i.TRIANGLES,0,t)}static drawBuffer(t){}};function n(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const a={KEY_0:"Digit0",KEY_1:"Digit1",KEY_2:"Digit2",KEY_3:"Digit3",KEY_4:"Digit4",KEY_5:"Digit5",KEY_6:"Digit6",KEY_7:"Digit7",KEY_8:"Digit8",KEY_9:"Digit9",KEY_A:"KeyA",KEY_B:"KeyB",KEY_C:"KeyC",KEY_D:"KeyD",KEY_E:"KeyE",KEY_F:"KeyF",KEY_G:"KeyG",KEY_H:"KeyH",KEY_I:"KeyI",KEY_J:"KeyJ",KEY_K:"KeyK",KEY_L:"KeyL",KEY_M:"KeyM",KEY_N:"KeyN",KEY_O:"KeyO",KEY_P:"KeyP",KEY_Q:"KeyQ",KEY_R:"KeyR",KEY_S:"KeyS",KEY_T:"KeyT",KEY_U:"KeyU",KEY_V:"KeyV",KEY_X:"KeyX",KEY_W:"KeyW",KEY_Y:"KeyY",KEY_Z:"KeyZ",KEY_SPACE:"Space",KEY_ESCAPE:"Escape",KEY_ENTER:"Enter",KEY_BACKSPACE:"Backspace",KEY_INSERT:"Insert",KEY_DELETE:"Delete",KEY_ALT_L:"AltLeft",KEY_ALT_R:"AltRight",KEY_CTRL_L:"ControlLeft",KEY_CTRL_R:"ControlRight",KEY_SHIFT_L:"ShiftLeft",KEY_SHIFT_R:"ShiftRight",KEY_UP:"ArrowUp",KEY_DOWN:"ArrowDown",KEY_LEFT:"ArrowLeft",KEY_RIGHT:"ArrowRight",KEY_HOME:"Home",KEY_END:"End",KEY_PAGEUP:"PageUp",KEY_PAGEDOWN:"PageDown",KEY_BACKQUOTE:"Backquote",KEY_MINUS:"Minus",KEY_EQUAL:"Equal",KEY_BRACKET_L:"Bracketleft",KEY_BRACKET_R:"BracketRight",KEY_BACKSLASH:"Backslash",KEY_SEMICOLON:"Semicolon",KEY_QUOTE:"Quote",KEY_COMMA:"Comma",KEY_PERIOD:"Period",KEY_SLASH:"Slash"};class o{static init(){o._bufferKeys=[],o._keys=new Map,Object.keys(a).forEach((t=>{o._keys.set(t,!1)})),window.addEventListener("keydown",o.onKeyDown),window.addEventListener("keyup",o.onKeyUp),o._mouseButtons=[!1,!1,!1],o._currentMousePosition=[0,0],o._previousMousePosition=[0,0],o._mouseMovement=[0,0],u.CANVAS.addEventListener("mousedown",o.onMouseDown),u.CANVAS.addEventListener("mouseup",o.onMouseUp),u.CANVAS.addEventListener("mousemove",o.onMouseMove),this._shouldDebug=!1}static isKeyPressedDown(t){return!o._bufferKeys.includes(t)&&1==o._keys.get(t)&&(o._bufferKeys.push(t),!0)}static isKeyPressed(t){return o._keys.get(t)}static onKeyDown(t){u.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._keys.set(t.code,!0))}static onKeyUp(t){u.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._keys.set(t.code,!1),o._bufferKeys=o._bufferKeys.filter((e=>e!=t.code)))}static update(){o._mouseMovement[0]=o._currentMousePosition[0]-o._previousMousePosition[0],o._mouseMovement[1]=o._currentMousePosition[1]-o._previousMousePosition[1],o._previousMousePosition[0]=o._currentMousePosition[0],o._previousMousePosition[1]=o._currentMousePosition[1]}static isMouseLeft(){return o._mouseButtons[0]}static isMouseMiddle(){return o._mouseButtons[1]}static isMouseRight(){return o._mouseButtons[2]}static getMouseX(){return o._currentMousePosition[0]}static getMouseY(){return o._currentMousePosition[1]}static getMouseDX(){return o._mouseMovement[0]}static getMouseDY(){return o._mouseMovement[1]}static onMouseDown(t){t.stopPropagation(),t.preventDefault(),o._mouseButtons[t.button]=u.IS_MOUSE_INSIDE}static onMouseUp(t){u.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._mouseButtons[t.button]=!1)}static onMouseMove(t){u.IS_MOUSE_INSIDE&&(t.stopPropagation(),t.preventDefault(),o._currentMousePosition[0]-=t.movementX,o._currentMousePosition[1]-=t.movementY,o._shouldDebug&&(console.log(`offset:  ${t.offsetX}X ${t.offsetY}Y`),console.log(`client:  ${t.clientX}X ${t.clientY}Y`),console.log(`screen:  ${t.screenX}X ${t.screenY}Y`)))}static setDebug(t){o._shouldDebug=t}static shouldDebug(){return o._shouldDebug}}n(o,"_mouseButtons",void 0),n(o,"_currentMousePosition",void 0),n(o,"_previousMousePosition",void 0),n(o,"_mouseMovement",void 0),n(o,"_bufferKeys",void 0),n(o,"_keys",void 0),n(o,"_shouldDebug",void 0);const h=o;function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class d{constructor(t,e){c(this,"_gameLoop",void 0),c(this,"_gameCore",void 0),c(this,"_started",void 0),d.CANVAS=r.init(e),Object.defineProperty(this,"CANVAS",{writable:!1}),i.clearColor(0,0,0,1),this._gameLoop=new class{constructor(t){l(this,"_gameCore",void 0),l(this,"_then",void 0),l(this,"_frameBuffer",void 0),l(this,"loop",(t=>{const e=(t*=.001)-this._then;this._then=t;const s=1/e;document.querySelector("#fps span").textContent=s.toFixed(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),h.update(),this._gameCore.update(t,e),this._gameCore.render(e),requestAnimationFrame(this.loop)})),this._gameCore=t,this._then=0}start(){this._gameCore.start(),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enable(i.CULL_FACE),i.depthFunc(i.LESS),this.loop(0)}}(t),this._started=!1,this._gameCore=t,d.FOCUSED=Boolean(!!e),d.IS_MOUSE_INSIDE=Boolean(!!e)}start(){d.IS_MOUSE_INSIDE||this.configs(),this.resize(),h.init(),this._gameLoop.start(),this._started=!0}resize(){if(void 0===d.CANVAS)throw new Error("Canvas was not initialized!");d.CANVAS.width=d.CANVAS.offsetWidth,d.CANVAS.height=d.CANVAS.offsetHeight,i.viewport(0,0,d.CANVAS.width,d.CANVAS.height)}configs(){d.CANVAS.addEventListener("click",(t=>{d.IS_MOUSE_INSIDE||(d.FOCUSED=d.isInsideCanvas(t.clientX,t.clientY),d.CANVAS.requestPointerLock())})),document.addEventListener("pointerlockchange",(t=>{d.IS_MOUSE_INSIDE=!d.IS_MOUSE_INSIDE})),d.CANVAS.addEventListener("mousemove",(t=>{})),d.CANVAS.addEventListener("mouseleave",(t=>{d.IS_MOUSE_INSIDE=!1}))}static isInsideCanvas(t,e){return t>d.CANVAS.offsetLeft&&t<d.CANVAS.offsetLeft+d.CANVAS.offsetWidth&&e>d.CANVAS.offsetTop&&e<d.CANVAS.offsetTop+d.CANVAS.offsetHeight}isStarted(){return this._started}getGameCore(){return this._gameCore}}c(d,"CANVAS",void 0),c(d,"FOCUSED",void 0),c(d,"IS_MOUSE_INSIDE",void 0);const u=d;var g=s(855);function _(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const m=class{constructor(t,e){_(this,"_name",void 0),_(this,"_scene",void 0),_(this,"_camera",void 0),_(this,"_maximumRenderDistance",void 0),this._name=t,this._camera=e,this._maximumRenderDistance=-1}getEntitiesByMaterial(t){return this._scene.filterVisible((e=>e.getRenderer()&&e.getRenderer().getName()===this._name&&e.getMaterial()&&e.getMaterial().getName()===t.getName()&&(this._maximumRenderDistance<0||this._camera.getTransform().getTranslation().distanceTo(e.getTransform().getTranslation())<this._maximumRenderDistance)))}getEntitiesByShader(t){return this._scene.filterVisible((e=>e.getRenderer().getName()===this._name&&e.getMaterial().getShader().getName()===t.getName()))}getName(){return this._name}setScene(t){this._scene=t}getScene(){return this._scene}getCamera(){return this._camera}};var f=s(181),p=s(281),b=s(357),v=s(34),T=s(394);class E extends b.Z{get ELEMENTS(){return(0,T.Z)(!1),0}get RANK(){return(0,T.Z)(!1),0}toString(){let t="[";if(v.vc.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let s=0;s<this.RANK;++s)t+=" ".concat(this[s*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,s){return this[e*this.RANK+t]=(0,p.u5)(s),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[s+t];return e}setColumn(t,e){const s=t*this.RANK;for(let t=0;t<this.RANK;++t)this[s+t]=e[t];return this}}var y=s(31),w=s(685);function x(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],c=e[7],d=e[8],u=e[9],g=e[10],_=e[11],m=e[12],f=e[13],p=e[14],b=e[15],v=s[0],T=s[1],E=s[2],y=s[3];return t[0]=v*i+T*o+E*d+y*m,t[1]=v*r+T*h+E*u+y*f,t[2]=v*n+T*l+E*g+y*p,t[3]=v*a+T*c+E*_+y*b,v=s[4],T=s[5],E=s[6],y=s[7],t[4]=v*i+T*o+E*d+y*m,t[5]=v*r+T*h+E*u+y*f,t[6]=v*n+T*l+E*g+y*p,t[7]=v*a+T*c+E*_+y*b,v=s[8],T=s[9],E=s[10],y=s[11],t[8]=v*i+T*o+E*d+y*m,t[9]=v*r+T*h+E*u+y*f,t[10]=v*n+T*l+E*g+y*p,t[11]=v*a+T*c+E*_+y*b,v=s[12],T=s[13],E=s[14],y=s[15],t[12]=v*i+T*o+E*d+y*m,t[13]=v*r+T*h+E*u+y*f,t[14]=v*n+T*l+E*g+y*p,t[15]=v*a+T*c+E*_+y*b,t}function S(t,e,s){var i=s[0],r=s[1],n=s[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function N(t,e,s){var i=e[0],r=e[1];return t[0]=s[0]*i+s[4]*r+s[12],t[1]=s[1]*i+s[5]*r+s[13],t}A=new w.WT(2),w.WT!=Float32Array&&(A[0]=0,A[1]=0);var A,M=s(160);!function(){var t=new w.WT(4);w.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();const O=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),C=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),I=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),R={};class L extends E{static get IDENTITY(){return R.IDENTITY=R.IDENTITY||Object.freeze(new L(O)),R.IDENTITY}static get ZERO(){return R.ZERO=R.ZERO||Object.freeze(new L(C)),R.ZERO}get INDICES(){return I}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,s,i,r,n,a,o,h,l,c,d,u,g,_,m){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this[4]=r,this[5]=n,this[6]=a,this[7]=o,this[8]=h,this[9]=l,this[10]=c,this[11]=d,this[12]=u,this[13]=g,this[14]=_,this[15]=m,this.check()}setRowMajor(t,e,s,i,r,n,a,o,h,l,c,d,u,g,_,m){return this[0]=t,this[1]=r,this[2]=h,this[3]=u,this[4]=e,this[5]=n,this[6]=l,this[7]=g,this[8]=s,this[9]=a,this[10]=c,this[11]=_,this[12]=i,this[13]=o,this[14]=d,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(O)}fromQuaternion(t){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=s+s,o=i+i,h=r+r,l=s*a,c=i*a,d=i*o,u=r*a,g=r*o,_=r*h,m=n*a,f=n*o,p=n*h;t[0]=1-d-_,t[1]=c+p,t[2]=u-f,t[3]=0,t[4]=c-p,t[5]=1-l-_,t[6]=g+m,t[7]=0,t[8]=u+f,t[9]=g-m,t[10]=1-l-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum({left:t,right:e,bottom:s,top:i,near:r,far:n}){return n===1/0?L._computeInfinitePerspectiveOffCenter(this,t,e,s,i,r):function(t,e,s,i,r,n,a){var o=1/(s-e),h=1/(r-i),l=1/(n-a);t[0]=2*n*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*h,t[6]=0,t[7]=0,t[8]=(s+e)*o,t[9]=(r+i)*h,t[10]=(a+n)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n*2*l,t[15]=0}(this,t,e,s,i,r,n),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,s,i,r,n){const a=2*n/(s-e),o=2*n/(r-i),h=(s+e)/(s-e),l=(r+i)/(r-i),c=-2*n;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=h,t[9]=l,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=c,t[15]=0,t}lookAt(t,e,s){return 1===arguments.length&&({eye:t,center:e,up:s}=t),function(t,e,s,i){var r,n,a,o,h,l,c,d,u,g,_=e[0],m=e[1],f=e[2],p=i[0],b=i[1],v=i[2],T=s[0],E=s[1],y=s[2];Math.abs(_-T)<w.Ib&&Math.abs(m-E)<w.Ib&&Math.abs(f-y)<w.Ib?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(c=_-T,d=m-E,u=f-y,r=b*(u*=g=1/Math.hypot(c,d,u))-v*(d*=g),n=v*(c*=g)-p*u,a=p*d-b*c,(g=Math.hypot(r,n,a))?(r*=g=1/g,n*=g,a*=g):(r=0,n=0,a=0),o=d*a-u*n,h=u*r-c*a,l=c*n-d*r,(g=Math.hypot(o,h,l))?(o*=g=1/g,h*=g,l*=g):(o=0,h=0,l=0),t[0]=r,t[1]=o,t[2]=c,t[3]=0,t[4]=n,t[5]=h,t[6]=d,t[7]=0,t[8]=a,t[9]=l,t[10]=u,t[11]=0,t[12]=-(r*_+n*m+a*f),t[13]=-(o*_+h*m+l*f),t[14]=-(c*_+d*m+u*f),t[15]=1)}(this,t,e=e||[0,0,0],s=s||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:s,top:i,near:r=.1,far:n=500}){return function(t,e,s,i,r,n,a){var o=1/(e-s),h=1/(i-r),l=1/(n-a);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+s)*o,t[13]=(r+i)*h,t[14]=(a+n)*l,t[15]=1}(this,t,e,s,i,r,n),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:s=1,near:i=.1,far:r=500}){if(t>2*Math.PI)throw Error("radians");const n=t/2,a=s*Math.tan(n),o=a*e;return(new L).ortho({left:-o,right:o,bottom:-a,top:a,near:i,far:r})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:s=1,near:i=.1,far:r=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return function(t,e,s,i,r){var n,a=1/Math.tan(e/2);t[0]=a/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(n=1/(i-r),t[10]=(r+i)*n,t[14]=2*r*i*n):(t[10]=-1,t[14]=-2*i)}(this,t,s,i,r),this.check()}determinant(){return e=(t=this)[0],s=t[1],i=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],c=t[9],d=t[10],u=t[11],g=t[12],_=t[13],m=t[14],(e*a-s*n)*(d*(f=t[15])-u*m)-(e*o-i*n)*(c*f-u*_)+(e*h-r*n)*(c*m-d*_)+(s*o-i*a)*(l*f-u*g)-(s*h-r*a)*(l*m-d*g)+(i*h-r*o)*(l*_-c*g);var t,e,s,i,r,n,a,o,h,l,c,d,u,g,_,m,f}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const s=this.getScale(e||[-0,-0,-0]),i=1/s[0],r=1/s[1],n=1/s[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*n,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*r,t[6]=this[6]*n,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*r,t[10]=this[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const s=this.getScale(e||[-0,-0,-0]),i=1/s[0],r=1/s[1],n=1/s[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*n,t[3]=this[4]*i,t[4]=this[5]*r,t[5]=this[6]*n,t[6]=this[8]*i,t[7]=this[9]*r,t[8]=this[10]*n,t}transpose(){return function(t,e){if(t===e){var s=e[1],i=e[2],r=e[3],n=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=s,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=r,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],d=e[9],u=e[10],g=e[11],_=e[12],m=e[13],f=e[14],p=e[15],b=s*o-i*a,v=s*h-r*a,T=s*l-n*a,E=i*h-r*o,y=i*l-n*o,w=r*l-n*h,x=c*m-d*_,S=c*f-u*_,N=c*p-g*_,A=d*f-u*m,M=d*p-g*m,O=u*p-g*f,C=b*O-v*M+T*A+E*N-y*S+w*x;C&&(C=1/C,t[0]=(o*O-h*M+l*A)*C,t[1]=(r*M-i*O-n*A)*C,t[2]=(m*w-f*y+p*E)*C,t[3]=(u*y-d*w-g*E)*C,t[4]=(h*N-a*O-l*S)*C,t[5]=(s*O-r*N+n*S)*C,t[6]=(f*T-_*w-p*v)*C,t[7]=(c*w-u*T+g*v)*C,t[8]=(a*M-o*N+l*x)*C,t[9]=(i*N-s*M-n*x)*C,t[10]=(_*y-m*T+p*b)*C,t[11]=(d*T-c*y-g*b)*C,t[12]=(o*S-a*A-h*x)*C,t[13]=(s*A-i*S+r*x)*C,t[14]=(m*v-_*E-f*b)*C,t[15]=(c*E-d*v+u*b)*C)}(this,this),this.check()}multiplyLeft(t){return x(this,t,this),this.check()}multiplyRight(t){return x(this,this,t),this.check()}rotateX(t){return function(t,e,s){var i=Math.sin(s),r=Math.cos(s),n=e[4],a=e[5],o=e[6],h=e[7],l=e[8],c=e[9],d=e[10],u=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+l*i,t[5]=a*r+c*i,t[6]=o*r+d*i,t[7]=h*r+u*i,t[8]=l*r-n*i,t[9]=c*r-a*i,t[10]=d*r-o*i,t[11]=u*r-h*i}(this,this,t),this.check()}rotateY(t){return function(t,e,s){var i=Math.sin(s),r=Math.cos(s),n=e[0],a=e[1],o=e[2],h=e[3],l=e[8],c=e[9],d=e[10],u=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r-l*i,t[1]=a*r-c*i,t[2]=o*r-d*i,t[3]=h*r-u*i,t[8]=n*i+l*r,t[9]=a*i+c*r,t[10]=o*i+d*r,t[11]=h*i+u*r}(this,this,t),this.check()}rotateZ(t){return function(t,e,s){var i=Math.sin(s),r=Math.cos(s),n=e[0],a=e[1],o=e[2],h=e[3],l=e[4],c=e[5],d=e[6],u=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+l*i,t[1]=a*r+c*i,t[2]=o*r+d*i,t[3]=h*r+u*i,t[4]=l*r-n*i,t[5]=c*r-a*i,t[6]=d*r-o*i,t[7]=u*r-h*i}(this,this,t),this.check()}rotateXYZ([t,e,s]){return this.rotateX(t).rotateY(e).rotateZ(s)}rotateAxis(t,e){return function(t,e,s,i){var r,n,a,o,h,l,c,d,u,g,_,m,f,p,b,v,T,E,y,x,S,N,A,M,O=i[0],C=i[1],I=i[2],R=Math.hypot(O,C,I);R<w.Ib||(O*=R=1/R,C*=R,I*=R,r=Math.sin(s),a=1-(n=Math.cos(s)),o=e[0],h=e[1],l=e[2],c=e[3],d=e[4],u=e[5],g=e[6],_=e[7],m=e[8],f=e[9],p=e[10],b=e[11],v=O*O*a+n,T=C*O*a+I*r,E=I*O*a-C*r,y=O*C*a-I*r,x=C*C*a+n,S=I*C*a+O*r,N=O*I*a+C*r,A=C*I*a-O*r,M=I*I*a+n,t[0]=o*v+d*T+m*E,t[1]=h*v+u*T+f*E,t[2]=l*v+g*T+p*E,t[3]=c*v+_*T+b*E,t[4]=o*y+d*x+m*S,t[5]=h*y+u*x+f*S,t[6]=l*y+g*x+p*S,t[7]=c*y+_*x+b*S,t[8]=o*N+d*A+m*M,t[9]=h*N+u*A+f*M,t[10]=l*N+g*A+p*M,t[11]=c*N+_*A+b*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?S(this,this,t):S(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,s){var i,r,n,a,o,h,l,c,d,u,g,_,m=s[0],f=s[1],p=s[2];e===t?(t[12]=e[0]*m+e[4]*f+e[8]*p+e[12],t[13]=e[1]*m+e[5]*f+e[9]*p+e[13],t[14]=e[2]*m+e[6]*f+e[10]*p+e[14],t[15]=e[3]*m+e[7]*f+e[11]*p+e[15]):(i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],c=e[7],d=e[8],u=e[9],g=e[10],_=e[11],t[0]=i,t[1]=r,t[2]=n,t[3]=a,t[4]=o,t[5]=h,t[6]=l,t[7]=c,t[8]=d,t[9]=u,t[10]=g,t[11]=_,t[12]=i*m+o*f+d*p+e[12],t[13]=r*m+h*f+u*p+e[13],t[14]=n*m+l*f+g*p+e[14],t[15]=a*m+c*f+_*p+e[15])}(this,this,t),this.check()}transform(t,e){return 4===t.length?(e=function(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3];return t[0]=s[0]*i+s[4]*r+s[8]*n+s[12]*a,t[1]=s[1]*i+s[5]*r+s[9]*n+s[13]*a,t[2]=s[2]*i+s[6]*r+s[10]*n+s[14]*a,t[3]=s[3]*i+s[7]*r+s[11]*n+s[15]*a,t}(e||[-0,-0,-0,-0],t,this),(0,p.IL)(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:s}=t;switch(s){case 2:e=N(e||[-0,-0],t,this);break;case 3:e=M.fF(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return(0,p.IL)(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=(0,y.pb)(e||[-0,-0],t,this);break;case 3:e=(0,y.pL)(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return(0,p.IL)(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,s){return this.identity().translate([t,e,s])}transformPoint(t,e){return(0,p.x9)("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return(0,p.x9)("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return(0,p.x9)("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}var P=s(521);class F extends P.Z{constructor(t=0,e=0){super(2),(0,v.kJ)(t)&&1===arguments.length?this.copy(t):(v.vc.debug&&((0,p.u5)(t),(0,p.u5)(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return v.vc.debug&&((0,p.u5)(t.x),(0,p.u5)(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return N(this,this,t),this.check()}transformAsVector(t){return(0,y.pb)(this,this,t),this.check()}transformByMatrix3(t){return function(t,e,s){var i=e[0],r=e[1];t[0]=s[0]*i+s[3]*r+s[6],t[1]=s[1]*i+s[4]*r+s[7]}(this,this,t),this.check()}transformByMatrix2x3(t){return function(t,e,s){var i=e[0],r=e[1];t[0]=s[0]*i+s[2]*r+s[4],t[1]=s[1]*i+s[3]*r+s[5]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,s){var i=e[0],r=e[1];t[0]=s[0]*i+s[2]*r,t[1]=s[1]*i+s[3]*r}(this,this,t),this.check()}}const D=t=>t*Math.PI/180,k=(t,e)=>{if(t.a===t.b)throw new Error("The points are equal");if(0!==t.a&&0!==t.b){const s=-t.a/t.b,i=-t.c/t.b,r=1+s**2,n=-2*e.a-2*e.b*s+2*s*i,a=e.a**2+e.b**2-e.r**2+i**2-2*e.b*i,o=Y({a:r,b:n,c:a});if(!o)return null;const h=K(t,o.v1);return{p1:new F(o.v1,h),p2:new F(o.v2,o.v1===o.v2?h:K(t,o.v2))}}if(0===t.a&&0!==t.b){const s=-t.c/t.b,i=1,r=-2*e.a,n=e.a**2+e.b**2-e.r**2+s**2-2*e.b*s,a=Y({a:i,b:r,c:n});if(!a)return null;const o=K(t,a.v1);return{p1:new F(a.v1,o),p2:new F(a.v2,a.v1===a.v2?o:K(t,a.v2))}}const s=-t.c/t.a,i=-2*e.b,r=e.a**2+e.b**2-e.r**2+s**2-2*e.a*s,n=Y({a:1,b:i,c:r});if(!n)return null;const a=B(t,n.v1);return{p1:new F(a,n.v1),p2:new F(n.v1===n.v2?a:B(t,n.v2),n.v2)}},V=(t,e)=>({a:t.y-e.y,b:e.x-t.x,c:t.x*e.y-t.y*e.x}),j=(t,e)=>({a:t.x,b:t.y,r:e instanceof F?t.distanceTo(e):e}),K=(t,e)=>(-t.a*e-t.c)/t.b,B=(t,e)=>(-t.b*e-t.c)/t.a,Y=t=>{const e=t.b**2-4*t.a*t.c;if(e<0)return null;const s=Math.sqrt(e),i=(-t.b+s)/(2*t.a);return{v1:i,v2:0===e?i:(-t.b-s)/(2*t.a)}};function Z(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const z=class{constructor(t,e,s){Z(this,"translation",void 0),Z(this,"rotation",void 0),Z(this,"scale",void 0),this.translation=t??new g.Z,this.rotation=e??new f.Z,this.scale=s??new g.Z(1,1,1)}toMatrix(){return this._toMatrix(this.translation.clone().negate())}toMatrixIgnoringZ(){return this._toMatrix(new g.Z(this.translation.x,this.translation.y,0).negate())}toInversePositionMatrix(){return this._toMatrix(this.translation.clone())}_toMatrix(t){const e=(new L).translate(t),s=(new L).rotateX((0,v.Yr)(this.rotation.pitch)),i=(new L).rotateY((0,v.Yr)(this.rotation.yaw)),r=(new L).rotateZ((0,v.Yr)(this.rotation.roll)),n=s.multiplyRight(i.multiplyRight(r)),a=(new L).scale(this.scale);return e.multiplyRight(n.multiplyRight(a))}};function U(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const H=class{constructor(t,e,s){U(this,"_entity",void 0),U(this,"_globalTransform",void 0),U(this,"_localTransform",void 0),U(this,"_children",void 0),U(this,"_parent",void 0),this._globalTransform=new z(t,e,s),this._localTransform=new z}setEntity(t){this._entity=t,this._children=new $(t.getName()+"_children")}get children(){return this._children}set parent(t){this._parent=t}get parent(){return this._parent}getTranslation(){return new g.Z(this._globalTransform.translation.x,this._globalTransform.translation.y,this._globalTransform.translation.z)}setTranslation(t){this._globalTransform.translation.x=t.x,this._globalTransform.translation.y=t.y,this._globalTransform.translation.z=t.z}setX(t){this._globalTransform.translation.x=t}setY(t){this._globalTransform.translation.y=t}setZ(t){this._globalTransform.translation.z=t}getX(){return this._globalTransform.translation.x}getY(){return this._globalTransform.translation.y}getZ(){return this._globalTransform.translation.z}getRotation(){return new f.Z(this._globalTransform.rotation.pitch,this._globalTransform.rotation.yaw,this._globalTransform.rotation.roll)}setRotation(t){this._fixRotation(t.pitch,(t=>{this._globalTransform.rotation.pitch=t})),this._fixRotation(t.yaw,(t=>{this._globalTransform.rotation.yaw=t})),this._fixRotation(t.roll,(t=>{this._globalTransform.rotation.roll=t}))}setPitch(t){this._fixRotation(t,(t=>{this._globalTransform.rotation.pitch=t}))}setYaw(t){this._fixRotation(t,(t=>{this._globalTransform.rotation.yaw=t}))}setRoll(t){this._fixRotation(t,(t=>{this._globalTransform.rotation.roll=t}))}getPitch(){return this._globalTransform.rotation.pitch}getYaw(){return this._globalTransform.rotation.yaw}getRoll(){return this._globalTransform.rotation.roll}_fixRotation(t,e){t>=360&&(t%=360,t-=360),t<=-360&&(t%=360,t+=360),e(t)}getScale(){return new g.Z(this._globalTransform.scale.x,this._globalTransform.scale.y,this._globalTransform.scale.z)}setScale(t){this._globalTransform.scale=t}toMatrix(){return this._globalTransform.toMatrix().multiplyRight(this._localTransform.toMatrix())}toMatrixIgnoringZ(){return this._globalTransform.toMatrixIgnoringZ().multiplyRight(this._localTransform.toMatrixIgnoringZ())}toInversePositionMatrix(){return this._globalTransform.toInversePositionMatrix().multiplyRight(this._localTransform.toInversePositionMatrix())}worldMatrix(){const t=this.toMatrix();let e=t.clone();return this._parent&&(e=this._parent.worldMatrix().multiplyRight(t)),e}worldMatrixIgnoringZ(){const t=this.toMatrixIgnoringZ();let e=t.clone();return this._parent&&(e=this._parent.worldMatrixIgnoringZ().multiplyRight(t)),e}worldMatrixFrom(t){const e=(new L).translate(t.getTranslation()),s=(new L).rotateX(D(t.getPitch())),i=(new L).rotateY(D(t.getYaw())),r=(new L).rotateZ(D(t.getRoll())),n=s.multiplyRight(i.multiplyRight(r)),a=(new L).scale(t.getScale());return e.multiplyRight(n.multiplyRight(a))}worldTranslation(){let t=this._globalTransform.translation.clone().add(this._localTransform.translation);return this._parent&&(t=this._parent.worldTranslation().add(t)),t}getLocalTransform(){return this._localTransform}};function G(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class W{constructor(t,e,s,i){G(this,"_name",void 0),G(this,"_vao",void 0),G(this,"_material",void 0),G(this,"_renderer",void 0),G(this,"_transform",void 0),G(this,"_scene",void 0),W._listEntities.set(t,this),this._name=t,this._vao=e,this._material=s,this._renderer=i,this._transform=new H,this.getTransform().setEntity(this)}static Find(t){return W._listEntities.get(t)}render(){}setVAO(t){this._vao=t}setMaterial(t){this._material=t}setRenderer(t){this._renderer=t}getVAO(){return this._vao}getMaterial(){return this._material}getRenderer(){return this._renderer}getName(){return this._name}getTransform(){return this._transform}setScene(t){this._scene=t}getScene(){return this._scene}}G(W,"_listEntities",new Map);const X=W;function q(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const $=class{constructor(t){q(this,"_name",void 0),q(this,"_entities",void 0),q(this,"_visible",void 0),q(this,"_hidden",void 0),q(this,"_renderStrategy",void 0),q(this,"_onChangeEvent",void 0),q(this,"_keys",(t=>[...t.keys()])),this._name=t,this._entities=new Map,this._visible=new Map,this._hidden=new Map,this._renderStrategy=new class{constructor(){var t,e;e=void 0,(t="_renderers")in this?Object.defineProperty(this,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):this[t]=e,this._renderers=new Map}render(t,e){this._renderers.forEach((s=>{s.setScene(e),s.render(t)}))}add(t,e=!1){const s=this._validate(t);this._renderers.set(s,t)}remove(t){const e=this._validate(t,!1);this._renderers.delete(e)}get(t){return this._validate(t,!1),this._renderers.get(t)}getKeys(){return[...this._renderers.keys()]}forEach(t){this._renderers.forEach(((e,s)=>{t(e,s)}))}has(t){const e=this._getName(t);return this._renderers.has(e)}_validate(t,e=!0){const s=this._getName(t);if(e&&this._renderers.has(s))throw new Error(`Renderer ${s} already exists!`);if(!e&&!this._renderers.has(s))throw new Error(`Renderer ${s} does not exists!`);return s}_getName(t){return t instanceof m?t.getName():t}},this._onChangeEvent=null}update(t,e,s){this.forEachVisible((i=>{i.update(t,e,this,s)}))}render(t){this._renderStrategy.render(t,this)}add(t,e=!0){return this._validate(t,this._entities),t.setScene(this),this._entities.set(t.getName(),t),e?this._visible.set(t.getName(),t):this._hidden.set(t.getName(),t),this}remove(t){const e=this._validate(t,this._entities,!1),s=this._entities.get(e);return this._entities.delete(e),s.setScene(null),this._visible.has(e)&&this._visible.delete(e),this._hidden.has(e)&&this._hidden.delete(e),this}setVisibility(t,e){const s=this._validate(t,this._entities,!1);return e?(this._visible.set(s,this._hidden.get(s)),this._hidden.delete(s)):(this._hidden.set(s,this._visible.get(s)),this._visible.delete(s)),this}get(t){return this._validate(t,this._entities,!1),this._entities.get(t)}getKeys(){return this._keys(this._entities)}getKeysFromVisible(){return this._keys(this._visible)}getKeysFromHidden(){return this._keys(this._hidden)}forEach(t){return this._forEach(t,this._entities),this}forEachVisible(t){return this._forEach(t,this._visible),this}forEachHidden(t){return this._forEach(t,this._hidden),this}_forEach(t,e){e.forEach(t)}has(t){return this._has(t,this._entities)}hasInVisible(t){return this._has(t,this._visible)}hasInHidden(t){return this._has(t,this._hidden)}_has(t,e){const s=this._getName(t);return e.has(s)}filterVisible(t){const e=[];return this._visible.forEach((s=>{t(s)&&e.push(s)})),e}_validate(t,e,s=!0){const i=this._getName(t);if(s&&e.has(i))throw new Error(`Entity ${i} already exists!`);if(!s&&!e.has(i))throw new Error(`Entity ${i} does not exists!`);return i}_getName(t){return t instanceof X?t.getName():t}getName(){return this._name}get entities(){return this._entities}getRenderStrategy(){return this._renderStrategy}onChange(t){this._onChangeEvent=t}getOnChangeEvent(){return this._onChangeEvent}};var Q=s(355);function J(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class tt{constructor(){J(this,"_scenes",void 0),J(this,"_active",void 0),this._scenes=new Map,this._active=null}render(t){this._active.render(t)}update(t,e,s){this._active.update(t,e,s)}add(t,e=!1){const s=this._validate(t);return this._scenes.set(s,t),e&&(this._active=t,Q.Z.trigger("loadScene",this._active)),this}remove(t){const e=this._validate(t,!1);return this._scenes.delete(e),this._active.getName()===e&&(this._active=null),this}setActive(t){const e=this._validate(t,!1);return this._active=this._scenes.get(e),Q.Z.trigger("loadScene",this._active),this._active.getOnChangeEvent()?.(),this}getActive(){return this._active}get(t){return this._validate(t,!1),this._scenes.get(t)}getKeys(){return[...this._scenes.keys()]}forEach(t){return this._scenes.forEach(((e,s)=>{t(e,s)})),this}has(t){const e=this._getName(t);return this._scenes.has(e)}_validate(t,e=!0){const s=this._getName(t);if(e&&this._scenes.has(s))throw new Error(`Scene ${s} already exists!`);if(!e&&!this._scenes.has(s))throw new Error(`Scene ${s} does not exists!`);return s}_getName(t){return t instanceof $?t.getName():t}getName(){return tt.NAME}}J(tt,"NAME","scene-manager");const et=tt;function st(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function it(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const rt=class{static load(t,e,s){const i=new XMLHttpRequest;i.open("GET",t,!1),i.onload=()=>e(i.responseText),i.onerror=()=>s(i.statusText),i.send(null)}static async loadAsync(t){let e;return await fetch(t).then((t=>t.body)).then((async t=>{e=t.getReader()})),e.read().then((t=>(new TextDecoder).decode(t.value)))}};function nt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function at(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const ot=class{constructor(t,e,s,r=i.STATIC_DRAW){at(this,"_id",void 0),at(this,"_buffer",void 0),at(this,"_offset",void 0),at(this,"_created",void 0),at(this,"_isAttribute",void 0),at(this,"_usage",void 0),this._buffer=t,this._offset=e,this._created=!1,this._isAttribute=s,this._usage=r}getUsage(){return this._usage}getId(){return this._id}setId(t){this._id=t}getBuffer(){return this._buffer}setBuffer(t){this._buffer=t}getOffset(){return this._offset}setCreated(t){this._created=t}isCreated(){return this._created}getType(){return this._isAttribute?i.ARRAY_BUFFER:i.ELEMENT_ARRAY_BUFFER}getLength(){return this._buffer.length}};function ht(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const lt=class{constructor(t,e=3){ht(this,"_vboList",void 0),ht(this,"_ibo",void 0),ht(this,"_vertexCoordsOffset",void 0),this._vboList=[],t.forEach((t=>{null!=t&&(this._vboList.push(t),t.getType()===i.ELEMENT_ARRAY_BUFFER&&(this._ibo=t))})),t.length>0&&!this._ibo&&(this._ibo=t[0]),this._vertexCoordsOffset=e}addEmpty(t){const e=[];for(let s=0;s<t;s++)e.push(new ot(new Float32Array([]),2,!0,i.DYNAMIC_DRAW));this._vboList=e,this._ibo=this._vboList[0]}create(){for(let t=0;t<this._vboList.length;t++)this._createVBO(t,this._vboList[t])}_createVBO(t,e){null==e.getId()&&e.setId(i.createBuffer()),i.bindBuffer(e.getType(),e.getId()),e.getBuffer().length>0&&i.bufferData(e.getType(),e.getBuffer(),e.getUsage()),e.getType()===i.ARRAY_BUFFER&&this._setAttributePointer(t,e),i.bindBuffer(e.getType(),void 0)}bind(){for(let t=0;t<this._vboList.length;t++)i.bindBuffer(this._vboList[t].getType(),this._vboList[t].getId()),this._vboList[t].getType()!==i.ELEMENT_ARRAY_BUFFER&&(this._setAttributePointer(t,this._vboList[t]),i.enableVertexAttribArray(t))}unbind(){for(let t=this._vboList.length-1;t>=0;t--)i.bindBuffer(this._vboList[t].getType(),this._vboList[t].getId()),this._vboList[t].getType()!==i.ELEMENT_ARRAY_BUFFER&&i.disableVertexAttribArray(t)}destroy(){for(let t=this._vboList.length-1;t>=0;t--)i.deleteBuffer(this._vboList[t].getId())}_setAttributePointer(t,e){const s=s=>{i.vertexAttribPointer(t,e.getOffset(),s,!1,0,0)};e.getBuffer()instanceof Int8Array&&s(i.BYTE),e.getBuffer()instanceof Int16Array&&s(i.SHORT),e.getBuffer()instanceof Int32Array&&s(i.INT),e.getBuffer()instanceof Uint8Array&&s(i.UNSIGNED_BYTE),e.getBuffer()instanceof Uint16Array&&s(i.UNSIGNED_SHORT),e.getBuffer()instanceof Uint32Array&&s(i.UNSIGNED_INT),e.getBuffer()instanceof Float32Array&&s(i.FLOAT)}getVbo(t){return this._vboList[t]}getIbo(){return this._ibo}getLength(){return this._ibo?this._ibo.getLength()/this._vertexCoordsOffset:0}};var ct=s(847),dt=s.n(ct);const ut=class{load(t){let e=null;return rt.load(t,(function(t){const s=new(dt())(t).parse(),i=[],r=[],n=[],a=[];s.models[0].faces.forEach((t=>{const e=t.vertices[0].vertexIndex-1,i=t.vertices[1].vertexIndex-1,o=t.vertices[2].vertexIndex-1;if(r.push(s.models[0].vertices[e].x),r.push(s.models[0].vertices[e].y),r.push(s.models[0].vertices[e].z),r.push(s.models[0].vertices[i].x),r.push(s.models[0].vertices[i].y),r.push(s.models[0].vertices[i].z),r.push(s.models[0].vertices[o].x),r.push(s.models[0].vertices[o].y),r.push(s.models[0].vertices[o].z),s.models[0].vertexNormals&&s.models[0].vertexNormals.length>0){const e=t.vertices[0].vertexNormalIndex-1,i=t.vertices[1].vertexNormalIndex-1,r=t.vertices[2].vertexNormalIndex-1;n.push(s.models[0].vertexNormals[e].x),n.push(s.models[0].vertexNormals[e].y),n.push(s.models[0].vertexNormals[e].z),n.push(s.models[0].vertexNormals[i].x),n.push(s.models[0].vertexNormals[i].y),n.push(s.models[0].vertexNormals[i].z),n.push(s.models[0].vertexNormals[r].x),n.push(s.models[0].vertexNormals[r].y),n.push(s.models[0].vertexNormals[r].z)}if(s.models[0].textureCoords&&s.models[0].textureCoords.length>0){const e=t.vertices[0].textureCoordsIndex-1,i=t.vertices[1].textureCoordsIndex-1,r=t.vertices[2].textureCoordsIndex-1;a.push(s.models[0].textureCoords[e].u),a.push(s.models[0].textureCoords[e].v),a.push(s.models[0].textureCoords[i].u),a.push(s.models[0].textureCoords[i].v),a.push(s.models[0].textureCoords[r].u),a.push(s.models[0].textureCoords[r].v)}})),i.push(new ot(new Float32Array(r),3,!0)),n.length>0&&i.push(new ot(new Float32Array(n),3,!0)),a.length>0&&i.push(new ot(new Float32Array(a),2,!0)),e=new lt(i)}),(function(e){throw new Error(`Error trying to load object data: ${t}.\n ${e}`)})),e}loadHitboxes(t){let e;return rt.load(t,(function(t){e=JSON.parse(t)}),(function(e){throw new Error(`Error trying to load hitbox data: ${t}.\n ${e}`)})),e}};function gt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const _t=class{constructor(t=0,e=0,s=null){gt(this,"_program",void 0),gt(this,"_width",void 0),gt(this,"_height",void 0),gt(this,"_created",void 0),gt(this,"_data",void 0),this._width=t,this._height=e,this._data=s,this._created=!1;const i=setInterval((()=>{this._created&&this._data&&(this._bindData(),clearInterval(i))}),100)}create(){if(!this._created){if(this._program=i.createTexture(),this._data&&this._bindData(),(this._width<1||this._height<1)&&this._data)throw new Error("Invalid image size!");this._created=!0}}bind(){i.bindTexture(i.TEXTURE_2D,this._program),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)}unbind(){i.bindTexture(i.TEXTURE_2D,null)}destroy(){i.deleteTexture(this._program),this._created=!1}getWidth(){return this._width}getHeight(){return this._height}setWidth(t){this._width=t}setHeight(t){this._height=t}getData(){return this._data}setData(t){t&&(delete this._data,this._data=t),this._created&&this._bindData()}_bindData(){this.bind(),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this._width,this._height,0,i.RGBA,i.UNSIGNED_BYTE,this._data)}getProgram(){return this._program}},mt=class{load(t,e){const s=new _t,i=new Image;return i.onload=()=>{s.setWidth(i.naturalWidth),s.setHeight(i.naturalHeight);const t=document.createElement("canvas");t.width=i.naturalWidth,t.height=i.naturalHeight;const r=t.getContext("2d");r.drawImage(i,0,0,i.naturalWidth,i.naturalHeight);const n=new Uint8Array(r.getImageData(0,0,i.naturalWidth,i.naturalHeight).data);s.setData(n),e&&e(s)},i.onerror=e=>{throw new Error(`Error trying to load image: ${t}.\n ${e}`)},i.src=t,s}};function ft(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function pt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class bt{constructor(){pt(this,"_shaders",void 0),pt(this,"_vaos",void 0),pt(this,"_textures",void 0),pt(this,"_materials",void 0),pt(this,"_sounds",void 0),this._shaders=new Map,this._vaos=new Map,this._textures=new Map,this._materials=new Map,this._sounds=new Map}static getInstance(){return bt._instance||(bt._instance=new bt),bt._instance}static loadVAO(t){return bt.getInstance().loadVAO(t)}loadVAO(t){return t.forEach((t=>{if(this._vaos.has(t.name))throw new Error(`Shader '${t.name}' already exists!`);"string"!=typeof t.objectData?"function"!=typeof t.objectData?this._vaos.set(t.name,new lt(t.objectData)):this._vaos.set(t.name,t.objectData()):this._vaos.set(t.name,(new ut).load(t.objectData))})),this}static getVAO(t){return bt.getInstance().getVAO(t)}getVAO(t){return this._vaos.get(t)}static forEachVAO(t){return bt.getInstance().forEachVAO(t)}forEachVAO(t){return this._vaos.forEach(t),this}static loadShader(t){return bt.getInstance().loadShader(t)}loadShader(t){return t.forEach((t=>{if(this._shaders.has(t.name))throw new Error(`Shader '${t.name}' already exists!`);this._shaders.set(t.name,new class{constructor(t){nt(this,"_name",void 0),nt(this,"_vertexShaderPathname",void 0),nt(this,"_fragmentShaderPathname",void 0),nt(this,"_program",void 0),nt(this,"_textureCounter",void 0),nt(this,"_created",void 0),this._name=t.name,this._vertexShaderPathname=t.vertexShaderPathname,this._fragmentShaderPathname=t.fragmentShaderPathname,this._textureCounter=0,this._created=!1}create(){if(!this._created){this._program=i.createProgram();const t=this.load(this._vertexShaderPathname,i.VERTEX_SHADER),e=this.load(this._fragmentShaderPathname,i.FRAGMENT_SHADER);i.attachShader(this._program,t),i.attachShader(this._program,e),i.linkProgram(this._program);const s=i.getProgramInfoLog(this._program).trim();if(""!==s)throw new Error(`Error trying to link shader: ${this._name}.\n ${s}`);this._created=!0}}load(t,e){const s=i.createShader(e);rt.load(t,(function(t){i.shaderSource(s,t)}),(function(e){throw new Error(`Error trying to load shader: ${t}.\n ${e}`)})),i.compileShader(s);const r=i.getShaderInfoLog(s).trim();if(""!==r)throw new Error(`Error trying to compile shader: ${t}.\n ${r}`);return s}bind(){i.useProgram(this._program),this._textureCounter=0}unbind(){i.useProgram(null)}destroy(){i.deleteShader(this._program),this._created=!1}getUniformLocation(t){return i.getUniformLocation(this._program,t)}_checkIfUniformExists(t,e){const s=i.getUniformLocation(this._program,t);if(-1===s)throw new Error(`Uniform '${t}' does not exist in shader: ${this._name}`);e(s)}setInt(t,e){this._checkIfUniformExists(t,(t=>i.uniform1i(t,e)))}setIntArray(t,e){this._checkIfUniformExists(t,(t=>i.uniform1iv(t,new Int32Array(e))))}setFloat(t,e){this._checkIfUniformExists(t,(t=>i.uniform1f(t,e)))}setFloatArray(t,e){this._checkIfUniformExists(t,(t=>i.uniform1fv(t,new Float32Array(e))))}setVector3(t,e){this._checkIfUniformExists(t,(t=>i.uniform3fv(t,e)))}setVector4(t,e){this._checkIfUniformExists(t,(t=>i.uniform4fv(t,e)))}setMatrix4x4(t,e){this._checkIfUniformExists(t,(t=>i.uniformMatrix4fv(t,!1,e)))}setTexture(t){this._checkIfUniformExists(t,(t=>{i.activeTexture(i.TEXTURE0+this._textureCounter),i.uniform1i(t,this._textureCounter),this._textureCounter++}))}getName(){return this._name}}(t))})),this}static getShader(t){return bt.getInstance().getShader(t)}getShader(t){return this._shaders.get(t)}static forEachShader(t){return bt.getInstance().forEachShader(t)}forEachShader(t){return this._shaders.forEach(t),this}static loadTextures(t){return bt.getInstance().loadTextures(t)}loadTextures(t){return t.forEach((t=>{if(this._textures.has(t.name))throw new Error(`Texture '${t.name}' already exists!`);null!=t.texture?"function"!=typeof t.texture?this._textures.set(t.name,t.texture):this._textures.set(t.name,t.texture()):this._textures.set(t.name,(new mt).load(t.pathname))})),this}static getTexture(t){return bt.getInstance().getTexture(t)}getTexture(t){return this._textures.get(t)}static forEachTexture(t){return bt.getInstance().forEachTexture(t)}forEachTexture(t){return this._textures.forEach(t),this}static addMaterials(t){return bt.getInstance().addMaterials(t)}addMaterials(t){return t.forEach((t=>{if(this._materials.has(t.getName()))throw new Error(`Material '${t.getName()}' already exists!`);this._materials.set(t.getName(),t)})),this}static getMaterial(t){return bt.getInstance().getMaterial(t)}getMaterial(t){return this._materials.get(t)}static forEachMaterial(t){return bt.getInstance().forEachMaterial(t)}forEachMaterial(t){return this._materials.forEach(t),this}static addSounds(t){return bt.getInstance().addSounds(t)}addSounds(t){return t.forEach((t=>{if(this._sounds.has(t.name))throw new Error(`Material '${t.name}' already exists!`);this._sounds.set(t.name,new class{constructor(t,e,s){ft(this,"name",void 0),ft(this,"_audio",void 0),ft(this,"_origin",void 0),ft(this,"_listener",void 0),this.name=t,this._audio=new Audio(e),this._audio.loop=s?.loop??!1,this._audio.autoplay=s?.autoplay??!1,this._audio.volume=(s?.volume??100)/100,this._audio.pause()}setOrigin(t){this._origin=t}getOrigin(){return this._origin}setListener(t){this._listener=t}getListener(){return this._listener}play(t=!1,e=!1){(e||this._audio.paused)&&(e&&this.pause(),this._audio.loop=t,this._audio.play().then((()=>{const t=setInterval((()=>{if(this._audio.paused&&(this._audio.currentTime=0,clearInterval(t)),this._origin&&this._listener){const t=this._origin.getTranslation().subtract(this._listener.getTranslation()),e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2));this._audio.volume=1/(1+.022*e+e*e*.0019)}}),1e3)})))}pause(){this._audio.pause(),this._audio.currentTime=0}getName(){return this.name}}(t.name,t.pathname,t.options))})),this}static getSound(t){return bt.getInstance().getSound(t)}getSound(t){return this._sounds.get(t)}static forEachSound(t){return bt.getInstance().forEachSound(t)}forEachSound(t){return this._sounds.forEach(t),this}}pt(bt,"_instance",void 0);const vt=bt;function Tt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Et=class{constructor(t,e){Tt(this,"_name",void 0),Tt(this,"_shader",void 0),this._name=t,this._shader=e}getShader(){return this._shader}setShader(t){this._shader=t}getName(){return this._name}setName(t){this._name=t}},yt=class extends Et{constructor(t,e,s){var i,r;super(t,e),r=void 0,(i="_texture")in this?Object.defineProperty(this,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[i]=r,this._texture=s}create(){this.getShader().create(),this._texture?.create()}bind(){this.getShader().bind(),this._texture&&(i.activeTexture(i.TEXTURE0),this._texture.bind(),this.getShader().setInt("u_texture",0))}unbind(){this._texture?.unbind(),this.getShader().unbind()}destroy(){this._texture?.destroy(),this.getShader().destroy()}getTexture(){return this._texture}setTexture(t){this._texture=t}};function wt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class xt{constructor(t,e){wt(this,"_transform",void 0),this._transform=new H(t,e),xt._mainCamera=this}static get Main(){return this._mainCamera}static setMainCamera(t){this._mainCamera=t}getTransform(){return this._transform}getView(){const t=(new L).translate(this._transform.getTranslation().add(this._transform.getLocalTransform().translation).negate()),e=this._transform.getRotation(),s=(new L).rotateX(D(e.pitch)),i=(new L).rotateY(D(e.yaw)),r=(new L).rotateZ(D(e.roll)).multiplyRight(i.multiplyRight(s));return t.multiplyRight(r).invert()}}wt(xt,"_mainCamera",void 0);const St=xt;function Nt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class At extends St{constructor(t,e=new g.Z,s=new f.Z){super(e,s),Nt(this,"_name",void 0),Nt(this,"_speed",void 0),Nt(this,"_sensitivity",void 0),Nt(this,"_pitch",void 0),Nt(this,"_angleAround",void 0),Nt(this,"_lockedIn",void 0),Nt(this,"_mode",void 0),Nt(this,"_lookAt",void 0),this._name=t,this._speed=40,this._sensitivity=7.5,this._pitch=0,this._lockedIn=null,this._mode=At.MODE.FIRST_PERSON,this._lookAt=!1,this._angleAround=0}update(t){}_firstPersonMovement(t){const e=Math.sin(D(this.getTransform().getRotation().y))*this._speed*t,s=Math.cos(D(this.getTransform().getRotation().y))*this._speed*t;if(h.isKeyPressed(a.KEY_W)){const t=this.getTransform().getTranslation();t.x+=e,t.z+=s,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_S)){const t=this.getTransform().getTranslation();t.x+=-e,t.z+=-s,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_A)){const t=this.getTransform().getTranslation();t.x+=s,t.z+=-e,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_D)){const t=this.getTransform().getTranslation();t.x+=-s,t.z+=e,this.getTransform().setTranslation(t)}if(h.isKeyPressed(a.KEY_SPACE)){const e=this.getTransform().getTranslation();e.y+=-this._speed*t,this.getTransform().setTranslation(e)}if(h.isKeyPressed(a.KEY_C)){const e=this.getTransform().getTranslation();e.y+=this._speed*t,this.getTransform().setTranslation(e)}if(h.isMouseLeft()){const e=h.getMouseDX(),s=h.getMouseDY(),i=this.getTransform().getRotation();this.getTransform().setPitch(i.pitch+s*this._sensitivity*t),this.getTransform().setYaw(i.yaw+e*this._sensitivity*t)}}getLockedIn(){return this._lockedIn}setLookAt(t){this._lookAt=t}shouldLookAt(){return this._lookAt}getName(){return this._name}}Nt(At,"MODE",{FIRST_PERSON:0,THIRD_PERSON:1});const Mt=At,Ot={};class Ct extends P.Z{static get ZERO(){return Ot.ZERO=Ot.ZERO||Object.freeze(new Ct(0,0,0,0))}constructor(t=0,e=0,s=0,i=0){super(-0,-0,-0,-0),(0,v.kJ)(t)&&1===arguments.length?this.copy(t):(v.vc.debug&&((0,p.u5)(t),(0,p.u5)(e),(0,p.u5)(s),(0,p.u5)(i)),this[0]=t,this[1]=e,this[2]=s,this[3]=i)}set(t,e,s,i){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return v.vc.debug&&((0,p.u5)(t.x),(0,p.u5)(t.y),(0,p.u5)(t.z),(0,p.u5)(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=(0,p.u5)(t)}get w(){return this[3]}set w(t){this[3]=(0,p.u5)(t)}transform(t){return M.fF(this,this,t),this.check()}transformByMatrix3(t){return(0,y._x)(this,this,t),this.check()}transformByMatrix2(t){return(0,y.G7)(this,this,t),this.check()}transformByQuaternion(t){return M.VC(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}function It(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Rt=class{constructor(t,e=u.CANVAS.width,s=u.CANVAS.height){It(this,"_fbo",void 0),It(this,"_rbo",void 0),It(this,"_attachment",void 0),It(this,"_texture",void 0),this._attachment=t,this._texture=new _t(e,s)}bindTexture(){i.bindTexture(i.TEXTURE_2D,this._texture.getProgram()),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this._texture.getWidth(),this._texture.getHeight(),0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)}create(){i.viewport(0,0,this._texture.getWidth(),this._texture.getHeight()),this._fbo=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._fbo),this._texture.create(),this.bindTexture(),i.framebufferTexture2D(i.FRAMEBUFFER,this._attachment,i.TEXTURE_2D,this._texture.getProgram(),0),this._rbo=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._rbo),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,this._texture.getWidth(),this._texture.getHeight()),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this._rbo),i.checkFramebufferStatus(i.FRAMEBUFFER)!=i.FRAMEBUFFER_COMPLETE&&console.log("Error at Framebuffer setting."),i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,u.CANVAS.width,u.CANVAS.height)}bind(){i.bindFramebuffer(i.FRAMEBUFFER,this._fbo),i.viewport(0,0,this._texture.getWidth(),this._texture.getHeight()),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)}unbind(){this._texture.unbind(),i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,u.CANVAS.width,u.CANVAS.height),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)}destroy(){i.deleteFramebuffer(this._fbo),i.deleteRenderbuffer(this._rbo)}storeBuffer(){const t=new Uint8Array(this._texture.getWidth()*this._texture.getHeight()*4);i.readPixels(0,0,this._texture.getWidth(),this._texture.getHeight(),i.RGBA,i.UNSIGNED_BYTE,t),this._texture.setData(t)}getTexture(){return this._texture}getAttachemnt(){return this._attachment}};function Lt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Pt extends m{constructor(t,e,s){super("frameRenderer",t),Lt(this,"_mode",void 0),Lt(this,"_frameBuffer",void 0),Lt(this,"_shader",void 0),Lt(this,"_vao",void 0),Lt(this,"_buffers",[]),this._mode=e,this._frameBuffer=new Rt(i.COLOR_ATTACHMENT0,u.CANVAS.width*s,u.CANVAS.height*s),this._frameBuffer.create(),this._shader=vt.getShader("effect"),this._shader.create(),this._vao=vt.getVAO("effect"),this._buffers.push(new Rt(i.COLOR_ATTACHMENT0,u.CANVAS.width*s,u.CANVAS.height*s)),this._buffers.push(new Rt(i.COLOR_ATTACHMENT0,u.CANVAS.width*s,u.CANVAS.height*s)),this._buffers[0].create(),this._buffers[1].create()}get _texture(){return this._frameBuffer.getTexture()}get attachemnt(){return this._frameBuffer.getAttachemnt()}static get mode(){return Pt._modeStatic}bind(){this._frameBuffer.bind(),Pt._modeStatic=this._mode}prepare(){Pt._texture=this._frameBuffer.getTexture()}renderBloom(t){this._shader.bind(),i.activeTexture(i.TEXTURE0),this._frameBuffer.getTexture().bind(),this._shader.setInt("u_texture",0),this._vao.bind(),this._shader.setInt("mode","mascara"==this._mode?1:0),this._shader.setFloat("weight[0]",.227027),this._shader.setFloat("weight[1]",.1945946),this._shader.setFloat("weight[2]",.1216216),this._shader.setFloat("weight[3]",.054054),this._shader.setFloat("weight[4]",.016216),this._shader.setFloat("sizeTexture[0]",this._texture.getWidth()),this._shader.setFloat("sizeTexture[1]",this._texture.getHeight());let e=!0,s=!0;for(let t=0;t<10;t++)this._buffers[Number(e)].bind(),this._shader.setInt("horizontal",Number(e)),s||this._buffers[Number(!e)].getTexture().bind(),this.draw(),this._buffers[Number(e)].unbind(),e=!e,s&&(s=!1);Pt._bloom=this._buffers[Number(!e)].getTexture(),this._vao.unbind(),this._frameBuffer.getTexture().unbind(),this._shader.unbind()}render(t){this._shader.bind(),i.activeTexture(i.TEXTURE0),this._frameBuffer.getTexture().bind(),this._shader.setInt("u_texture",0),this._vao.bind(),this._shader.setInt("mode","mascara"==this._mode?1:0),this._shader.setInt("mode",2),i.activeTexture(i.TEXTURE0),Pt._texture.bind(),this._shader.setInt("u_texture",0),i.activeTexture(i.TEXTURE1),Pt._bloom.bind(),this._shader.setInt("u_mascara",1),this.draw(),this._vao.unbind(),this._frameBuffer.getTexture().unbind(),this._shader.unbind()}draw(){i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),r.draw(this._vao.getLength())}unbind(){this._frameBuffer.unbind()}getFrameBuffer(){return this._frameBuffer}}Lt(Pt,"_modeStatic",void 0),Lt(Pt,"_texture",void 0),Lt(Pt,"_bloom",void 0);const Ft=Pt,Dt=class extends m{constructor(t){var e,s;super("guirenderer",t),s=void 0,(e="_projection")in this?Object.defineProperty(this,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[e]=s,this._projection=(new L).ortho({top:0,left:0,right:u.CANVAS.width,bottom:u.CANVAS.height,near:-1,far:100})}render(){i.disable(i.CULL_FACE),vt.forEachMaterial((t=>{t.bind();const e=t.getShader();e.setFloat("u_onlyLights","mascara"==Ft.mode?1:0),e.setMatrix4x4("u_projection",this._projection),this.getEntitiesByMaterial(t).forEach(((s,i)=>{if("color"in s){let t=s.color;t=new Ct(t.x,t.y,t.z,"alpha"in s?s.alpha:.1),e.setVector4("u_color",t)}t.getShader().setMatrix4x4("u_transform",s.getTransform().worldMatrix()),s.render(),s.getVAO().bind(),r.draw(s.getVAO().getLength()),s.getVAO().unbind()})),t.unbind()})),i.enable(i.CULL_FACE)}},kt=class extends X{constructor(t,e,s,i){var r,n;super(t,e,s,i),n=void 0,(r="_lampList")in this?Object.defineProperty(this,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[r]=n,this._lampList=[]}update(t,e,s,i){}setLampList(t){this._lampList=t}getLampList(){return this._lampList}};function Vt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const jt=class extends kt{constructor(t,e,s){super(t,vt.getVAO("lamp"),vt.getMaterial("lamp"),e),Vt(this,"color",void 0),Vt(this,"distance",100),Vt(this,"shininess",32),this.color=s}update(t,e,s,i){}},Kt=class extends X{constructor(t,e,s,i,r){var n,a;super(t,s,i,r),a=void 0,(n="_hitbox")in this?Object.defineProperty(this,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):this[n]=a,this._hitbox=e}setHitbox(t){this._hitbox=t}getHitbox(){return this._hitbox}},Bt=class extends Kt{constructor(t,e,s,i,r,n){var a,o;super(t,e,i,r,n),o=void 0,(a="_friction")in this?Object.defineProperty(this,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[a]=o,this._friction=s}setFriction(t){this._friction=t}getFriction(){return this._friction}},Yt=class extends Bt{constructor(t,e,s,i,r,n){var a,o;super(t,e,s,i,r,n),o=void 0,(a="_lampList")in this?Object.defineProperty(this,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[a]=o,this._lampList=[]}update(t,e,s,i){}setLampList(t){this._lampList=t}getLampList(){return this._lampList}};function Zt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const zt=class extends X{constructor(t,e,s,i){super(t,e,s,i),Zt(this,"size",void 0),Zt(this,"color",new g.Z(.3,.3,.3)),Zt(this,"alpha",.1),this.size=new F(1,1)}setSize(t,e){this.getTransform().setScale(new g.Z(t,e,1))}getSize(){const t=this.getTransform().getScale();return{width:t[0],height:t[1]}}updatePosition(t,e="Razor"){const{width:s,height:i}=this.getSize(),r={width:"Razor"==e?u.CANVAS.width:e.getScale()[0],height:"Razor"==e?u.CANVAS.height:e.getScale()[1]};let n=0,a=0;switch(t.vertical){case"center":case"bottom":n=r.height,"bottom"==t.vertical&&(n=-i),"center"==t.vertical&&(n=n/2-i/2);break;case"top":break;default:const[,e,s]=t.vertical.split(/([0-9]+)(px|%)/);n="px"==s?Number(e):r.height*Number(e)/100}switch(t.horizontal){case"center":case"right":a=r.width,"right"==t.horizontal&&(a-=s),"center"==t.horizontal&&(a=a/2-s/2);break;case"left":break;default:const[,e,i]=t.vertical.split(/([0-9]+)(px|%)/);a="px"==i?Number(e):r.width*Number(e)/100}this.getTransform().setTranslation(new g.Z(a,n,0).negate())}setAlpha(t){return this.alpha=t}update(t,e,s,i){}};class Ut{static render(t){const e=this.fontInfo;for(var s=t.length,i=6*s,r=new Float32Array(2*i),n=new Float32Array(2*i),a=0,o=0,h=e.textureWidth,l=e.textureHeight,c=0;c<s;++c){var d=t[c],u=e.glyphInfos[d];if(u){var g=o+u.width,_=u.x/h,m=(u.y+e.letterHeight-1)/l,f=(u.x+u.width-1)/h,p=u.y/l;r[a+0]=o,r[a+1]=0,n[a+0]=_,n[a+1]=p,r[a+2]=g,r[a+3]=0,n[a+2]=f,n[a+3]=p,r[a+4]=o,r[a+5]=e.letterHeight,n[a+4]=_,n[a+5]=m,r[a+6]=o,r[a+7]=e.letterHeight,n[a+6]=_,n[a+7]=m,r[a+8]=g,r[a+9]=0,n[a+8]=f,n[a+9]=p,r[a+10]=g,r[a+11]=e.letterHeight,n[a+10]=f,n[a+11]=m,o+=u.width+e.spacing,a+=12}else o+=e.spaceWidth}return{arrays:{position:new Float32Array(r.buffer,0,a),texcoord:new Float32Array(n.buffer,0,a)},numVertices:a/2}}}var Ht,Gt,Wt;Wt={letterHeight:8,spaceWidth:8,spacing:-1,textureWidth:64,textureHeight:40,glyphInfos:{a:{x:0,y:0,width:8},b:{x:8,y:0,width:8},c:{x:16,y:0,width:8},d:{x:24,y:0,width:8},e:{x:32,y:0,width:8},f:{x:40,y:0,width:8},g:{x:48,y:0,width:8},h:{x:56,y:0,width:8},i:{x:0,y:8,width:8},j:{x:8,y:8,width:8},k:{x:16,y:8,width:8},l:{x:24,y:8,width:8},m:{x:32,y:8,width:8},n:{x:40,y:8,width:8},o:{x:48,y:8,width:8},p:{x:56,y:8,width:8},q:{x:0,y:16,width:8},r:{x:8,y:16,width:8},s:{x:16,y:16,width:8},t:{x:24,y:16,width:8},u:{x:32,y:16,width:8},v:{x:40,y:16,width:8},w:{x:48,y:16,width:8},x:{x:56,y:16,width:8},y:{x:0,y:24,width:8},z:{x:8,y:24,width:8},0:{x:16,y:24,width:8},1:{x:24,y:24,width:8},2:{x:32,y:24,width:8},3:{x:40,y:24,width:8},4:{x:48,y:24,width:8},5:{x:56,y:24,width:8},6:{x:0,y:32,width:8},7:{x:8,y:32,width:8},8:{x:16,y:32,width:8},9:{x:24,y:32,width:8},"-":{x:32,y:32,width:8},"*":{x:40,y:32,width:8},"!":{x:48,y:32,width:8},"?":{x:56,y:32,width:8}}},(Gt="fontInfo")in(Ht=Ut)?Object.defineProperty(Ht,Gt,{value:Wt,enumerable:!0,configurable:!0,writable:!0}):Ht[Gt]=Wt;const Xt=Ut;function qt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const $t=class extends X{constructor(t,e,s){super(t,null,e,s),qt(this,"_oldText",""),qt(this,"_currentText","");const i=new lt([],2);i.addEmpty(2),i.create(),this.setVAO(i)}setText(t){this._currentText=t}render(){if(this._currentText==this._oldText)return;const t=Xt.render(this._currentText);this.getVAO().getVbo(0).setBuffer(t.arrays.position),this.getVAO().getVbo(1).setBuffer(t.arrays.texcoord),this.getVAO().create(),this._oldText=this._currentText}getSize(){const t=this.getTransform().getScale();return{width:t[0],height:t[1]}}updatePosition(t,e="Razor"){const{width:s,height:i}=this.getSize(),r={width:"Razor"==e?u.CANVAS.width:e.getTranslation().negate().x,height:"Razor"==e?u.CANVAS.height:e.getTranslation().negate().y,z:"Razor"==e?1:e.getTranslation().negate().z-2};let n=0,a=0;switch("Razor"!=e&&(n=r.height,a=r.width,console.log(r)),t.vertical){case"center":case"bottom":n=r.height,"bottom"==t.vertical&&(n=-i),"center"==t.vertical&&(n=n/2-i/2);break;case"top":break;default:const[,e,s]=t.vertical.split(/([0-9]+)(px|%)/);n="px"==s?Number(e):r.height*Number(e)/100}switch(t.horizontal){case"center":case"right":a=r.width,"right"==t.horizontal&&(a-=s),"center"==t.horizontal&&(a=a/2-s/2);break;case"left":break;default:const[,e,i]=t.horizontal.split(/([0-9]+)(px|%)/);a="px"==i?Number(e):r.width*Number(e)/100}this.getTransform().setTranslation(new g.Z(a,n,r.z).negate())}update(t,e,s,i){}},Qt=class extends X{constructor(t,e){super(t,null,null,e)}addRectangle(t){const e=new zt(t,vt.getVAO("rectangle"),vt.getMaterial("rectangle"),this.getRenderer());e.getTransform().parent=this.getTransform();const s=this.getScene();return e.setScene(s),s.add(e),e}addText(t){const e=new $t(t,vt.getMaterial("text"),this.getRenderer());return e.getTransform().parent=this.getTransform(),this.getScene().add(e),e}};function Jt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let te;!function(t){t[t.DONE=0]="DONE",t[t.ANIMATING=1]="ANIMATING"}(te||(te={}));class ee extends Qt{constructor(t,e){super(t,e),Jt(this,"_textEntity",void 0),Jt(this,"_rectangle",void 0),Jt(this,"paddingTop",5),Jt(this,"paddingLeft",5),Jt(this,"_text",void 0),Jt(this,"_textPosition",void 0),Jt(this,"_state",void 0),Jt(this,"_animationTime",void 0),Jt(this,"_animationCounter",void 0),Jt(this,"_animationWordCounter",void 0),Jt(this,"_animationCallback",void 0),ee._dialogs.set(t,this),this._resetAnimation()}static getDialog(t){return ee._dialogs.get(t)}init(t=new g.Z(.9,.9,.9)){this._rectangle=this.addRectangle(this.getName()+"_rectangle_left"),this._rectangle.color=t,this._rectangle.getTransform().parent=this.getTransform(),this._textEntity=this.addText(this.getName()+"_text_rectangle_left"),this._textEntity.setText(""),this._textEntity.getTransform().setTranslation(new g.Z(this.paddingLeft,this.paddingTop,1).negate()),this._textEntity.getTransform().setScale(new g.Z(2,2,2))}setImage(t){t.getTransform().setTranslation(new g.Z(0,0,1).negate()),t.getTransform().setScale(new g.Z(.09,.09,1)),this.getScene().add(t),t.getTransform().parent=this.getTransform()}remove(){this._textEntity.setText(""),this._rectangle.setSize(0,0),this._resetAnimation()}_resetAnimation(){this._state=te.DONE,this._text="",this._animationTime=0,this._animationCounter=0,this._animationWordCounter=0,this._animationCallback=null}updateText(t,e){this._textEntity.setText(t);const s=t.toLowerCase().replace(/ /g,"").replace(/[^\w-]+/g,"").length,i=Math.abs(t.length-s)-2,r=16*s+2*this.paddingLeft+8*i,n=16+2*this.paddingTop;this._rectangle.setSize(r,n),this.updatePosition(e)}updatePosition(t){const{width:e,height:s}=this._rectangle.getSize();let i=0,r=0;switch(t.vertical){case"center":case"bottom":i=u.CANVAS.height,"bottom"==t.vertical&&(i=-s),"center"==t.vertical&&(i=i/2-s/2);break;case"top":break;default:const[,e,r]=t.vertical.split(/([0-9]+)(px|%)/);i="px"==r?Number(e):u.CANVAS.height*Number(e)/100}switch(t.horizontal){case"center":case"right":r=u.CANVAS.width,"right"==t.horizontal&&(r-=e),"center"==t.horizontal&&(r=r/2-e/2);break;case"left":break;default:const[,s,i]=t.vertical.split(/([0-9]+)(px|%)/);r="px"==i?Number(s):u.CANVAS.width*Number(s)/100}this.getTransform().setTranslation(new g.Z(r,i,0).negate())}animateText(t,e=1,s,i){this._text=t,this._animationTime=1/e,this._textPosition=s,this._animationCallback=i,this._state=te.ANIMATING}update(t,e,s,i){this._state===te.ANIMATING&&(this._animationCounter>=this._animationTime&&(this._animationWordCounter>=this._text.length&&(this._animationCallback&&this._animationCallback(this),this._state=te.DONE),this._animationWordCounter+=Math.floor(this._animationCounter/this._animationTime),this.updateText(this._text.slice(0,this._animationWordCounter),this._textPosition),this._animationCounter-=this._animationTime),this._animationCounter+=e)}}Jt(ee,"_dialogs",new Map);const se=ee;function ie(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const re=class extends Kt{constructor(t,e,s,i,r,n){super(t,e,i,r,n),ie(this,"_mass",void 0),ie(this,"_force",void 0),ie(this,"_speed",void 0),this._mass=s,this._force=new g.Z(0,0,0),this._speed=new g.Z(0,0,0)}updateSpeed(t){this._force.exactEquals([0,0,0])||this.updateSpeedByAcceleration(this._force.divideScalar(this._mass).multiplyByScalar(t))}updateSpeedByAcceleration(t){this._speed.add(t)}setMass(t){this._mass=t}getMass(){return this._mass}setForce(t){this._force=t}getForce(){return this._force}setSpeed(t){this._speed=t}getSpeed(){return this._speed}};function ne(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class ae extends ${constructor(t,e){super(ae.GAMEOVER_SCENE),ne(this,"_fading",void 0),this.getRenderStrategy().add(t),this._fading=e,this.init(t)}init(t){const e=new se("gameoverDisplay",t);this.add(e),e.getTransform().setTranslation(new g.Z(100,100,-1).negate()),e.init(),this.onChange((()=>{this._fading.fadeIn(),vt.forEachSound((t=>t.pause())),vt.getSound("death-track").play(!0),e.animateText("game over",20,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>{this._fading.fadeOut()}),29e3),setTimeout((()=>{t.remove(),window.location.reload()}),3e4)}))}))}render(t){this._fading.getFrameBuffer().bind(),super.render(t),this._fading.getFrameBuffer().unbind(),this._fading.render(t)}}ne(ae,"GAMEOVER_SCENE","gameover");const oe=ae,he=class extends Qt{constructor(t,e,s){super(t,s),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t.size=s}(this,"size",{width:0,height:0}),this.createMaterial(e).then((()=>{this.createVAO()}))}createMaterial(t){return new Promise((e=>{(new mt).load(t,(t=>{this.size={width:t.getWidth(),height:t.getHeight()};const s=new yt(this.getName(),vt.getShader("image"),t);s.create(),this.setMaterial(s),vt.addMaterials([s]),e(null)}))}))}createVAO(){const t=[];var e=0+this.size.width,s=0+this.size.height;t.push(new ot(new Float32Array([0,0,e,0,0,s,0,s,e,0,e,s]),2,!0)),t.push(new ot(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),2,!0));const i=new lt(t,2);i.create(),this.setVAO(i)}update(t,e,s,i){}},le=class extends Qt{constructor(t,e){super(t,e),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_text",void 0)}setText(t,e=new g.Z(.9,.9,.9)){const s=this.addRectangle(this.getName()+"_rectangle_left");s.color=e,s.setSize(120,50),s.getTransform().parent=this.getTransform();const i=this.addText(this.getName()+"_text_rectangle_left");this._text=i,i.setText(t),i.getTransform().setTranslation(new g.Z(50,15,1).negate()),i.getTransform().setScale(new g.Z(2,2,2))}setImage(t){t.getTransform().setTranslation(new g.Z(0,0,1).negate()),t.getTransform().setScale(new g.Z(.09,.09,1)),t.getTransform().parent=this.getTransform(),this.getScene().add(t)}updateText(t){this._text.setText(String(t))}update(t,e,s,i){}exists(){return!!this._text}};function ce(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class de{constructor(t){ce(this,"_scene",void 0),ce(this,"_life",void 0),ce(this,"_ammo",void 0),ce(this,"_lifeValue",void 0),ce(this,"_ammoValue",void 0),this._scene=t,this._init(t.getRenderStrategy().get("guirenderer"))}_init(t){this._ammo=new le("guiAmmunition",t);const e=100-u.CANVAS.height;this._scene.add(this._ammo),this._ammo.getTransform().setTranslation(new g.Z(0,e,0)),this.setAmmo(100),this._ammo.setImage(new he("ammunition","/resources/images/ammunition.png",t)),this._life=new le("guiLife",t),this._scene.add(this._life),this._life.getTransform().setTranslation(new g.Z(0,e-50,0)),this.setLife(100),this._life.setImage(new he("life","/resources/images/life.png",t));const s=new se("display",t);this._scene.add(s),s.getTransform().setTranslation(new g.Z(100,100,-1).negate()),s.init()}update(t,e,s){0!==this._lifeValue||this._scene.isGameOver()||this._scene.gameOver(oe.GAMEOVER_SCENE)}decrementLife(t=1){const e=this._lifeValue-t;this.setLife(e>=0?e:0)}setLife(t){this._lifeValue=t,this._life.exists()?this._life.updateText(t):this._life.setText(String(t),new g.Z(1,.2,.2))}getLife(){return this._lifeValue}decrementAmmo(t=1){const e=this._ammoValue-t;this.setAmmo(e>=0?e:0)}setAmmo(t){this._ammoValue=t,this._ammo.exists()?this._ammo.updateText(t):this._ammo.setText(String(t),new g.Z(.2,.9,.9))}getAmmo(){return this._ammoValue}getName(){return de.NAME}}ce(de,"NAME","hud");const ue=de,ge=class{constructor(){!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_collisionDisabled",void 0),this._collisionDisabled=!1}isCollisionDisabled(){return this._collisionDisabled}disableCollision(t){this._collisionDisabled=t}},_e=class extends ge{constructor(t){super(),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_radius",void 0),this._radius=t}getRadius(){return this._radius}};function me(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const fe=class extends re{constructor(t,e,s){super(t,new _e(1),1,vt.getVAO("monster"),vt.getMaterial("monster"),e),me(this,"_lampList",void 0),me(this,"_health",void 0),me(this,"_impulse",void 0),me(this,"_path",void 0),me(this,"_pathIndex",void 0),me(this,"_triggered",void 0),me(this,"_player",void 0),me(this,"_hitPlayer",void 0),this._lampList=[],this._path=[],this._health=5,this._impulse=40,this._pathIndex=0,this._triggered=!1,this._player=s,this._hitPlayer=!1}update(t,e,s,i){if(!ye.getInstance().getStop())if(!this._triggered&&this._shouldTrigger())this._triggered=!0,this.getHitbox().disableCollision(!1),s.calculatePathFinding(this);else if(this._path.length>0&&this._triggered&&(this._updatePathIndex(this._path[this._pathIndex]),this._move(this._path[this._pathIndex],e),this.getTransform().getTranslation().distanceTo(ye.getInstance().getTransform().getTranslation())<5&&!this._hitPlayer)){this._hitPlayer=!0;const t=vt.getSound("monster-attack");t.setOrigin(this.getTransform()),t.play(!1,!0),setTimeout((()=>ye.getInstance().takeDamage(i)),200),setTimeout((()=>this._hitPlayer=!1),1e3)}}_updatePathIndex(t){this._pathIndex!==this._path.length-1&&t.getPosition().distanceTo(new F(this.getTransform().getTranslation().x,this.getTransform().getTranslation().z))<2&&this._pathIndex++}_move(t,e){this.getForce().x=0,this.getForce().y=0,this.getForce().z=0;const s=t.getPosition().clone().subtract(new F(this.getTransform().getTranslation().x,this.getTransform().getTranslation().z)).normalize(),i=s.x*this._impulse*e,r=s.y*this._impulse*e;this.getForce().add(new g.Z(i,0,r))}_shouldTrigger(){return this._player.getTransform().getTranslation().distanceTo(this.getTransform().getTranslation())<=30}takeDamage(){return this._health--,setTimeout((()=>{let t="monster-damage";0===this._health&&(t="monster-death");const e=vt.getSound(t);e.setOrigin(this.getTransform()),e.play(!1,!0)}),200),0===this._health}setLampList(t){this._lampList=t}getLampList(){return this._lampList}setHealth(t){this._health=t}getHealth(){return this._health}setPath(t){const e=this._path[this._pathIndex];this._pathIndex=t.includes(e)?t.indexOf(e):0,this._path=t}getPath(){return this._path}isTriggered(){return this._triggered}};function pe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let be;!function(t){t[t.READY=0]="READY",t[t.CHARGED=1]="CHARGED",t[t.RECHARGING=2]="RECHARGING",t[t.EMPTY=3]="EMPTY",t[t.LOADING=4]="LOADING"}(be||(be={}));const ve=class extends X{constructor(t){super("gun",vt.getVAO("gun-receiver"),vt.getMaterial("gun"),t),pe(this,"_state",void 0),pe(this,"_counter",void 0),pe(this,"_step",void 0),pe(this,"_sliderVao",void 0),pe(this,"_sliderTransform",void 0),pe(this,"_lampList",void 0),this._sliderVao=vt.getVAO("gun-slider"),this._sliderTransform=new H,this._sliderTransform.parent=this.getTransform(),this._lampList=[],this.getTransform().setTranslation(new g.Z(-.14,-.23,-.11)),this.getTransform().setRotation(new f.Z(0,0,-20)),this._state=be.CHARGED,this._counter=0,this._step=1}update(t,e,s,i){if(this._state===be.RECHARGING&&1===this._step){this._counter+=.25;const t=this._sliderTransform.getTranslation();this._sliderTransform.setTranslation((new g.Z).lerp([t.x,t.y,0],[t.x,t.y,.15],this._counter)),this._counter>=1&&(this._step=2,this._counter=0)}else if(this._state===be.RECHARGING&&2===this._step){this._counter+=.25;const t=this._sliderTransform.getTranslation();this._sliderTransform.setTranslation((new g.Z).lerp([t.x,t.y,.15],[t.x,t.y,0],this._counter)),this._counter>=1&&(this._step=1,this._counter=0,this._state=be.CHARGED)}}shoot(t,e,s,i){const r=i.get("hud");if(0===r.getAmmo())return void vt.getSound("empty_gun").play();r.decrementAmmo(),setTimeout((()=>vt.getSound("gun").play(!1,!0)),100),this._state=be.RECHARGING;const n=V(t,e),a=new Map,o=e=>new g.Z(t.x,0,t.y).distanceTo(e.getTransform().getTranslation()),h=s.filterVisible((t=>t instanceof fe&&o(t)<50)).sort(((t,e)=>{const s=o(t),i=o(e);return s>i?1:s<i?-1:0})).filter((t=>{const e=t.getTransform().getTranslation(),s=k(n,j(new F(e.x,e.z),t.getHitbox().getRadius()));return!!s&&(a.set(t.getName(),s),!0)}));for(let i=0;i<h.length;i++){const r=a.get(h[i].getName());if(this._isInsideLine({p1:t,p2:e},r))return void(h[i].takeDamage()&&s.remove(h[i]))}}_isInsideLine(t,e){let s=0,i=0;return t.p1.x!==t.p2.x?(t.p1.x<t.p2.x?(s=t.p1.x,i=t.p2.x):(s=t.p2.x,i=t.p1.x),e.p1.x>s&&e.p1.x<i||e.p2.x>s&&e.p2.x<i):(t.p1.y<t.p2.y?(s=t.p1.y,i=t.p2.y):(s=t.p2.y,i=t.p1.y),e.p1.y>s&&e.p1.y<i||e.p2.y>s&&e.p2.y<i)}getSliderVAO(){return this._sliderVao}getSliderTransform(){return this._sliderTransform}setLampList(t){this._lampList=t}getLampList(){return this._lampList}getState(){return this._state}};function Te(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Ee extends re{constructor(t,e,s,i){super(t,e,1,vt.getVAO("hand"),vt.getMaterial("hand"),i),Te(this,"WALKING_DISTANCE",300),Te(this,"WALKING_HEIGHT",8),Te(this,"_camera",void 0),Te(this,"_sensitivity",void 0),Te(this,"_impulse",void 0),Te(this,"_walking",void 0),Te(this,"_handTransform",void 0),Te(this,"_gun",void 0),Te(this,"_lampList",void 0),Te(this,"_stop",void 0),this._camera=s,this._sensitivity=7.5,this._impulse=75,this._walking=0,this._handTransform=new H(new g.Z(-.8,1,1.5),new f.Z(0,180,20),new g.Z(1,1,1)),this._handTransform.parent=this.getTransform(),this._lampList=[],this._gun=null,this._stop=!1,Ee._instance=this}update(t,e,s,i){this._stop||(this._updateCameraPosition(),this._walkingMovement(e),this._move(e,s,i))}_move(t,e,s){this.getForce().x=0,this.getForce().y=0,this.getForce().z=0;const i=Math.sin((0,v.Yr)(this.getTransform().getRotation().y))*this._impulse*t,r=Math.cos((0,v.Yr)(this.getTransform().getRotation().y))*this._impulse*t;let n=!1;if(h.isKeyPressed(a.KEY_W)&&(n=!0,vt.getSound("step").play(!0),this.getForce().add(new g.Z(i,0,r))),h.isKeyPressed(a.KEY_S)&&(n=!0,vt.getSound("step").play(!0),this.getForce().add(new g.Z(-i,0,-r))),h.isKeyPressed(a.KEY_A)&&(n=!0,vt.getSound("step").play(!0),this.getForce().add(new g.Z(r,0,-i))),h.isKeyPressed(a.KEY_D)&&(n=!0,vt.getSound("step").play(!0),this.getForce().add(new g.Z(-r,0,i))),n||vt.getSound("step").pause(),h.isKeyPressed(a.KEY_K)&&this.getTransform().setPitch(0),h.isKeyPressed(a.KEY_E)&&this._gun.getState()===be.CHARGED){const t=this.getTransform().getTranslation(),i=new g.Z(0,0,20).transform(this.getTransform().toInversePositionMatrix());this._gun.shoot(new F(t.x,t.z),new F(i.x,i.z),e,s)}if(h.isKeyPressed(a.KEY_LEFT)){const e=this.getTransform().getRotation();this.getTransform().setYaw(e.yaw+2*this._impulse*t)}if(h.isKeyPressed(a.KEY_RIGHT)){const e=this.getTransform().getRotation();this.getTransform().setYaw(e.yaw+2*-this._impulse*t)}if(h.isKeyPressed(a.KEY_ESCAPE)&&(u.IS_MOUSE_INSIDE=!1),u.IS_MOUSE_INSIDE){const e=h.getMouseDX(),s=this.getTransform().getRotation();this.getTransform().setYaw(s.yaw+e*this._sensitivity*t)}}_walkingMovement(t){this.getForce().exactEquals([0,0,0])?this._walking>0&&this._walking<=90?(this._walking-=t*this.WALKING_DISTANCE,this._walking<0&&(this._walking=0),this.getTransform().getLocalTransform().translation.y=-Math.abs((0,v.Yr)(this._walking))/this.WALKING_HEIGHT):this._walking>90&&this._walking<180&&(this._walking+=t*this.WALKING_DISTANCE,this._walking>=180&&(this._walking=0),this.getTransform().getLocalTransform().translation.y=-Math.abs(Math.sin((0,v.Yr)(this._walking)))/this.WALKING_HEIGHT):(this._walking+=t*this.WALKING_DISTANCE,this._walking>=180&&(this._walking-=180),this.getTransform().getLocalTransform().translation.y=-Math.abs(Math.sin((0,v.Yr)(this._walking)))/this.WALKING_HEIGHT)}_updateCameraPosition(){this._camera.getTransform().getLocalTransform().translation.y=this.getTransform().getLocalTransform().translation.y,this._camera.getTransform().setTranslation(this.getTransform().getTranslation()),this._camera.getTransform().setRotation(this.getTransform().getRotation())}takeDamage(t){t.get(ue.NAME).decrementLife(5),vt.getSound("damage").play(!1,!0)}setLampList(t){this._lampList=t}getLampList(){return this._lampList}getHandTransformMatrix(){return this.getTransform().toMatrix().multiplyRight(this._handTransform.toMatrix())}getHandTransform(){return this._handTransform}setGun(t){this._gun=t}getGun(){return this._gun}static getInstance(){return Ee._instance}setStop(t){this._stop=t}getStop(){return this._stop}}Te(Ee,"_instance",void 0);const ye=Ee;function we(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let xe;!function(t){t[t.OPENED=0]="OPENED",t[t.OPENING=1]="OPENING",t[t.CLOSED=2]="CLOSED",t[t.CLOSING=3]="CLOSING"}(xe||(xe={}));const Se=class extends Yt{constructor(t,e,s,i=new H){super(t,e,1,vt.getVAO("hall-door"),vt.getMaterial("hall-door"),s),we(this,"_state",void 0),we(this,"_counter",void 0),we(this,"_camera",void 0),we(this,"_cameraTransform",void 0),we(this,"_giveAmmunition",void 0),this._state=xe.CLOSED,this._counter=0,this._camera=St.Main,this._cameraTransform=i,this._giveAmmunition=!1}update(t,e,s,i){if(this._state===xe.OPENING){const t=this.getTransform().getTranslation();0===this._counter&&this._openingVFX(!1,i),this._counter+=.01,this.getTransform().setTranslation((new g.Z).lerp([t.x,.01,t.z],[t.x,-6.75,t.z],this._counter)),this._counter>1&&(this._openingVFX(!0,i),this._state=xe.OPENED,this.getHitbox().disableCollision(!0),this._counter=0)}else if(this._state===xe.CLOSING){const t=this.getTransform().getTranslation();0===this._counter&&this._closingVFX(!1),this._counter+=.01,this.getTransform().setTranslation((new g.Z).lerp([t.x,-6.75,t.z],[t.x,.01,t.z],this._counter)),this._counter>1&&(this._closingVFX(!0),this._state=xe.CLOSED,this.getHitbox().disableCollision(!1),this._counter=0)}}interact(){this._state===xe.CLOSED?this._state=xe.OPENING:this._state===xe.OPENED&&(this._state=xe.CLOSING)}_openingVFX(t,e){t?(vt.getSound("door").pause(),setTimeout((()=>ye.getInstance().setStop(!1)),300)):(se.getDialog("display").animateText("door was opened",30,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>{t.remove(),this._giveAmmo(e)}),1e3)})),vt.getSound("door").play(),ye.getInstance().setStop(!0),this._camera.getTransform().setTranslation(this._cameraTransform.getTranslation()),this._camera.getTransform().setRotation(this._cameraTransform.getRotation()))}_giveAmmo(t){if(!this._giveAmmunition){this._giveAmmunition=!0;const e=t.get(ue.NAME);e.setAmmo(e.getAmmo()+20),se.getDialog("display").animateText("ammo collected",30,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>t.remove()),500)}))}}_closingVFX(t){t?(vt.getSound("door").pause(),setTimeout((()=>ye.getInstance().setStop(!1)),300)):(se.getDialog("display").animateText("door was closed",30,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>t.remove()),1e3)})),vt.getSound("door").play(),ye.getInstance().setStop(!0),this._camera.getTransform().setTranslation(this._cameraTransform.getTranslation()),this._camera.getTransform().setRotation(this._cameraTransform.getRotation()))}getState(){return this._state}};function Ne(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Ae=class extends Yt{constructor(t,e,s){super(t,e,1,vt.getVAO("door-panel"),vt.getMaterial("door-panel"),s),Ne(this,"_hallDoor",void 0),Ne(this,"_player",void 0),Ne(this,"_locked",void 0),Ne(this,"_messageOnScreen",void 0),this._hallDoor=null,this._player=null,this._locked=!0,this._messageOnScreen=null}update(t,e,s,i){const r=this.getTransform().getTranslation(),n=this._player.getTransform().getTranslation();r.distanceTo(n)<5?(this._showMessage(),h.isKeyPressed(a.KEY_F)&&(this._hallDoor.interact(),this._locked||this._hallDoor.getState()!==xe.CLOSING?this._locked&&this._hallDoor.getState()===xe.OPENING&&(this.setLocked(!1),this._messageOnScreen&&(this._messageOnScreen.remove(),this._messageOnScreen=null)):(this.setLocked(!0),this._messageOnScreen&&(this._messageOnScreen.remove(),this._messageOnScreen=null)))):this._messageOnScreen&&(this._messageOnScreen.remove(),this._messageOnScreen=null)}_showMessage(){this._messageOnScreen||(this._hallDoor.getState()===xe.CLOSED?(this._messageOnScreen=se.getDialog("display"),this._messageOnScreen.animateText("press f to open the door",30,{vertical:"10%",horizontal:"center"})):this._hallDoor.getState()===xe.OPENED&&(this._messageOnScreen=se.getDialog("display"),this._messageOnScreen.animateText("press f to close the door",30,{vertical:"10%",horizontal:"center"})))}setHallDoor(t){this._hallDoor=t}getHallDoor(){return this._hallDoor}setPlayer(t){this._player=t}getPlayer(){return this._player}setLocked(t){this._locked=t}isLocked(){return this._locked}};function Me(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Oe=class extends m{constructor(t){super("renderer1",t),Me(this,"_projection",void 0),Me(this,"distanceConfig",{7:[1,.7,1.8],13:[1,.35,.44],20:[1,.22,.2],32:[1,.14,.07],50:[1,.09,.032],65:[1,.07,.017],100:[1,.045,.0075],160:[1,.027,.0028],200:[1,.022,.0019],325:[1,.014,7e-4],600:[1,.007,2e-4],3250:[1,.0014,7e-6]}),this._projection=(new L).perspective({fovy:D(70),aspect:window.innerWidth/window.innerHeight,near:1,far:1e3}),this._maximumRenderDistance=120}render(){vt.forEachMaterial((t=>{t.bind();const e=t.getShader();e.setMatrix4x4("u_projection",this._projection),e.setMatrix4x4("u_view",this.getCamera().getView());const s=this.getCamera().getTransform().getTranslation();e.setVector3("u_camera_position",s.negate()),e.setVector3("lightCamera.color.ambient",new g.Z(1,1,1)),e.setVector3("lightCamera.color.diffuse",new g.Z(.5,.5,.5)),e.setVector3("lightCamera.color.specular",new g.Z(.3,.3,.3)),e.setVector3("lightCamera.position",s.negate());const i=this.distanceConfig[100];e.setFloat("lightCamera.distance.constant",i[0]),e.setFloat("lightCamera.distance.linear",i[1]),e.setFloat("lightCamera.distance.quadratic",i[2]),e.setFloat("lightCamera.shininess",32),e.setFloat("u_onlyLights","mascara"==Ft.mode?1:0),this.getEntitiesByMaterial(t).forEach(((s,i)=>{(s instanceof Yt||s instanceof jt)&&(s instanceof Yt&&s.getLampList().forEach(((t,s)=>{const i=`pointLights[${s}]`;e.setVector3(i+".color.ambient",t.color),e.setVector3(i+".color.diffuse",t.color),e.setVector3(i+".color.specular",t.color);const r=this.distanceConfig[t.distance];e.setFloat(i+".distance.constant",r[0]),e.setFloat(i+".distance.linear",r[1]),e.setFloat(i+".distance.quadratic",r[2]),e.setFloat(i+".shininess",t.shininess),e.setVector3(i+".position",t.getTransform().getTranslation().negate())})),s instanceof Ae&&e.setFloat("u_locked",Number(s.isLocked())),s instanceof jt?(e.setFloat("u_applyLight",0),e.setVector3("u_lightColor",s.color)):e.setFloat("u_applyLight",1),t.getShader().setMatrix4x4("u_transform",s.getTransform().worldMatrix()),t.getShader().setMatrix4x4("u_worldInverseTranspose",s.getTransform().toMatrix().invert().transpose()),s.getVAO().bind(),r.draw(s.getVAO().getLength()),s.getVAO().unbind())})),t.unbind()}))}};function Ce(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Ie=class extends m{constructor(t){super("monster-renderer",t),Ce(this,"_projection",void 0),Ce(this,"_material",void 0),Ce(this,"_vao",void 0),Ce(this,"_player",void 0),Ce(this,"distanceConfig",{7:[1,.7,1.8],13:[1,.35,.44],20:[1,.22,.2],32:[1,.14,.07],50:[1,.09,.032],65:[1,.07,.017],100:[1,.045,.0075],160:[1,.027,.0028],200:[1,.022,.0019],325:[1,.014,7e-4],600:[1,.007,2e-4],3250:[1,.0014,7e-6]}),this._projection=(new L).perspective({fovy:D(70),aspect:window.innerWidth/window.innerHeight,near:1,far:1e3}),this._material=vt.getMaterial("monster"),this._vao=vt.getVAO("monster"),this._maximumRenderDistance=75}setPlayer(t){this._player=t}render(){this._material.bind();const t=this._material.getShader();t.setMatrix4x4("u_projection",this._projection),t.setMatrix4x4("u_view",this.getCamera().getView());const e=this.getCamera().getTransform().getTranslation();t.setVector3("u_camera_position",e.negate()),t.setVector3("u_color",new g.Z(1,.2,.3)),t.setVector3("lightCamera.color.ambient",new g.Z(1,1,1)),t.setVector3("lightCamera.color.diffuse",new g.Z(.5,.5,.5)),t.setVector3("lightCamera.color.specular",new g.Z(.3,.3,.3)),t.setVector3("lightCamera.position",e.negate());const s=this.distanceConfig[100];t.setFloat("lightCamera.distance.constant",s[0]),t.setFloat("lightCamera.distance.linear",s[1]),t.setFloat("lightCamera.distance.quadratic",s[2]),t.setFloat("lightCamera.shininess",32),this._vao.bind();const i=this._player.getTransform().getTranslation();this.getEntitiesByMaterial(this._material).filter((t=>t instanceof fe)).sort(((t,e)=>{const s=i.distanceTo(t.getTransform().getTranslation()),r=i.distanceTo(e.getTransform().getTranslation());return s<r?1:s>r?-1:0})).forEach(((e,s)=>{e.getLampList().forEach(((e,s)=>{const i=`pointLights[${s}]`;t.setVector3(i+".color.ambient",e.color),t.setVector3(i+".color.diffuse",e.color),t.setVector3(i+".color.specular",e.color);const r=this.distanceConfig[e.distance];t.setFloat(i+".distance.constant",r[0]),t.setFloat(i+".distance.linear",r[1]),t.setFloat(i+".distance.quadratic",r[2]),t.setFloat(i+".shininess",e.shininess),t.setVector3(i+".position",e.getTransform().getTranslation().negate())})),t.setInt("applyLight",1),this._material.getShader().setMatrix4x4("u_transform",this._getTransformMatrix(e)),this._material.getShader().setMatrix4x4("u_worldInverseTranspose",e.getTransform().toMatrix().invert().transpose()),r.draw(this._vao.getLength())})),this._vao.unbind(),this._material.unbind()}_getTransformMatrix(t){const e=this._player.getTransform().getTranslation(),s=t.getTransform().getTranslation().subtract(e).normalize(),i=new L([s.z,0,-s.x,0,0,1,0,0,s.x,0,s.z,0,0,0,0,1]),r=(new L).translate(t.getTransform().getTranslation().negate()),n=(new L).scale(t.getTransform().getScale());return r.multiplyRight(i.multiplyRight(n))}};function Re(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Le=class extends Et{constructor(){super("door-panel",vt.getShader("door-panel")),Re(this,"_lockedTexture",void 0),Re(this,"_unlockedTexture",void 0),Re(this,"_displayMap",void 0),this._lockedTexture=vt.getTexture("door-panel-locked"),this._unlockedTexture=vt.getTexture("door-panel-unlocked"),this._displayMap=vt.getTexture("door-panel-display-map")}create(){this.getShader().create(),this._lockedTexture.create(),this._unlockedTexture.create(),this._displayMap.create()}bind(){this.getShader().bind(),i.activeTexture(i.TEXTURE0),this._lockedTexture.bind(),this.getShader().setInt("u_lockedTexture",0),i.activeTexture(i.TEXTURE1),this._unlockedTexture.bind(),this.getShader().setInt("u_unlockedTexture",1),i.activeTexture(i.TEXTURE2),this._displayMap.bind(),this.getShader().setInt("u_displayMap",2)}unbind(){this._displayMap.unbind(),this._unlockedTexture.unbind(),this._lockedTexture.unbind(),this.getShader().unbind()}destroy(){this._displayMap.destroy(),this._unlockedTexture.destroy(),this._lockedTexture.destroy(),this.getShader().destroy()}};function Pe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Fe=class extends m{constructor(t){super("player-renderer",t),Pe(this,"_projection",void 0),Pe(this,"_player",void 0),Pe(this,"_gun",void 0),Pe(this,"distanceConfig",{7:[1,.7,1.8],13:[1,.35,.44],20:[1,.22,.2],32:[1,.14,.07],50:[1,.09,.032],65:[1,.07,.017],100:[1,.045,.0075],160:[1,.027,.0028],200:[1,.022,.0019],325:[1,.014,7e-4],600:[1,.007,2e-4],3250:[1,.0014,7e-6]}),this._projection=(new L).perspective({fovy:D(70),aspect:window.innerWidth/window.innerHeight,near:1,far:1e3}),this._player=null,this._gun=null}setPlayer(t,e){this._player=t,this._gun=e}render(){this._player.getStop()||(this._bindMaterial(this._player),this._renderHand(),this._player.getMaterial().unbind(),this._bindMaterial(this._gun),this._renderGun(),this._gun.getMaterial().unbind())}_bindMaterial(t){const e=t.getMaterial();e.bind();const s=e.getShader();s.setMatrix4x4("u_projection",this._projection),s.setMatrix4x4("u_view",this.getCamera().getView());const i=this.getCamera().getTransform().getTranslation();s.setVector3("u_camera_position",i.negate()),s.setVector3("u_color",new g.Z(1,.2,.3)),s.setVector3("lightCamera.color.ambient",new g.Z(1,1,1)),s.setVector3("lightCamera.color.diffuse",new g.Z(.5,.5,.5)),s.setVector3("lightCamera.color.specular",new g.Z(.3,.3,.3)),s.setVector3("lightCamera.position",i.negate());const r=this.distanceConfig[100];s.setFloat("lightCamera.distance.constant",r[0]),s.setFloat("lightCamera.distance.linear",r[1]),s.setFloat("lightCamera.distance.quadratic",r[2]),s.setFloat("lightCamera.shininess",32),t.getLampList().forEach(((t,e)=>{const i=`pointLights[${e}]`;s.setVector3(i+".color.ambient",t.color),s.setVector3(i+".color.diffuse",t.color),s.setVector3(i+".color.specular",t.color);const r=this.distanceConfig[t.distance];s.setFloat(i+".distance.constant",r[0]),s.setFloat(i+".distance.linear",r[1]),s.setFloat(i+".distance.quadratic",r[2]),s.setFloat(i+".shininess",t.shininess),s.setVector3(i+".position",t.getTransform().getTranslation().negate())})),s.setFloat("u_applyLight",1)}_renderHand(){const t=this._player.getHandTransformMatrix();this._renderObject(this._player.getVAO(),this._player.getMaterial().getShader(),t,new L(t).invert().transpose())}_renderGun(){const t=this._gun.getTransform().worldMatrix();this._renderObject(this._gun.getVAO(),this._gun.getMaterial().getShader(),t,new L(t).invert().transpose());const e=this._gun.getSliderTransform().worldMatrix();this._renderObject(this._gun.getSliderVAO(),this._gun.getMaterial().getShader(),e,new L(e).invert().transpose())}_renderObject(t,e,s,i){e.setMatrix4x4("u_transform",s),e.setMatrix4x4("u_worldInverseTranspose",i),t.bind(),r.draw(t.getLength()),t.unbind()}};function De(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class ke{constructor(t,e){De(this,"_p",void 0),De(this,"_q",void 0),this._p=t,this._q=e}getP(){return this._p}getQ(){return this._q}}const Ve=class extends ge{constructor(t,e){super(),De(this,"_lines",void 0),this._lines=[];for(let s=0;s<e.length;s+=2){const i=t[2*e[s]],r=t[2*e[s]+1],n=t[2*e[s+1]],a=t[2*e[s+1]+1];this._lines.push(new ke(new F(i,r),new F(n,a)))}}getLines(){return this._lines}};function je(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Ke=class{constructor(t,e){je(this,"_solid1",void 0),je(this,"_solid2",void 0),this._solid1=t,this._solid2=e}getSolid1(){return this._solid1}getSolid2(){return this._solid2}};class Be extends Ke{static test(t,e){const s=new F(t.getTransform().getTranslation().x,t.getTransform().getTranslation().z),i=new F(e.getTransform().getTranslation().x,e.getTransform().getTranslation().z),r=t.getHitbox().getRadius()+e.getHitbox().getRadius();return i.distanceTo(s)<r?new Be(t,e):null}getAccelerationOnSolid1(){return this._getAccelerationOnSolid(this.getSolid1(),this.getSolid2())}getAccelerationOnSolid2(){return this._getAccelerationOnSolid(this.getSolid2(),this.getSolid1())}_getAccelerationOnSolid(t,e){const s=new F(t.getTransform().getTranslation().x,t.getTransform().getTranslation().z),i=new F(e.getTransform().getTranslation().x,e.getTransform().getTranslation().z),r=new F(i).subtract(s),n=new F(s).subtract(i),a=t.getHitbox().getRadius(),o=e.getHitbox().getRadius(),h=new F(s).add(r.multiplyByScalar(a).divideScalar(r.magnitude())),l=new F(i).add(n.multiplyByScalar(o).divideScalar(n.magnitude())).subtract(h);return new g.Z(l.x,0,l.y)}solve(){const t=new F(this.getSolid1().getTransform().getTranslation().x,this.getSolid1().getTransform().getTranslation().z),e=new F(this.getSolid2().getTransform().getTranslation().x,this.getSolid2().getTransform().getTranslation().z),s=new F(t).subtract(e),i=this.getSolid1().getHitbox().getRadius()+this.getSolid2().getHitbox().getRadius();s.divideScalar(s.magnitude()),this.getSolid1().getTransform().setX(this.getSolid2().getTransform().getX()+i*s.x),this.getSolid1().getTransform().setZ(this.getSolid2().getTransform().getZ()+i*s.y)}}const Ye=Be;class Ze extends Ke{constructor(t,e,s){super(t,e),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_intersectedLine",void 0),this._intersectedLine=s}static test(t,e){const s=new F(t.getTransform().getTranslation().x,t.getTransform().getTranslation().z),i=e.getTransform().toInversePositionMatrix(),r=t.getHitbox(),n=e.getHitbox(),a=[];return n.getLines().forEach((t=>{const e=new g.Z(t.getP().x,0,t.getP().y).transform(i),n=new g.Z(t.getQ().x,0,t.getQ().y).transform(i),o=V(new F(e.x,e.z),new F(n.x,n.z)),h=((t,e)=>Math.abs(e.a*t.x+e.b*t.y+e.c)/Math.sqrt(e.a**2+e.b**2))(s,o);if(h<r.getRadius()){const t=k(o,j(s,r.getRadius()));t&&Ze._isInsideLine({p1:new F(e.x,e.z),p2:new F(n.x,n.z)},t)&&a.push({p:new F(e.x,e.z),q:new F(n.x,n.z),distance:h,intersectionPoints:t,circleCenter:s})}})),a.length>0?(a.sort(((t,e)=>t.distance-e.distance)),new Ze(t,e,a[0])):null}solve(){const t=new F(this._intersectedLine.intersectionPoints.p2).subtract(this._intersectedLine.intersectionPoints.p1).divideScalar(2).add(this._intersectedLine.intersectionPoints.p1),e=new F(t).subtract(this._intersectedLine.circleCenter).multiplyByScalar(2),s=new F(e).negate();e.add(this._intersectedLine.circleCenter);const i=this.getSolid1().getHitbox().getRadius()+t.distanceTo(e);s.divideScalar(s.magnitude()),this.getSolid1().getTransform().setX(e.x+i*s.x),this.getSolid1().getTransform().setZ(e.y+i*s.y)}static _isInsideLine(t,e){let s=0,i=0;return t.p1.x!==t.p2.x?(t.p1.x<t.p2.x?(s=t.p1.x,i=t.p2.x):(s=t.p2.x,i=t.p1.x),e.p1.x>s&&e.p1.x<i||e.p2.x>s&&e.p2.x<i):(t.p1.y<t.p2.y?(s=t.p1.y,i=t.p2.y):(s=t.p2.y,i=t.p1.y),e.p1.y>s&&e.p1.y<i||e.p2.y>s&&e.p2.y<i)}}const ze=Ze;function Ue(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function He(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Ge=class extends ${constructor(t){super(t),He(this,"_properties",void 0),He(this,"_physics",void 0),this._physics=new class{constructor(){Ue(this,"_solidEntities",void 0),Ue(this,"_staticEntities",void 0),Ue(this,"_dynamicEntities",void 0),Ue(this,"_intersections",void 0),this._solidEntities=[],this._staticEntities=[],this._dynamicEntities=[],this._intersections=[]}add(t){this._solidEntities.push(t),t instanceof Bt?this._staticEntities.push(t):t instanceof re&&this._dynamicEntities.push(t)}remove(t){this._solidEntities=this._solidEntities.filter((e=>e.getName()!==t.getName())),t instanceof Bt?this._staticEntities=this._staticEntities.filter((e=>e.getName()!==t.getName())):t instanceof re&&(this._dynamicEntities=this._dynamicEntities.filter((e=>e.getName()!==t.getName())))}applyPhysics(t,e,s){t.updateSpeed(s),t.getTransform().getY()<e.defaultFakeFloor&&t.getSpeed().add(new g.Z(0,e.gravity*s,0)),t.getSpeed().add(new g.Z(t.getSpeed()).multiplyByScalar(-e.airFrictionCoefficient*s)),t.getTransform().setTranslation(t.getTransform().getTranslation().add(t.getSpeed())),t.getTransform().getY()>e.defaultFakeFloor&&(t.getSpeed().y=0,t.getTransform().setY(e.defaultFakeFloor))}reapplyPhysics(t,e){this._dynamicEntities.forEach((s=>this.applyPhysics(s,t,e)))}anyCollisionDetected(){return this._intersections=[],this._dynamicEntities.forEach((t=>{t.getHitbox().isCollisionDisabled()||this._solidEntities.filter((e=>!e.getHitbox().isCollisionDisabled()&&t.getName()!==e.getName()&&t.getTransform().getTranslation().distanceTo(e.getTransform().getTranslation())<(e instanceof re?5:50))).forEach((e=>{const s=this._test(t,e);s&&this._intersections.push(s)}))})),this._intersections.length>0}_test(t,e){return t.getHitbox()instanceof _e&&e.getHitbox()instanceof _e?Ye.test(t,e):t.getHitbox()instanceof _e&&e.getHitbox()instanceof Ve?ze.test(t,e):void 0}distributeForces(){this._intersections.forEach((t=>{const e=t.getSolid1();t.solve(),e.getSpeed().x=0,e.getSpeed().z=0}))}},this._properties={gravity:9.807,airFrictionCoefficient:5,defaultFakeFloor:0}}add(t,e=!0){return super.add(t,e),t instanceof Kt&&e&&this._physics.add(t),this}remove(t){return t instanceof Kt&&this.hasInVisible(t)&&this._physics.remove(t),super.remove(t),this}setVisibility(t,e){return super.setVisibility(t,e),t instanceof Kt&&e?this._physics.add(t):t instanceof Kt&&!e&&this._physics.remove(t),this}update(t,e,s){this.forEachVisible((i=>{i.update(t,e,this,s),i instanceof re&&this._physics.applyPhysics(i,this._properties,e)})),this._physics.anyCollisionDetected()&&this._physics.distributeForces()}getProperties(){return this._properties}};function We(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Xe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const qe=class{constructor(t,e){Xe(this,"_name",void 0),Xe(this,"_g",void 0),Xe(this,"_h",void 0),Xe(this,"_neighbours",void 0),Xe(this,"_marked",void 0),Xe(this,"_position",void 0),Xe(this,"_path",void 0),this._name=t,this._position=e,this._g=0,this._h=0,this._neighbours=new Map,this._marked=!1,this._path=null}distanceTo(t){return this._position.distanceTo(t.getPosition())}calculateG(t){this._g=t.distanceTo(this._position)}setG(t){this._g=t}getG(){return this._g}calculateH(t){this._h=t.distanceTo(this._position)}setH(t){this._h=t}getH(){return this._h}getF(){return this._g+this._h}getNeighbours(){return this._neighbours}setMarked(t){this._marked=t}isMarked(){return this._marked}setPosition(t){this._position=t}getPosition(){return this._position}setPath(t){this._path=t}getPath(){return this._path}getName(){return this._name}},$e=class extends qe{constructor(t){super(t.getName(),null),function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(this,"_entity",void 0),this._entity=t}getEntity(){return this._entity}distanceTo(t){return this.getPosition().distanceTo(t.getPosition())}getPosition(){return new F(this._entity.getTransform().getTranslation().x,this._entity.getTransform().getTranslation().z)}};function Qe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Je(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class ts extends ${constructor(t,e){super(ts.END_SCENE),Je(this,"_fading",void 0),this.getRenderStrategy().add(t),this._fading=e,this.init(t)}init(t){const e=new se("endDisplay",t);this.add(e),e.getTransform().setTranslation(new g.Z(100,100,-1).negate()),this.onChange((()=>{this._fading.fadeIn(),vt.forEachSound((t=>t.pause())),vt.getSound("elevator").play(!1);const t=se.Find("endDisplay");t.init(),t.animateText("voce chegou no fim",20,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>{this._fading.fadeOut}),4e3),setTimeout((()=>{t.remove(),window.location.reload()}),5e3)}))}))}render(t){this._fading.getFrameBuffer().bind(),super.render(t),this._fading.getFrameBuffer().unbind(),this._fading.render(t)}}Je(ts,"END_SCENE","end");const es=ts;function ss(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class is extends Ge{constructor(t,e){super(is.NAME),ss(this,"_camera",void 0),ss(this,"_entityFactory",void 0),ss(this,"_player",void 0),ss(this,"_gun",void 0),ss(this,"_lamps",void 0),ss(this,"_pathFinding",void 0),ss(this,"_lampSortingTimer",void 0),ss(this,"_pathFindingCalculationTimer",void 0),ss(this,"_hud",void 0),ss(this,"_gameOver",void 0),ss(this,"_frameBuffer",[]),ss(this,"_fading",void 0),this._camera=t,this._entityFactory=new class{constructor(t,e){We(this,"_scene",void 0),We(this,"_renderStrategy",void 0),this._scene=t,this._renderStrategy=e}load(){this._loadMap(),this._loadMonsters(),this._configureEntities()}_loadMonsters(){rt.load("/resources/monsters.json",(t=>{const e=JSON.parse(t);Object.keys(e).forEach((t=>{const s=e[t],i=new fe(t,this._renderStrategy.get("monster-renderer"),this._scene.get("player"));i.getTransform().setTranslation(new g.Z(s.translation.x,s.translation.y,s.translation.z)),i.getTransform().setScale(new g.Z(1,2,1)),i.getHitbox().disableCollision(!0),this._scene.add(i)}))}),(function(t){console.error("Could not import monsters from json: ",t)}))}_loadMap(){const t=(new ut).loadHitboxes("/resources/hitboxes.json");rt.load("/resources/entities.json",(e=>{const s=JSON.parse(e);Object.keys(s).forEach((e=>{const i=s[e],r=(()=>{for(let t=e.length-1;t>=0;t--)if("_"===e[t])return e.substring(0,t);return""})(),n=this._createEntity(e,r,t,i.options);n.getTransform().setTranslation(new g.Z(i.translation.x,i.translation.y,i.translation.z)),n.getTransform().setRotation(new f.Z(i.rotation.x,i.rotation.y,i.rotation.z)),n.getTransform().setScale(new g.Z(i.scale.x,i.scale.y,i.scale.z)),this._scene.add(n)}))}),(function(t){console.error("Could not import entities from json: ",t)}))}_createEntity(t,e,s,i){switch(e){case"lamp":return new jt(t,this._renderStrategy.get("renderer1"),new g.Z(1,0,0));case"hall-door":let r;return i?.camera&&(r=new H(i.camera.translation,new f.Z(i.camera.rotation.x,i.camera.rotation.y,i.camera.rotation.z))),new Se(t,this._getHitbox(e,s),this._renderStrategy.get("renderer1"),r);case"door-panel":return new Ae(t,this._getHitbox(e,s),this._renderStrategy.get("renderer1"))}return new Yt(t,this._getHitbox(e,s),1,vt.getVAO(e),this._getMaterial(e),this._renderStrategy.get("renderer1"))}_getMaterial(t){switch(t){case"hall":case"level-2":return vt.getMaterial("level")}return vt.getMaterial(t)}_configureEntities(){this._scene.get("lamp_2").color=new g.Z(1,1,1),this._scene.get("lamp_33").color=new g.Z(1,1,1),this._distributeClosestLampsForStaticEntities()}_distributeClosestLampsForStaticEntities(){const t=[];this._scene.forEach((e=>{e instanceof jt&&t.push(e)})),this._scene.forEach((e=>{(e instanceof Yt||e instanceof fe)&&e.setLampList(this.get5ClosestLamps(e,t))}))}get5ClosestLamps(t,e,s=t.getTransform().getTranslation()){return Array.from(e).sort(((t,e)=>{const i=s.distanceTo(t.getTransform().getTranslation()),r=s.distanceTo(e.getTransform().getTranslation());return i>r?1:i<r?-1:0})).slice(0,5)}_getHitbox(t,e){return new Ve(e.edge[t].vertices,e.edge[t].indices)}}(this,this.getRenderStrategy()),this._player=null,this._gun=null,this._lamps=[],this._pathFinding=null,this._lampSortingTimer=3,this._pathFindingCalculationTimer=5,this._fading=e,this._gameOver=!1}init(t){this._hud=new ue(this),t.add(this._hud),this._frameBuffer.push(new Ft(this._camera,"albedo",1)),this._frameBuffer.push(new Ft(this._camera,"mascara",.25)),this._player=new ye("player",new _e(2),this._camera,this.getRenderStrategy().get("player-renderer")),this._gun=new ve(this.getRenderStrategy().get("player-renderer")),this._player.getTransform().setTranslation(new g.Z(51.1,0,-88)),this._player.getTransform().setRotation(new f.Z(0,-32)),this._player.setGun(this._gun),this._gun.getTransform().parent=this._player.getHandTransform(),this.add(this._player),this.add(this._gun),this._entityFactory.load();const e={"door-panel_3":"hall-door_0","door-panel_4":"hall-door_2","door-panel_0":"hall-door_1","door-panel_5":"hall-door_4","door-panel_6":"hall-door_6","door-panel_1":"hall-door_7","door-panel_7":"hall-door_8","door-panel_8":"hall-door_10","door-panel_2":"hall-door_11"};this.filterVisible((t=>t instanceof Se)).forEach((t=>t.getHitbox().disableCollision(!0))),this.filterVisible((t=>t instanceof Ae)).forEach((t=>{const s=this.get(e[t.getName()]);s.getHitbox().disableCollision(!1),t.setHallDoor(s),t.setPlayer(this._player)})),this.forEach((t=>{t instanceof jt&&this._lamps.push(t)})),this._pathFinding=new class{constructor(t,e){Qe(this,"_nodes",void 0),Qe(this,"_openNodes",void 0),Qe(this,"_closedNodes",void 0),Qe(this,"_scene",void 0),Qe(this,"_player",void 0),Qe(this,"_playerNode",void 0),Qe(this,"_monsterNodes",void 0),this._nodes=new Map,this._openNodes=new Map,this._closedNodes=new Map,this._scene=t,this._player=e,this._playerNode=new $e(e),this._nodes.set(this._playerNode.getName(),this._playerNode),this._monsterNodes=new Map,t.filterVisible((t=>t instanceof fe)).forEach((t=>{const e=new $e(t);this._monsterNodes.set(t.getName(),e)}))}find(t){const e=this._monsterNodes.get(t.getName()),s=this._playerNode;let i;for(this._nodes.set(e.getName(),e),this._clearOldPath(),this._connectNearestNodesToMonster(e),this._openNodes.clear(),this._closedNodes.clear(),this._openNodes.set(e.getName(),e);this._openNodes.size>0&&(i=this._popLowestCostNode(this._openNodes),this._closedNodes.set(i.getName(),i),i!==s);)i.getNeighbours().forEach((t=>{if(this._closedNodes.has(t.getName()))return;const e=!this._openNodes.has(t.getName()),r=i.getG()+i.distanceTo(t);(e||r<t.getG())&&(t.setG(r),t.setPath(i),e&&(t.setH(t.distanceTo(s)),this._openNodes.set(t.getName(),t)))}));return this._nodes.delete(e.getName()),this._getPath()}_getPath(){const t=[];let e=this._playerNode;do{t.push(e),e=e.getPath()}while(e);return t.pop(),t.reverse()}_clearOldPath(){this._nodes.forEach((t=>{t.setPath(null)}))}connectNearestNodesToPlayer(){this._clearOldNearestNodes(this._playerNode);const t=this._findNearest(this._playerNode);this._playerNode.getNeighbours().set(t.firstClosestNode.getName(),t.firstClosestNode),t.firstClosestNode.getNeighbours().set(this._playerNode.getName(),this._playerNode)}_connectNearestNodesToMonster(t){this._clearOldNearestNodes(t);const e=this._findNearest(t);t.getNeighbours().set(e.firstClosestNode.getName(),e.firstClosestNode)}_findNearest(t){let e,s;return this._nodes.forEach((i=>{if(i.getName()===t.getName())return;const r=t.distanceTo(i);(!e||r<s)&&((t,i)=>{e=t,s=i})(i,r)})),{firstClosestNode:e,firstClosestNodeDistance:s}}_clearOldNearestNodes(t){t.getNeighbours().forEach((e=>{e.getNeighbours().delete(t.getName())})),t.getNeighbours().clear()}_popLowestCostNode(t){let e,s;return t.forEach(((t,i)=>{(!e||e.getF()>t.getF()||e.getF()===t.getF()&&e.getH()>t.getH())&&(e=t,s=i)})),t.delete(s),e}loadNodes(){rt.load("/resources/nodes.json",(t=>{const e=JSON.parse(t);Object.keys(e).forEach((t=>{const s=e[t].translation,i=new qe(t,new F(s.x,s.z));this._nodes.set(i.getName(),i)})),this._connectNodes()}),(function(t){throw new Error(`Error trying to load nodes.\n ${t}`)}))}_connectNodes(){const t={0:[1],1:[0,2,3],2:[1,9],3:[1,4],4:[3,5],5:[4,6,17],6:[5,7],7:[6,8],8:[7,9,10],9:[2,8],10:[8,11,12],11:[10,14],12:[10,13],13:[12,16],14:[11,15],15:[14,16],16:[15,13],17:[5,18,19],18:[17,25],19:[17,20],20:[19,21],21:[20,22,33],22:[21,23],23:[22,24],24:[23,25,26],25:[18,24],26:[24,27,28],27:[26,32],28:[26,29],29:[28,30],30:[29,31],31:[30,32],32:[31,27],33:[21,34,35],34:[33,40],35:[33,36],36:[35,37],37:[36,38,49],38:[37,39],39:[38,40],40:[39,41,42],41:[34,40],42:[40,43,48],43:[42,44],44:[43,45],45:[44,46],46:[45,47],47:[46,48],48:[47,42],49:[37]};Object.keys(t).forEach((e=>{const s=this._nodes.get("node_"+e);t[e].forEach((t=>{const e="node_"+t;s.getNeighbours().set(e,this._nodes.get(e))}))}))}getNodes(){return this._nodes}}(this,this._player),this._pathFinding.loadNodes(),this.onChange((()=>{this._fading.fadeIn(),this._camera.getTransform().setTranslation(new g.Z(51.1,0,-88)),this._camera.getTransform().setRotation(new f.Z(0,-32)),se.Find("display").animateText("try not to die",20,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>t.remove()),5e3)}))})),vt.getSound("monster-damage").setListener(this._player.getTransform()),vt.getSound("monster-death").setListener(this._player.getTransform()),vt.getSound("monster-attack").setListener(this._player.getTransform());const s=vt.getSound("whispers");s.setOrigin(this.getEndPoint()),s.setListener(this._player.getTransform()),s.play(!0)}gameOver(t){this._gameOver||(this._fading.fadeOut(),this._gameOver=!0,setTimeout((()=>{vt.getSound("whispers").pause(),Is.getInstance().setScene(t)}),1e3))}calculatePathFinding(t){this._pathFinding.connectNearestNodesToPlayer();const e=this._pathFinding.find(t);t.setPath(e)}update(t,e,s){super.update(t,e,s),this._lampSortingTimer>=3?(this._player.setLampList(this._entityFactory.get5ClosestLamps(this._player,this._lamps)),this._gun.setLampList(this._entityFactory.get5ClosestLamps(this._gun,this._lamps,this._gun.getTransform().worldTranslation())),this.filterVisible((t=>t instanceof fe&&t.isTriggered())).forEach((t=>{t.setLampList(this._entityFactory.get5ClosestLamps(t,this._lamps))})),this._lampSortingTimer-=3):this._lampSortingTimer+=e,this._pathFindingCalculationTimer>=5?(this.filterVisible((t=>t instanceof fe&&t.isTriggered())).forEach(this.calculatePathFinding.bind(this)),this._pathFindingCalculationTimer-=5):this._pathFindingCalculationTimer+=e,this.getEndPoint().getTranslation().distanceTo(this._player.getTransform().getTranslation())<10&&this.gameOver(es.END_SCENE)}render(t){this._frameBuffer[0].bind(),super.render(t),this._frameBuffer[0].unbind(),this._frameBuffer[0].prepare(),this._frameBuffer[1].bind(),super.render(t),this._frameBuffer[1].unbind(),this._frameBuffer[1].renderBloom(t),this._fading.getFrameBuffer().bind(),this._frameBuffer[1].render(t),this._fading.getFrameBuffer().unbind(),this._fading.render(t)}getEndPoint(){return this.get("elevator_1").getTransform()}isGameOver(){return this._gameOver}}ss(is,"NAME","main");const rs=is;function ns(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class as extends ${constructor(t,e){super(as.LOADING_SCENE),ns(this,"_fading",void 0),this.getRenderStrategy().add(t),this._fading=e,this.init(t)}init(t){const e=new se("loadingDisplay",t);this.add(e),e.getTransform().setTranslation(new g.Z(100,100,-1).negate()),e.init(),this.onChange((()=>{this._fading.fadeIn(),vt.getSound("elevator").play(!1),se.Find("loadingDisplay").animateText("underground factory",20,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>{t.remove()}),2e3)})),setTimeout((()=>{se.Find("loadingDisplay").animateText("find the other elevator to escape",20,{vertical:"10%",horizontal:"center"},(t=>{setTimeout((()=>{this._fading.fadeOut()}),4e3),setTimeout((()=>{t.remove(),Is.getInstance().setScene(rs.NAME)}),5e3)}))}),4e3)}))}render(t){this._fading.getFrameBuffer().bind(),super.render(t),this._fading.getFrameBuffer().unbind(),this._fading.render(t)}}ns(as,"LOADING_SCENE","loading");const os=as;function hs(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class ls extends X{constructor(t){super(ls.CREDITS_ENTITY,null,null,t),hs(this,"_texture",void 0),hs(this,"color",new g.Z(0,0,0)),hs(this,"alpha",1),hs(this,"_height",void 0),hs(this,"_running",void 0),this._running=!1,this.resetHeight(),this._loadCredits(),this.setVAO(vt.getVAO("effect")),this.setMaterial(new yt(ls.CREDITS_ENTITY,vt.getShader("text"),this._texture)),vt.addMaterials([this.getMaterial()]),this.getMaterial().create(),this.getTransform().setTranslation(new g.Z(-u.CANVAS.width/2-32,this._height,-1)),this.getTransform().setScale(new g.Z(u.CANVAS.width/2,3*u.CANVAS.height/2,1))}update(t,e,s,i){this._running&&(this._height+=20*e,this.getTransform().setY(this._height),this._height>=u.CANVAS.height&&this.resetHeight())}_loadCredits(){const t=document.createElement("canvas");t.width=u.CANVAS.width,t.height=3*u.CANVAS.height;const e=t.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.font="20px serif",e.fillStyle="white",rt.load("/resources/CREDITS",(t=>{const s=t.split("\n");for(let t=0;t<s.length;t++)e.fillText(s[t],0,50+20*t);const i=new Uint8Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data);this._texture=new _t(e.canvas.width,e.canvas.height),this._texture.create(),this._texture.setData(i)}),(function(t){new Error(`Error trying to load credits.\n ${t}`)}))}resetHeight(){this._height=2.5*-u.CANVAS.height}setRunning(t){this._running=t}}hs(ls,"CREDITS_ENTITY","creditsEntity");const cs=ls;function ds(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const us=class extends Qt{constructor(t,e,s,i){super(e,s),ds(this,"size",void 0),ds(this,"text",void 0),ds(this,"selection",void 0),ds(this,"rect",void 0),ds(this,"callback",null),this.getTransform().parent=t.getTransform(),this.setScene(i),this.selection=this.addRectangle(this.getName()+"_option_selection"),this.selection.setSize(190,60),this.selection.color=new g.Z(1,1,1),this.selection.getTransform().setTranslation(new g.Z(5,5,1)),this.rect=this.addRectangle(this.getName()+"_option_rectangle"),this.rect.getTransform().setTranslation(new g.Z(0,0,1)),this.rect.setSize(180,50),this.text=this.addText(this.getName()+"_option_text"),this.text.getTransform().setTranslation(new g.Z(-15,-15,-1)),this.text.getTransform().setScale(new g.Z(2,2,2))}selected(t){this.getScene().setVisibility(this.selection,t)}getRect(){return this.rect}setText(t){this.text.setText(t)}setExecute(t){this.callback=t}execute(){if(null!=this.callback)return this.callback()}update(t,e,s,i){}};function gs(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const _s=class extends Qt{constructor(t,e){super(t,e),gs(this,"padding",0),gs(this,"options",[]),gs(this,"selected",0),gs(this,"change",!1)}addOption(t){const e=t.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""),s=new us(this,this.getName()+"_"+e,this.getRenderer(),this.getScene());return this.padding>0&&s.selected(!1),this.options.push(s),s.getTransform().setTranslation(new g.Z(0,70*this.padding++,0).negate()),s.setText(t),s.getTransform().parent=this.getTransform(),this.getScene().add(s),this.updateTranslation(),s}updateTranslation(t=u.CANVAS.width,e=u.CANVAS.height){const s=e/2-25-70*this.padding/2,i=t/2-90;this.getTransform().setTranslation(new g.Z(i,s,0).negate())}update(t,e,s,i){const r=h.isKeyPressedDown(a.KEY_DOWN),n=h.isKeyPressedDown(a.KEY_UP);if(r||n){if(this.change){let t;const e=this.selected;n?(t=e-1,t<0&&(t=this.options.length-1)):(t=e+1,t>=this.options.length&&(t=0)),vt.getSound("menu").play(),this.options[e].selected(!1),this.options[t].selected(!0),this.selected=t,this.change=!1}}else h.isKeyPressedDown(a.KEY_ENTER)?this.change&&this.options[this.selected].execute():this.change=!0}};class ms extends X{constructor(t){super(ms.CREDITS_ENTITY,vt.getVAO("effect"),vt.getMaterial("instructions"),t),this.getTransform().setTranslation(new g.Z(-u.CANVAS.width/2,-u.CANVAS.height/2,-1)),this.getTransform().setScale(new g.Z(340,170,1))}update(t,e,s,i){}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(ms,"CREDITS_ENTITY","instructions-entity");const fs=ms;function ps(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class bs extends ${constructor(t,e){super(bs.NAME),ps(this,"_fading",void 0),this.getRenderStrategy().add(t),this._fading=e,this.init(t)}init(t){const e=new se("instructionsDisplay",t);this.add(e),e.getTransform().setTranslation(new g.Z(100,100,-1).negate()),e.init(),this.add(new fs(t));const s=new _s("select",t);this.add(s),s.addOption("back").setExecute((()=>{this._fading.fadeOut(),setTimeout((()=>{Is.getInstance().setScene(ys.MAIN_MENU)}),1e3)})),s.updateTranslation(u.CANVAS.width,2*u.CANVAS.height-50),this.onChange((()=>{this._fading.fadeIn(),se.Find("instructionsDisplay").animateText("instructions",20,{vertical:"10%",horizontal:"center"})}))}render(t){this._fading.getFrameBuffer().bind(),super.render(t),this._fading.getFrameBuffer().unbind(),this._fading.render(t)}}ps(bs,"NAME","instructions-menu");const vs=bs;function Ts(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Es extends ${constructor(t,e){super(Es.MAIN_MENU),Ts(this,"_fading",void 0),this.getRenderStrategy().add(t),this._fading=e,this.init(t)}init(t){const e=new _s("select1",t);this.add(e),e.addOption("play").setExecute((()=>{this._fading.fadeOut(),setTimeout((()=>{Is.getInstance().setScene(os.LOADING_SCENE),vt.getSound("music").play(!0)}),1e3)})),e.addOption("instructions").setExecute((()=>{this._fading.fadeOut(),setTimeout((()=>{Is.getInstance().setScene(vs.NAME)}),1e3)})),e.addOption("credits").setExecute((()=>{this._fading.fadeOut(),setTimeout((()=>{Is.getInstance().setScene(Ss.CREDITS_MENU)}),1e3)})),this.onChange((()=>{this._fading.fadeIn()}))}render(t){this._fading.getFrameBuffer().bind(),super.render(t),this._fading.getFrameBuffer().unbind(),this._fading.render(t)}}Ts(Es,"MAIN_MENU","main-menu");const ys=Es;function ws(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class xs extends ${constructor(t,e){super(xs.CREDITS_MENU),ws(this,"_fading",void 0),this.getRenderStrategy().add(t),this._fading=e,this.init(t)}init(t){const e=new cs(t);this.add(e);const s=new _s("select",t);this.add(s),s.addOption("voltar").setExecute((()=>{this._fading.fadeOut(),setTimeout((()=>{e.resetHeight(),e.setRunning(!1),Is.getInstance().setScene(ys.MAIN_MENU)}),1e3)})),s.updateTranslation(u.CANVAS.width,2*u.CANVAS.height-50),this.onChange((()=>{this._fading.fadeIn(),e.resetHeight(),e.setRunning(!0)}))}render(t){this._fading.getFrameBuffer().bind(),super.render(t),this._fading.getFrameBuffer().unbind(),this._fading.render(t)}}ws(xs,"CREDITS_MENU","credits-menu");const Ss=xs;function Ns(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}let As;!function(t){t[t.DONE=0]="DONE",t[t.FADE_IN=1]="FADE_IN",t[t.FADE_OUT=2]="FADE_OUT"}(As||(As={}));const Ms=class extends m{constructor(t){super("fading-renderer",t),Ns(this,"_state",void 0),Ns(this,"_frameBuffer",void 0),Ns(this,"_shader",void 0),Ns(this,"_vao",void 0),Ns(this,"_fading",void 0),this._frameBuffer=new Rt(i.COLOR_ATTACHMENT0,u.CANVAS.width,u.CANVAS.height),this._frameBuffer.create(),this._shader=vt.getShader("fading"),this._shader.create(),this._vao=vt.getVAO("effect"),this._fading=0}render(t){i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this._shader.bind(),i.activeTexture(i.TEXTURE0),this._frameBuffer.getTexture().bind(),this._shader.setInt("u_albedo",0),this._fade(t),this._vao.bind(),r.draw(this._vao.getLength()),this._vao.unbind(),this._frameBuffer.getTexture().unbind(),this._shader.unbind()}_fade(t){this._state===As.FADE_OUT?(this._fading+=t,this._fading>=1&&(this._fading=1,this._state=As.DONE)):this._state===As.FADE_IN&&(this._fading+=-t,this._fading<=0&&(this._fading=0,this._state=As.DONE)),this._shader.setFloat("u_fading",this._fading)}fadeIn(){this._state=As.FADE_IN,this._fading=1}fadeOut(){this._state=As.FADE_OUT,this._fading=0}getState(){return this._state}getFrameBuffer(){return this._frameBuffer}};function Os(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class Cs extends class{constructor(){it(this,"_updater",void 0),it(this,"_sceneManager",void 0),this._sceneManager=new et,this._updater=new class{constructor(){st(this,"_updatables",void 0),st(this,"_enabled",void 0),st(this,"_disabled",void 0),st(this,"_keys",(t=>[...t.keys()])),this._updatables=new Map,this._enabled=new Map,this._disabled=new Map}update(t,e){this.forEachEnabled((s=>{s.update(t,e,this)}))}add(t,e=!0){return this._validate(t,this._updatables),this._updatables.set(t.getName(),t),e?this._enabled.set(t.getName(),t):this._disabled.set(t.getName(),t),this}remove(t){const e=this._validate(t,this._updatables,!1);return this._updatables.delete(e),this._enabled.has(e)&&this._enabled.delete(e),this._disabled.has(e)&&this._disabled.delete(e),this}enable(t){const e=this._validate(t,this._updatables,!1);return this._enabled.has(e)||(this._enabled.set(e,this._disabled.get(e)),this._disabled.delete(e)),this}disable(t){const e=this._validate(t,this._updatables,!1);return this._disabled.has(e)||(this._disabled.set(e,this._enabled.get(e)),this._enabled.delete(e)),this}get(t){return this._validate(t,this._updatables,!1),this._updatables.get(t)}getKeys(){return this._keys(this._updatables)}getKeysFromEnabled(){return this._keys(this._enabled)}getKeysFromDisabled(){return this._keys(this._disabled)}forEach(t){return this._forEach(t,this._updatables),this}forEachEnabled(t){return this._forEach(t,this._enabled),this}forEachDisabled(t){return this._forEach(t,this._disabled),this}_forEach(t,e){e.forEach(t)}has(t){return this._has(t,this._updatables)}hasInEnabled(t){return this._has(t,this._enabled)}hasInDisabled(t){return this._has(t,this._disabled)}_has(t,e){const s=this._getName(t);return e.has(s)}filterEnabled(t){const e=[];return this._enabled.forEach((s=>{t(s)&&e.push(s)})),e}_validate(t,e,s=!0){const i=this._getName(t);if(s&&e.has(i))throw new Error(`Entity ${i} already exists!`);if(!s&&!e.has(i))throw new Error(`Entity ${i} does not exists!`);return i}_getName(t){return"string"!=typeof t?t.getName():t}get entities(){return this._updatables}},this._updater.add(this._sceneManager)}update(t,e){this._updater.update(t,e)}render(t){this._sceneManager.render(t)}setScene(t){return this._sceneManager.setActive(t)}getSceneManager(){return this._sceneManager}getUpdater(){return this._updater}}{constructor(){super(),Os(this,"_camera",void 0),Os(this,"_guiRenderer",void 0),Cs.instance=this}static getInstance(){return Cs.instance}start(){vt.addSounds([{name:"gun",pathname:"/resources/sound/gun.wav"},{name:"empty_gun",pathname:"/resources/sound/empty_gun.wav"},{name:"door",pathname:"/resources/sound/door.mp3"},{name:"music",pathname:"/resources/sound/music.wav",options:{volume:50}},{name:"step",pathname:"/resources/sound/footstep.wav"},{name:"menu",pathname:"/resources/sound/menu.wav",options:{volume:20}},{name:"elevator",pathname:"/resources/sound/elevator.wav"},{name:"damage",pathname:"/resources/sound/damage.wav"},{name:"death-track",pathname:"/resources/sound/death-track.wav"},{name:"monster-attack",pathname:"/resources/sound/monster-attack.mp3"},{name:"monster-death",pathname:"/resources/sound/monster-death.mp3"},{name:"monster-damage",pathname:"/resources/sound/monster-damage.wav"},{name:"whispers",pathname:"/resources/sound/whispers.mp3"}]),this._camera=new Mt("main",new g.Z(51.1,0,-88),new f.Z(0,-32)),Mt.setMainCamera(this._camera),vt.loadShader([{name:"map",vertexShaderPathname:"/resources/shader/map/vert.glsl",fragmentShaderPathname:"/resources/shader/map/frag.glsl"}]),vt.loadShader([{name:"monster",vertexShaderPathname:"/resources/shader/monster/vert.glsl",fragmentShaderPathname:"/resources/shader/monster/frag.glsl"}]),vt.loadShader([{name:"door-panel",vertexShaderPathname:"/resources/shader/door-panel/vert.glsl",fragmentShaderPathname:"/resources/shader/door-panel/frag.glsl"}]),vt.loadShader([{name:"gui",vertexShaderPathname:"/resources/shader/gui/vert.glsl",fragmentShaderPathname:"/resources/shader/gui/frag.glsl"}]),vt.loadShader([{name:"text",vertexShaderPathname:"/resources/shader/text/vert.glsl",fragmentShaderPathname:"/resources/shader/text/frag.glsl"}]),vt.loadShader([{name:"image",vertexShaderPathname:"/resources/shader/image/vert.glsl",fragmentShaderPathname:"/resources/shader/image/frag.glsl"}]),vt.loadShader([{name:"effect",vertexShaderPathname:"/resources/shader/effect/vert.glsl",fragmentShaderPathname:"/resources/shader/effect/frag.glsl"}]),vt.loadShader([{name:"fading",vertexShaderPathname:"/resources/shader/fading/vert.glsl",fragmentShaderPathname:"/resources/shader/fading/frag.glsl"}]),vt.loadTextures([{name:"level",pathname:"/resources/objects/level/level-texture.png"},{name:"elevator",pathname:"/resources/objects/level/elevator-texture.png"},{name:"elevator-door",pathname:"/resources/objects/doors/elevator-door-texture.png"},{name:"hall-door",pathname:"/resources/objects/doors/hall-door-texture.png"},{name:"door-panel-locked",pathname:"/resources/objects/panels/door-panel-locked.png"},{name:"door-panel-unlocked",pathname:"/resources/objects/panels/door-panel-unlocked.png"},{name:"door-panel-display-map",pathname:"/resources/objects/panels/display-map.png"},{name:"lamp",pathname:"/resources/objects/lamp/lamp-texture.png"},{name:"hand",pathname:"/resources/objects/gun/hand-texture.png"},{name:"gun",pathname:"/resources/objects/gun/gun-texture.png"},{name:"monster",pathname:"/resources/objects/monster/monster-texture.png"},{name:"text",pathname:"/resources/images/8x8-font.png"},{name:"instructions",pathname:"/resources/images/instructions.png"}]),vt.addMaterials([new yt("empty",vt.getShader("gui")),new yt("level",vt.getShader("map"),vt.getTexture("level")),new yt("elevator",vt.getShader("map"),vt.getTexture("elevator")),new yt("elevator-door",vt.getShader("map"),vt.getTexture("elevator-door")),new yt("hall-door",vt.getShader("map"),vt.getTexture("hall-door")),new Le,new yt("lamp",vt.getShader("map"),vt.getTexture("lamp")),new yt("hand",vt.getShader("map"),vt.getTexture("hand")),new yt("gun",vt.getShader("map"),vt.getTexture("gun")),new yt("monster",vt.getShader("monster"),vt.getTexture("monster")),new yt("rectangle",vt.getShader("gui")),new yt("text",vt.getShader("text"),vt.getTexture("text")),new yt("instructions",vt.getShader("text"),vt.getTexture("instructions"))]).forEachMaterial((t=>{t.create()})),vt.loadVAO([{name:"level",objectData:"/resources/objects/level/level.obj"},{name:"level-2",objectData:"/resources/objects/level/level-2.obj"},{name:"hall",objectData:"/resources/objects/level/hall.obj"},{name:"elevator",objectData:"/resources/objects/level/elevator.obj"},{name:"elevator-door",objectData:"/resources/objects/doors/elevator-door.obj"},{name:"hall-door",objectData:"/resources/objects/doors/hall-door.obj"},{name:"door-panel",objectData:"/resources/objects/panels/door-panel.obj"},{name:"lamp",objectData:"/resources/objects/lamp/lamp.obj"},{name:"hand",objectData:"/resources/objects/gun/hand.obj"},{name:"gun-receiver",objectData:"/resources/objects/gun/receiver.obj"},{name:"gun-slider",objectData:"/resources/objects/gun/slider.obj"},{name:"monster",objectData:"/resources/objects/monster/monster.obj"},{name:"rectangle",objectData:()=>new lt([new ot(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),2,!0)],2)},{name:"effect",objectData:()=>{const t=[];return t.push(new ot(new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),2,!0)),t.push(new ot(new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),2,!0)),new lt(t,2)}}]).forEachVAO((t=>{t.create()}));const t=new Ms(this._camera),e=new rs(this._camera,t),s=new Oe(this._camera);e.getRenderStrategy().add(s);const i=new Ie(this._camera);e.getRenderStrategy().add(i);const r=new Fe(this._camera);e.getRenderStrategy().add(r);const n=this._guiRenderer=new Dt(this._camera);e.getRenderStrategy().add(n),e.init(this.getUpdater()),this.getSceneManager().add(e,!0),r.setPlayer(e.get("player"),e.get("gun")),i.setPlayer(e.get("player")),this.getSceneManager().add(new Ss(n,t)),this.getSceneManager().add(new oe(n,t)),this.getSceneManager().add(new os(n,t)),this.getSceneManager().add(new es(n,t)),this.getSceneManager().add(new vs(n,t)),this.getSceneManager().add(new ys(n,t)),this.setScene(ys.MAIN_MENU)}update(t,e){super.update(t,e),this._camera.update(e)}render(t){super.render(t)}}Os(Cs,"instance",void 0);const Is=Cs;(()=>{let t=new u(new Is);window.onload=()=>{t.start()},window.onresize=()=>{t.resize()}})()},685:(t,e,s)=>{s.d(e,{Ib:()=>i,WT:()=>r});var i=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},160:(t,e,s)=>{s.d(e,{kC:()=>n,fF:()=>a,kK:()=>o,VC:()=>h,lM:()=>l,uD:()=>c,jI:()=>d,EU:()=>u});var i,r=s(685);function n(t,e,s){var i=e[0],r=e[1],n=e[2],a=s[0],o=s[1],h=s[2];return t[0]=r*h-n*o,t[1]=n*a-i*h,t[2]=i*o-r*a,t}function a(t,e,s){var i=e[0],r=e[1],n=e[2],a=s[3]*i+s[7]*r+s[11]*n+s[15];return a=a||1,t[0]=(s[0]*i+s[4]*r+s[8]*n+s[12])/a,t[1]=(s[1]*i+s[5]*r+s[9]*n+s[13])/a,t[2]=(s[2]*i+s[6]*r+s[10]*n+s[14])/a,t}function o(t,e,s){var i=e[0],r=e[1],n=e[2];return t[0]=i*s[0]+r*s[3]+n*s[6],t[1]=i*s[1]+r*s[4]+n*s[7],t[2]=i*s[2]+r*s[5]+n*s[8],t}function h(t,e,s){var i=s[0],r=s[1],n=s[2],a=s[3],o=e[0],h=e[1],l=e[2],c=r*l-n*h,d=n*o-i*l,u=i*h-r*o,g=r*u-n*d,_=n*c-i*u,m=i*d-r*c,f=2*a;return c*=f,d*=f,u*=f,g*=2,_*=2,m*=2,t[0]=o+c+g,t[1]=h+d+_,t[2]=l+u+m,t}function l(t,e,s,i){var r=[],n=[];return r[0]=e[0]-s[0],r[1]=e[1]-s[1],r[2]=e[2]-s[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=n[0]+s[0],t[1]=n[1]+s[1],t[2]=n[2]+s[2],t}function c(t,e,s,i){var r=[],n=[];return r[0]=e[0]-s[0],r[1]=e[1]-s[1],r[2]=e[2]-s[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=n[0]+s[0],t[1]=n[1]+s[1],t[2]=n[2]+s[2],t}function d(t,e,s,i){var r=[],n=[];return r[0]=e[0]-s[0],r[1]=e[1]-s[1],r[2]=e[2]-s[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],t[0]=n[0]+s[0],t[1]=n[1]+s[1],t[2]=n[2]+s[2],t}function u(t,e){var s=t[0],i=t[1],r=t[2],n=e[0],a=e[1],o=e[2],h=Math.sqrt(s*s+i*i+r*r)*Math.sqrt(n*n+a*a+o*o),l=h&&function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(t,e)/h;return Math.acos(Math.min(Math.max(l,-1),1))}i=new r.WT(3),r.WT!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0)},847:t=>{var e=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),s=function(){function t(e,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._reset(),this.fileContents=e,this.defaultModelName=s||"untitled"}return e(t,[{key:"_reset",value:function(){this.result={models:[],materialLibraries:[]},this.currentMaterial="",this.currentGroup="",this.smoothingGroup=0}},{key:"parse",value:function(){this._reset();for(var t,e,s=this.fileContents.split("\n"),i=0;i<s.length;i+=1){var r=(t=s[i],void 0,(e=t.indexOf("#"))>-1?t.substring(0,e):t).replace(/\s\s+/g," ").trim().split(" ");switch(r[0].toLowerCase()){case"o":this._parseObject(r);break;case"g":this._parseGroup(r);break;case"v":this._parseVertexCoords(r);break;case"vt":this._parseTextureCoords(r);break;case"vn":this._parseVertexNormal(r);break;case"s":this._parseSmoothShadingStatement(r);break;case"f":this._parsePolygon(r);break;case"mtllib":this._parseMtlLib(r);break;case"usemtl":this._parseUseMtl(r)}}return this.result}},{key:"_currentModel",value:function(){return 0==this.result.models.length&&(this.result.models.push({name:this.defaultModelName,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.currentGroup="",this.smoothingGroup=0),this.result.models[this.result.models.length-1]}},{key:"_parseObject",value:function(t){var e=t.length>=2?t[1]:this.defaultModelName;this.result.models.push({name:e,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.currentGroup="",this.smoothingGroup=0}},{key:"_parseGroup",value:function(t){if(2!=t.length)throw"Group statements must have exactly 1 argument (eg. g group_1)";this.currentGroup=t[1]}},{key:"_parseVertexCoords",value:function(t){var e=t.length>=2?parseFloat(t[1]):0,s=t.length>=3?parseFloat(t[2]):0,i=t.length>=4?parseFloat(t[3]):0;this._currentModel().vertices.push({x:e,y:s,z:i})}},{key:"_parseTextureCoords",value:function(t){var e=t.length>=2?parseFloat(t[1]):0,s=t.length>=3?parseFloat(t[2]):0,i=t.length>=4?parseFloat(t[3]):0;this._currentModel().textureCoords.push({u:e,v:s,w:i})}},{key:"_parseVertexNormal",value:function(t){var e=t.length>=2?parseFloat(t[1]):0,s=t.length>=3?parseFloat(t[2]):0,i=t.length>=4?parseFloat(t[3]):0;this._currentModel().vertexNormals.push({x:e,y:s,z:i})}},{key:"_parsePolygon",value:function(t){var e=t.length-1;if(e<3)throw"Face statement has less than 3 vertices"+this.filePath+this.lineNumber;for(var s={material:this.currentMaterial,group:this.currentGroup,smoothingGroup:this.smoothingGroup,vertices:[]},i=0;i<e;i+=1){var r=t[i+1].split("/");if(r.length<1||r.length>3)throw"Two many values (separated by /) for a single vertex"+this.filePath+this.lineNumber;var n=0,a=0,o=0;if(n=parseInt(r[0]),r.length>1&&""==!r[1]&&(a=parseInt(r[1])),r.length>2&&(o=parseInt(r[2])),0==n)throw"Faces uses invalid vertex index of 0";n<0&&(n=this._currentModel().vertices.length+1+n),s.vertices.push({vertexIndex:n,textureCoordsIndex:a,vertexNormalIndex:o})}this._currentModel().faces.push(s)}},{key:"_parseMtlLib",value:function(t){t.length>=2&&this.result.materialLibraries.push(t[1])}},{key:"_parseUseMtl",value:function(t){t.length>=2&&(this.currentMaterial=t[1])}},{key:"_parseSmoothShadingStatement",value:function(t){if(2!=t.length)throw"Smoothing group statements must have exactly 1 argument (eg. s <number|off>)";var e="off"==t[1].toLowerCase()?0:parseInt(t[1]);this.smoothingGroup=e}}]),t}();t.exports=s}},t=>{t(t.s=26)}]);
//# sourceMappingURL=index.js.map